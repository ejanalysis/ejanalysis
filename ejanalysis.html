<!DOCTYPE html>
<html>
  <head>
    <title>Package 'ejanalysis' reference manual</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

    <!-- styling for math and syntax -->
    <link rel="stylesheet" type="text/css" href="https://r-universe.dev/static/katex.min.css">
    <link rel="stylesheet" type="text/css" href="https://r-universe.dev/static/R.css">
    <link rel="stylesheet" type="text/css" href="https://r-universe.dev/static/prism.css">

    <!-- for (future) customizations -->
    <script src="https://r-universe.dev/static/manual.js"></script>
    <link rel="stylesheet" type="text/css" href="https://r-universe.dev/static/manual.css?nocache=1">

  </head>

  <body class="macintosh">
    <h1 class="manual-title">Package 'ejanalysis'</h1>
    <table class="description-table">
      <tr>
<th>Title:</th>
<td class="description-title">Tools for Environmental Justice (EJ) Analysis</td>
</tr>
      <tr>
<th>Description:</th>
<td class="description-description">Tools that simplify some basic tasks in exploring and analyzing
    a dataset in a matrix or data.frame that contains data on demographics
    (e.g., counts of residents in poverty) and local environmental indicators
    (e.g., an air quality index), with one row per spatial location (e.g., Census
    block group). Key functions help to find relative risk or similar ratios of
    means in demographic groups, etc.
    For any imported/suggested packages not on CRAN, see http://ejanalysis.github.io</td>
</tr>
      <tr>
<th>Authors:</th>
<td class="description-author"><span>info@ejanalysis.com</span></td>
</tr>
      <tr>
<th>Maintainer:</th>
<td class="description-maintainer">info@ejanalysis.com &lt;info@ejanalysis.com&gt;</td>
</tr>
      <tr>
<th>License:</th>
<td class="description-license">MIT + file LICENSE</td>
</tr>
      <tr>
<th>Version:</th>
<td class="description-version">2.1.1</td>
</tr>
      <tr>
<th>Built:</th>
<td class="description-date">2023-04-28 19:27:47 UTC</td>
</tr>
      <tr>
<th>Source:</th>
<td class="description-source">GitHub</td>
</tr>
    </table>

    <a href="#help-index" style="color:black;"><h2 id="help-index">Help Index</h2></a>
    <ul id="help-index-list">
<li class="help-index-item"><a href="#addFIPScomponents">Add col for each component of longer FIPS</a></li>
<li class="help-index-item"><a href="#assign.map.bins">Assign Each Row (Place) to a Bin Based on Cutpoints</a></li>
<li class="help-index-item"><a href="#assign.pctiles">Assign percentiles to vector of values (weighted, by zone)</a></li>
<li class="help-index-item"><a href="#assign.pctiles.alt2">Assign percentiles to values (alternative formula, and not by zone)</a></li>
<li class="help-index-item"><a href="#bgtest">Test dataset for ejanalysis</a></li>
<li class="help-index-item"><a href="#clean.fips">Clean up US Census FIPS (Add Missing Leading Zeroes)</a></li>
<li class="help-index-item"><a href="#clean.fips1215">Check and clean Census block group or block FIPS - only check number of characters and if NA, not if valid number otherwise</a></li>
<li class="help-index-item"><a href="#ej.added">Contribution of each place to net excess people-points in demographic group</a></li>
<li class="help-index-item"><a href="#ej.indexes">Calculate environmental justice (EJ) index for each place</a></li>
<li class="help-index-item"><a href="#ejanalysis">Tools for Environmental Justice (EJ) Analysis</a></li>
<li class="help-index-item"><a href="#ejRRadded">Formulas for local contributions to EJ metrics</a></li>
<li class="help-index-item"><a href="#flagged">Which rows have a value above cutoff in at least one column</a></li>
<li class="help-index-item"><a href="#flagged.by">flagged.by</a></li>
<li class="help-index-item"><a href="#flagged.only.by">flagged.only.by</a></li>
<li class="help-index-item"><a href="#geofips">Convert between FIPS / ANSI codes and Names of U.S. Geographies</a></li>
<li class="help-index-item"><a href="#geotype">Infer Type of Data as FIPS / ANSI Codes or Names of U.S. Geographies</a></li>
<li class="help-index-item"><a href="#get.county.info">Get info on US Counties</a></li>
<li class="help-index-item"><a href="#get.epa.region">Identify EPA Region for given state (or FIPS)</a></li>
<li class="help-index-item"><a href="#get.fips.bg">Get Census block group FIPS from block or block group FIPS</a></li>
<li class="help-index-item"><a href="#get.fips.county">Get County FIPS from block or block group FIPS</a></li>
<li class="help-index-item"><a href="#get.fips.etc">Get tract, county, state, region info from US Census block group FIPS codes (unused?)</a></li>
<li class="help-index-item"><a href="#get.fips.st">Get State FIPS from block or block group FIPS</a></li>
<li class="help-index-item"><a href="#get.fips.tract">Get Census tract FIPS from block or block group FIPS</a></li>
<li class="help-index-item"><a href="#get.name.county">Extract county name from Census geo name field</a></li>
<li class="help-index-item"><a href="#get.name.state">Extract state name from Census geo name field</a></li>
<li class="help-index-item"><a href="#get.pctile">Determine (Weighted) Percentiles</a></li>
<li class="help-index-item"><a href="#get.state.info">Get information on U.S. State(s)</a></li>
<li class="help-index-item"><a href="#KolmPollak">Kolm-Pollak Inequality Index adjustable for indexing inequality in bad outcomes</a></li>
<li class="help-index-item"><a href="#lookup.pctile">Find approx wtd percentiles in lookup table that is in memory</a></li>
<li class="help-index-item"><a href="#make.bin.cols">Create a Bin Numbers Column for each Percentiles Column</a></li>
<li class="help-index-item"><a href="#make.bin.pctile.cols">Weighted Percentiles and Bin Numbers for Each Column, by zone, such as percentiles within each State</a></li>
<li class="help-index-item"><a href="#make.bin.pctile.cols.byzone">May be obsolete-not used -was Percentile and bin number fields, by zone, such as percentiles within each State</a></li>
<li class="help-index-item"><a href="#make.pctile.cols">Make columns of (weighted) percentiles from columns of values</a></li>
<li class="help-index-item"><a href="#make.pctile.cols.alt2">Alternative way to make columns of (weighted) percentiles from columns of values</a></li>
<li class="help-index-item"><a href="#names.d">Fieldnames of demographic columns in ejscreen data</a></li>
<li class="help-index-item"><a href="#names.e">Fieldnames of environmental indicator columns in ejscreen data</a></li>
<li class="help-index-item"><a href="#names.ej">Fieldnames of EJ index columns in ejscreen data</a></li>
<li class="help-index-item"><a href="#narrativeprofile">Get County or Tract Narrative Profile webpage from Census</a></li>
<li class="help-index-item"><a href="#pct.moe">Margin of Error for a Percent (Ratio)</a></li>
<li class="help-index-item"><a href="#plot_3_by_distance">create plot of 3 indicators versus distance
This makes a very simple scatter plot of 3 variables on y axis
as a function of distance on the x axis.
For example, it can show risk, percent demographic score, and population
density, e.g., using numbers created at random by sim_riskbydistance()</a></li>
<li class="help-index-item"><a href="#pop.cdf">Draw PDF (overlays histograms) comparing distributions of scores in selected demographic groups</a></li>
<li class="help-index-item"><a href="#pop.cdf.density">Overlay 2 PDFs as Weighted Histograms</a></li>
<li class="help-index-item"><a href="#pop.cdf2">Overlay Two PDFs as Weighted Histograms</a></li>
<li class="help-index-item"><a href="#pop.ecdf">Draw an Ecdf plot comparing distributions of scores in selected demographic groups</a></li>
<li class="help-index-item"><a href="#pop.ecdf.dd">Draw an Ecdf plot showing the distribution of scores in each demographic subgroup</a></li>
<li class="help-index-item"><a href="#rollup">Aggregate multiple columns of values by group</a></li>
<li class="help-index-item"><a href="#rollup.pct">Calculate a/b for each Subset</a></li>
<li class="help-index-item"><a href="#RR">Relative Risk (RR) by demographic group by indicator based on Census data</a></li>
<li class="help-index-item"><a href="#RR.cut.if.gone">How much is overal RR reduced if a given place did not exist?</a></li>
<li class="help-index-item"><a href="#RR.if.address.top.x">Analyze how much RR would change if top-ranked places were addressed - ** NOT WORKING/ IN PROGRESS</a></li>
<li class="help-index-item"><a href="#RR.means">Relative Risk (RR) components - Means in demographic group and in rest of pop, based on Census data</a></li>
<li class="help-index-item"><a href="#RR.plot">Draw lineplot comparing RR values by group</a></li>
<li class="help-index-item"><a href="#RR.plotbar">Draw barplot comparing mean score in a group vs reference group</a></li>
<li class="help-index-item"><a href="#RR.table">Table of Relative Risk results by zone by group by envt risk factor</a></li>
<li class="help-index-item"><a href="#RR.table.add">Merge tables of Relative Risk results</a></li>
<li class="help-index-item"><a href="#RR.table.addmaxzone">Add to an existing RR.table the max relative risk value from any zone in the table
This function adds RR values from the max zone but RR.table already does this.</a></li>
<li class="help-index-item"><a href="#RR.table.max">See which group and risk indicator (in zone) have max values in RR table</a></li>
<li class="help-index-item"><a href="#RR.table.sort">Sort table of Relative Risk results by zone by group by envt risk factor</a></li>
<li class="help-index-item"><a href="#RR.table.view">Just print Relative Risks (RR) info by demog group by risk type by zone</a></li>
<li class="help-index-item"><a href="#RR.table.vs.us">Relative Risks (RR) in zones as ratios to US values</a></li>
<li class="help-index-item"><a href="#rrf">RR for one environmental indicator, one demographic group</a></li>
<li class="help-index-item"><a href="#rrfv">Vectorized version of rrf (relative risk) - **not tested, possibly obsolete</a></li>
<li class="help-index-item"><a href="#scatterEJ_D_E">scatterplot EJScreen Demog vs Envt vs EJ Index
See one point per blockgroup, x=demog pctile, y=envt pctile, color=EJ pctile</a></li>
<li class="help-index-item"><a href="#sim_plotratios">create plot of ratios indicating disparity, from sim_riskbydistance output</a></li>
<li class="help-index-item"><a href="#sim_riskbydistance">Simulate disparities as risk, pop density, and demographics vary by distance</a></li>
<li class="help-index-item"><a href="#state.health.url">Get URL(s) with State health indicator data from RWJF - ** url scheme obsolete now so needs to be redone</a></li>
<li class="help-index-item"><a href="#sumoe">Margin of Error for a Sum</a></li>
<li class="help-index-item"><a href="#url.census">See webpage with data on Census units from American Fact Finder - may not be used</a></li>
<li class="help-index-item"><a href="#url.censusblock">See webpage with data on Census block(s)</a></li>
<li class="help-index-item"><a href="#url.open">Launch a web browser to go to a URL, like browseURL does</a></li>
<li class="help-index-item"><a href="#url.qf">US Census Quickfacts Webpage URL</a></li>
<li class="help-index-item"><a href="#worstd">Demographic groups with worst RR</a></li>
<li class="help-index-item"><a href="#worste">Environmental indicators with worst RR</a></li>
<li class="help-index-item"><a href="#worstplaces">Places with worst RR</a></li>
<li class="help-index-item"><a href="#write.pctiles">Write csv file lookup table - percentiles, mean, standard deviation</a></li>
<li class="help-index-item"><a href="#write.pctiles.by.zone">create lookup table as file of percentiles, mean, sd by state or region</a></li>
<li class="help-index-item"><a href="#write.RR.tables">Save RR tables to disk, one per zone.</a></li>
<li class="help-index-item"><a href="#write.wtd.pctiles">create lookup table as file of pop-weighted percentiles, mean, std.dev</a></li>
<li class="help-index-item"><a href="#write.wtd.pctiles.by.zone">create lookup table as file of pop-weighted or unwtd percentiles, mean, sd for US or by state or region</a></li>
</ul>

    <hr>
    <div class="manual-pages-content">
<div class="container manual-page" id="addFIPScomponents">

<a href="#addFIPScomponents" class="help-page-title"><h2>Add col for each component of longer FIPS</h2></a>

<h3>Description</h3>

<p>Given a data.frame with FIPS col that is the full state county tract blockgroup FIPS
returns the data.frame with extra columns up front, with components of FIPS.
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">addFIPScomponents<span class="token punctuation">(</span>bg<span class="token punctuation">,</span> fipscolname <span class="token operator">=</span> <span class="token string">"FIPS"</span><span class="token punctuation">,</span> clean <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>bg</code></td>
<td>
<p>Data.frame with a character column called FIPS (or specified otherwise)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fipscolname</code></td>
<td>
<p>FIPS by default but could specify some other name to be found as col in bg</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>clean</code></td>
<td>
<p>Does not use clean.fips() if FALSE, which helps if the countiesall or other list is not yet updated, for example and lacks some new FIPS code</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>Returns the whole data.frame with new columns in front:
'FIPS', 'FIPS.TRACT', 'FIPS.COUNTY', 'FIPS.ST', 'ST', 'statename', 'REGION'
</p>

<hr>
</div>
<div class="container manual-page" id="assign.map.bins">

<a href="#assign.map.bins" class="help-page-title"><h2>Assign Each Row (Place) to a Bin Based on Cutpoints</h2></a>

<h3>Description</h3>

<p>Takes a vector (not matrix or df) of values and returns a vector of bin numbers.
For creating color-coded maps (choropleths), assign each place (e.g., each row of a single column) to a bin.
Each bin represents one map color, and is defined by cutoff values.
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">assign.map.bins<span class="token punctuation">(</span>
  pctiles.vector<span class="token punctuation">,</span>
  cutpoints <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token operator">:</span><span class="token number">9</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">0.95</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  labels <span class="token operator">=</span> <span class="token number">1</span><span class="token operator">:</span><span class="token number">11</span>
<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>pctiles.vector</code></td>
<td>
<p>Vector of percentiles as decimal fractions, 0 to 1, one per place.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cutpoints</code></td>
<td>
<p>Optional vector of cutpoints defining edges of bins. Default is every 0.10 from 0 to 1.00, as well as 0.95</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>labels</code></td>
<td>
<p>vector of bin numbers, optional (default is 1 through 11, and NA values are put in bin 0).</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The default bins 0-11 are defined as follows: <br>
bin 0: PCTILE=NA <br>
... <br>
bin 9:  0.80&lt;=PCTILE&lt;0.90 <br>
bin 10: 0.90&lt;=PCTILE&lt;0.95 <br>
bin 11: 0.95&lt;=PCTILE&lt;=1.00  <br></p>


<h3>Value</h3>

<p>Returns a vector bin numbers.
</p>


<h3>See Also</h3>

<p><code><a href="#make.bin.pctile.cols">make.bin.pctile.cols</a></code> to call functions below, converting columns of values to percentiles and then bins <br><code><a href="#assign.pctiles">assign.pctiles</a></code> for one vector, assign (weighted) percentile (quantile) to each value within its zone (subset)  <br><code><a href="#assign.pctiles.alt2">assign.pctiles.alt2</a></code> as an alternative method, to replicate assign.pctiles, but not by zone <br><code><a href="#get.pctile">get.pctile</a></code> to get (weighted) percentile of just 1+ values within given vector of values <br><code><a href="#make.pctile.cols">make.pctile.cols</a></code> for a data.frame, assign percentiles, return a same-sized df that is wtd.quantile of each value within its column <br><code><a href="#make.pctile.cols.alt2">make.pctile.cols.alt2</a></code> as an alternative method, to replicate make.pctile.cols <br><code><a href="#assign.map.bins">assign.map.bins</a></code> for one vector (or data.frame) of values (e.g. percentiles), return same-sized df that is bin number (map color bin) using preset breaks. <br><code><a href="#make.bin.cols">make.bin.cols</a></code> for a data.frame of values (e.g. percentiles), return same-sized df that is bin number (map color bin) using preset breaks. <br><code><a href="#write.pctiles">write.pctiles</a></code> to save file that is lookup table of percentiles for columns of a data.frame <br><code><a href="#write.pctiles.by.zone">write.pctiles.by.zone</a></code> to save file that is lookup table of percentiles for columns of a data.frame, for each geographic zone (subset of rows) <br><code><a href="#write.wtd.pctiles">write.wtd.pctiles</a></code> to save file that is lookup table of weighted percentiles for columns of a data.frame <br><code><a href="#write.wtd.pctiles.by.zone">write.wtd.pctiles.by.zone</a></code> to save file that is lookup table of weighted percentiles for columns of a data.frame, for each geographic zone (subset of rows) <br><code><a href="#lookup.pctile">lookup.pctile</a></code> to look up current approx weighted percentiles in a lookup table that is already in global memory <br></p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r">junk<span class="token operator">&lt;-</span>c<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0.799</span><span class="token punctuation">,</span><span class="token number">0.8</span><span class="token punctuation">,</span> <span class="token number">0.8000001</span><span class="token punctuation">,</span> <span class="token number">0.8999999</span><span class="token punctuation">,</span><span class="token number">0.95</span><span class="token punctuation">,</span><span class="token number">0.95001</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span>
data.frame<span class="token punctuation">(</span>pctile<span class="token operator">=</span>junk<span class="token punctuation">,</span> bin<span class="token operator">=</span>assign.map.bins<span class="token punctuation">(</span>junk<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># How it puts these in bins by default:</span>
<span class="token comment">#      pctile bin   notes</span>
<span class="token comment">#1  0.0000000   1</span>
<span class="token comment">#2  0.7990000   8</span>
<span class="token comment">#</span>
<span class="token comment">#3  0.8000000   9 (0.80&lt;=PCTILE&lt;0.90 )</span>
<span class="token comment">#4  0.8000001   9 (0.80&lt;=PCTILE&lt;0.90 )</span>
<span class="token comment">#5  0.8999999   9 (0.80&lt;=PCTILE&lt;0.90 )</span>
<span class="token comment">#</span>
<span class="token comment">#6  0.9000000  10 (0.90&lt;=PCTILE&lt;0.95 )</span>
<span class="token comment">#7  0.9001000  10 (0.90&lt;=PCTILE&lt;0.95 )</span>
<span class="token comment">#8  0.9499990  10 (0.90&lt;=PCTILE&lt;0.95 )</span>
<span class="token comment">#</span>
<span class="token comment">#9  0.9500000  11 (0.95&lt;=PCTILE&lt;=1.00 ) I.E. THIS INCLUDES 100th percentile</span>
<span class="token comment">#10 0.9500100  11 (0.95&lt;=PCTILE&lt;=1.00 ) I.E. THIS INCLUDES 100th percentile</span>
<span class="token comment">#11 1.0000000  11 (0.95&lt;=PCTILE&lt;=1.00 ) I.E. THIS INCLUDES 100th percentile</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="assign.pctiles">

<a href="#assign.pctiles" class="help-page-title"><h2>Assign percentiles to vector of values (weighted, by zone)</h2></a>

<h3>Description</h3>

<p>For the vector, look at the distribution of values across all rows in a given zone (e.g., places in zone),
and find what percentile a given value is at.
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">assign.pctiles<span class="token punctuation">(</span>values<span class="token punctuation">,</span> weights <span class="token operator">=</span> <span class="token keyword">NULL</span><span class="token punctuation">,</span> zone <span class="token operator">=</span> <span class="token keyword">NULL</span><span class="token punctuation">,</span> na.rm <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>values</code></td>
<td>
<p>vector, required, with numeric values. To do this with a matrix, see <code><a href="#make.pctile.cols">make.pctile.cols()</a></code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>weights</code></td>
<td>
<p>Optional, NULL by default (not fully tested), vector of weights for weighted percentiles (e.g., population weighted).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>zone</code></td>
<td>
<p>Optional, NULL by default, defines subsets of rows, so a percentile is found among rows that are within a given zone only.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>na.rm</code></td>
<td>
<p>NOT IMPLEMENTED HERE. Logical, optional, TRUE by default. Should NA values (missing data) be removed first to get percentile of those with valid data.
If FALSE, NA values are treated as being at the high percentiles.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Relies on the <code><a href="https://harrelfe.r-universe.dev/manual/Hmisc.html#wtd.stats">Hmisc::wtd.Ecdf()</a></code> function.
COULD BE RECODED TO BE FASTER USING data.table package *** see notes in <code><a href="#rollup.pct">rollup.pct()</a></code> and <code><a href="#rollup">rollup()</a></code>
Could also add parameter like in rank(), na.last,
defining na.rm but also where to rank NA values if included, etc.
</p>
<p>Default now is like na.last=NA, but like na.last='last' if na.rm=FALSE
</p>
<p>****Could also add parameter like in rank(), ties.method, defining if ties get min, max, or mean of percentiles initially assigned to ties.
Default for ties up to mid2022 was like ties.method=max ?
But EJScreen will redefine percentiles to set tied values at lower end of that group, min
</p>


<h3>Value</h3>

<p>Returns a numeric vector same size as x, but if zone is specified, provides percentile with given zone.
</p>


<h3>See Also</h3>

<p><code><a href="#make.bin.pctile.cols">make.bin.pctile.cols</a></code> to call functions below, converting columns of values to percentiles and then bins <br><code><a href="#assign.pctiles">assign.pctiles</a></code> for one vector, assign (weighted) percentile (quantile) to each value within its zone (subset)  <br><code><a href="#assign.pctiles.alt2">assign.pctiles.alt2</a></code> as an alternative method, to replicate assign.pctiles, but not by zone <br><code><a href="#get.pctile">get.pctile</a></code> to get (weighted) percentile of just 1+ values within given vector of values <br><code><a href="#make.pctile.cols">make.pctile.cols</a></code> for a data.frame, assign percentiles, return a same-sized df that is wtd.quantile of each value within its column <br><code><a href="#make.pctile.cols.alt2">make.pctile.cols.alt2</a></code> as an alternative method, to replicate make.pctile.cols <br><code><a href="#assign.map.bins">assign.map.bins</a></code> for one vector (or data.frame) of values (e.g. percentiles), return same-sized df that is bin number (map color bin) using preset breaks. <br><code><a href="#make.bin.cols">make.bin.cols</a></code> for a data.frame of values (e.g. percentiles), return same-sized df that is bin number (map color bin) using preset breaks. <br><code><a href="#write.pctiles">write.pctiles</a></code> to save file that is lookup table of percentiles for columns of a data.frame <br><code><a href="#write.pctiles.by.zone">write.pctiles.by.zone</a></code> to save file that is lookup table of percentiles for columns of a data.frame, for each geographic zone (subset of rows) <br><code><a href="#write.wtd.pctiles">write.wtd.pctiles</a></code> to save file that is lookup table of weighted percentiles for columns of a data.frame <br><code><a href="#write.wtd.pctiles.by.zone">write.wtd.pctiles.by.zone</a></code> to save file that is lookup table of weighted percentiles for columns of a data.frame, for each geographic zone (subset of rows) <br><code><a href="#lookup.pctile">lookup.pctile</a></code> to look up current approx weighted percentiles in a lookup table that is already in global memory <br></p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r">x <span class="token operator">&lt;-</span> c<span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span><span class="token number">12</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">13</span><span class="token punctuation">,</span><span class="token number">13</span><span class="token punctuation">,</span><span class="token number">13</span><span class="token punctuation">,</span><span class="token number">13</span><span class="token punctuation">,</span><span class="token number">13</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token operator">:</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token number">21</span><span class="token operator">:</span><span class="token number">30</span><span class="token punctuation">)</span>
wts <span class="token operator">&lt;-</span> rep<span class="token punctuation">(</span>c<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> length<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">)</span>
cbind<span class="token punctuation">(</span>wts<span class="token punctuation">,</span> x<span class="token punctuation">,</span> PCTILE<span class="token operator">=</span>assign.pctiles<span class="token punctuation">(</span>x<span class="token punctuation">,</span>wts<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># PERCENTILE OF ALL, NOT JUST THOSE WITH VALID DATA, IF na.rm=FALSE,</span>
<span class="token comment"># but then NA values preclude high percentiles:</span>
x <span class="token operator">&lt;-</span> c<span class="token punctuation">(</span><span class="token keyword">NA</span><span class="token punctuation">,</span> <span class="token keyword">NA</span><span class="token punctuation">,</span> <span class="token keyword">NA</span><span class="token punctuation">,</span> <span class="token keyword">NA</span><span class="token punctuation">,</span><span class="token keyword">NA</span><span class="token punctuation">,</span><span class="token keyword">NA</span><span class="token punctuation">,</span><span class="token keyword">NA</span><span class="token punctuation">,</span><span class="token keyword">NA</span><span class="token punctuation">,</span><span class="token keyword">NA</span><span class="token punctuation">,</span><span class="token keyword">NA</span><span class="token punctuation">,</span><span class="token number">13</span><span class="token punctuation">,</span><span class="token number">13</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token operator">:</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token number">21</span><span class="token operator">:</span><span class="token number">30</span><span class="token punctuation">)</span>
wts <span class="token operator">&lt;-</span> rep<span class="token punctuation">(</span>c<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> length<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">)</span>
cbind<span class="token punctuation">(</span>wts<span class="token punctuation">,</span> x<span class="token punctuation">,</span> PCTILE.alt2<span class="token operator">=</span>assign.pctiles.alt2<span class="token punctuation">(</span>x<span class="token punctuation">,</span> wts<span class="token punctuation">,</span> na.rm<span class="token operator">=</span><span class="token boolean">FALSE</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
 pctile<span class="token operator">=</span>assign.pctiles<span class="token punctuation">(</span>x<span class="token punctuation">,</span>wts<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">[</span>order<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span>
cbind<span class="token punctuation">(</span>wts<span class="token punctuation">,</span> x<span class="token punctuation">,</span> PCTILE.alt2<span class="token operator">=</span>assign.pctiles.alt2<span class="token punctuation">(</span>x<span class="token punctuation">,</span> wts<span class="token punctuation">,</span> na.rm<span class="token operator">=</span><span class="token boolean">TRUE</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
 pctile<span class="token operator">=</span>assign.pctiles<span class="token punctuation">(</span>x<span class="token punctuation">,</span>wts<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">[</span>order<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span>

V<span class="token operator">=</span><span class="token number">9</span>
sum<span class="token punctuation">(</span>wts<span class="token punctuation">[</span><span class="token operator">!</span>is.na<span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token operator">&amp;</span> x <span class="token operator">&lt;=</span> V<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">/</span> sum<span class="token punctuation">(</span>wts<span class="token punctuation">[</span><span class="token operator">!</span>is.na<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment">#A value (V) being at this PCTILE% means that (assuming na.rm=TRUE):</span>

<span class="token comment"># V &gt;= x  for        PCTILE% of wts     (for non-NA x), so</span>
<span class="token comment"># V &lt; x   for 100% - PCTILE% of wts     (for non-NA x), or</span>
<span class="token comment"># PCTILE% of all wts have V &gt;= x (for non-NA x), so</span>
<span class="token comment"># 100% - PCTILE% of all wts have V &lt; x  (for non-NA x).</span>

x <span class="token operator">&lt;-</span> c<span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">,</span> <span class="token keyword">NA</span><span class="token punctuation">,</span> <span class="token keyword">NA</span><span class="token punctuation">,</span> <span class="token keyword">NA</span><span class="token punctuation">,</span><span class="token keyword">NA</span><span class="token punctuation">,</span><span class="token keyword">NA</span><span class="token punctuation">,</span><span class="token keyword">NA</span><span class="token punctuation">,</span><span class="token keyword">NA</span><span class="token punctuation">,</span><span class="token keyword">NA</span><span class="token punctuation">,</span><span class="token keyword">NA</span><span class="token punctuation">,</span><span class="token number">13</span><span class="token punctuation">,</span><span class="token number">13</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token operator">:</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token keyword">NA</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token number">21</span><span class="token operator">:</span><span class="token number">30</span><span class="token punctuation">)</span>
wts <span class="token operator">&lt;-</span> rep<span class="token punctuation">(</span>c<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> length<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">)</span>
cbind<span class="token punctuation">(</span>wts<span class="token punctuation">,</span> x<span class="token punctuation">,</span> PCTILE.alt2<span class="token operator">=</span>assign.pctiles.alt2<span class="token punctuation">(</span>x<span class="token punctuation">,</span> wts<span class="token punctuation">,</span> na.rm<span class="token operator">=</span><span class="token boolean">FALSE</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
 pctile<span class="token operator">=</span>assign.pctiles<span class="token punctuation">(</span>x<span class="token punctuation">,</span>wts<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">[</span>order<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span>
cbind<span class="token punctuation">(</span>wts<span class="token punctuation">,</span> x<span class="token punctuation">,</span> PCTILE.alt2<span class="token operator">=</span>assign.pctiles.alt2<span class="token punctuation">(</span>x<span class="token punctuation">,</span> wts<span class="token punctuation">,</span> na.rm<span class="token operator">=</span><span class="token boolean">TRUE</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
 pctile<span class="token operator">=</span>assign.pctiles<span class="token punctuation">(</span>x<span class="token punctuation">,</span>wts<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">[</span>order<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span>

 <span class="token comment">## Not run: </span>
   What is environmental score at given percentile?
 ejanalysis<span class="token operator">::</span>lookup.pctile<span class="token punctuation">(</span><span class="token number">40</span><span class="token punctuation">,</span><span class="token string">'cancer'</span><span class="token punctuation">,</span>lookupUSA<span class="token punctuation">)</span>
 <span class="token comment"># [1] 84</span>
 ejanalysis<span class="token operator">::</span>lookup.pctile<span class="token punctuation">(</span><span class="token number">40</span><span class="token punctuation">,</span><span class="token string">'cancer'</span><span class="token punctuation">,</span>lookupStates<span class="token punctuation">,</span><span class="token string">'WV'</span><span class="token punctuation">)</span>
 <span class="token comment"># [1] 93</span>
 <span class="token comment">#    What is percentile of given environmental score?</span>
 ejscreen<span class="token operator">::</span>lookupUSA<span class="token punctuation">[</span>lookupUSA<span class="token operator">$</span>PCTILE<span class="token operator">==</span><span class="token string">'84'</span> <span class="token punctuation">,</span><span class="token string">'cancer'</span><span class="token punctuation">]</span>
 <span class="token comment"># [1] 39.83055</span>
 ejscreen<span class="token operator">::</span>lookupStates<span class="token punctuation">[</span>lookupStates<span class="token operator">$</span>PCTILE<span class="token operator">==</span><span class="token string">'84'</span> <span class="token operator">&amp;</span> lookupStates<span class="token operator">$</span>REGION <span class="token operator">==</span><span class="token string">'WV'</span><span class="token punctuation">,</span><span class="token string">'cancer'</span><span class="token punctuation">]</span>
 <span class="token comment"># [1] 33.36371</span>
 
<span class="token comment">## End(Not run)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="assign.pctiles.alt2">

<a href="#assign.pctiles.alt2" class="help-page-title"><h2>Assign percentiles to values (alternative formula, and not by zone)</h2></a>

<h3>Description</h3>

<p>For each column look at the distribution of values across all rows,
and find what percentile a given value is at.
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">assign.pctiles.alt2<span class="token punctuation">(</span>x<span class="token punctuation">,</span> weights <span class="token operator">=</span> <span class="token keyword">NULL</span><span class="token punctuation">,</span> na.rm <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">,</span> zone <span class="token operator">=</span> <span class="token keyword">NULL</span><span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>vector or data.frame</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>weights</code></td>
<td>
<p>Optional, NULL by default (not fully tested), vector of weights for weighted percentiles (e.g., population weighted).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>na.rm</code></td>
<td>
<p>Logical, optional, TRUE by default. Should NA values (missing data) be removed first to get percentile of those with valid data.
If FALSE, NA values are treated as being at the high percentiles.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>zone</code></td>
<td>
<p>Optional, NULL by default, *** not yet implemented here.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Assign percentile as cumulative sum of (the weights ranked by the value x).
Then fixes ties.
# Could also add parameter like in rank(), na.last,
defining na.rm but also where to rank NA values if included, etc.
Default now is like na.last=NA, but like na.last='last' if na.rm=FALSE
Could also add parameter like in rank(), ties.method, defining if ties get min, max, or mean of percentiles initially assigned to ties.
Default for ties right now is like ties.method=max (which might not be what assign.pctiles() does in fact).
</p>


<h3>Value</h3>

<p>Returns a numeric vector or data.frame same size as x.
</p>


<h3>See Also</h3>

<p><code><a href="#make.bin.pctile.cols">make.bin.pctile.cols</a></code> to call functions below, converting columns of values to percentiles and then bins <br><code><a href="#assign.pctiles">assign.pctiles</a></code> for one vector, assign (weighted) percentile (quantile) to each value within its zone (subset)  <br><code><a href="#assign.pctiles.alt2">assign.pctiles.alt2</a></code> as an alternative method, to replicate assign.pctiles, but not by zone <br><code><a href="#get.pctile">get.pctile</a></code> to get (weighted) percentile of just 1+ values within given vector of values <br><code><a href="#make.pctile.cols">make.pctile.cols</a></code> for a data.frame, assign percentiles, return a same-sized df that is wtd.quantile of each value within its column <br><code><a href="#make.pctile.cols.alt2">make.pctile.cols.alt2</a></code> as an alternative method, to replicate make.pctile.cols <br><code><a href="#assign.map.bins">assign.map.bins</a></code> for one vector (or data.frame) of values (e.g. percentiles), return same-sized df that is bin number (map color bin) using preset breaks. <br><code><a href="#make.bin.cols">make.bin.cols</a></code> for a data.frame of values (e.g. percentiles), return same-sized df that is bin number (map color bin) using preset breaks. <br><code><a href="#write.pctiles">write.pctiles</a></code> to save file that is lookup table of percentiles for columns of a data.frame <br><code><a href="#write.pctiles.by.zone">write.pctiles.by.zone</a></code> to save file that is lookup table of percentiles for columns of a data.frame, for each geographic zone (subset of rows) <br><code><a href="#write.wtd.pctiles">write.wtd.pctiles</a></code> to save file that is lookup table of weighted percentiles for columns of a data.frame <br><code><a href="#write.wtd.pctiles.by.zone">write.wtd.pctiles.by.zone</a></code> to save file that is lookup table of weighted percentiles for columns of a data.frame, for each geographic zone (subset of rows) <br><code><a href="#lookup.pctile">lookup.pctile</a></code> to look up current approx weighted percentiles in a lookup table that is already in global memory <br></p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r">x <span class="token operator">&lt;-</span> c<span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span><span class="token number">12</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">13</span><span class="token punctuation">,</span><span class="token number">13</span><span class="token punctuation">,</span><span class="token number">13</span><span class="token punctuation">,</span><span class="token number">13</span><span class="token punctuation">,</span><span class="token number">13</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token operator">:</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token number">21</span><span class="token operator">:</span><span class="token number">30</span><span class="token punctuation">)</span>
weights <span class="token operator">&lt;-</span> rep<span class="token punctuation">(</span>c<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> length<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">)</span>
cbind<span class="token punctuation">(</span>weights<span class="token punctuation">,</span> x<span class="token punctuation">,</span> PCTILE<span class="token operator">=</span>assign.pctiles.alt2<span class="token punctuation">(</span>x<span class="token punctuation">,</span>weights<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># PERCENTILE OF ALL, NOT JUST THOSE WITH VALID DATA, IF na.rm=FALSE,</span>
<span class="token comment"># but then NA values preclude high percentiles:</span>
x <span class="token operator">&lt;-</span> c<span class="token punctuation">(</span><span class="token keyword">NA</span><span class="token punctuation">,</span> <span class="token keyword">NA</span><span class="token punctuation">,</span> <span class="token keyword">NA</span><span class="token punctuation">,</span> <span class="token keyword">NA</span><span class="token punctuation">,</span><span class="token keyword">NA</span><span class="token punctuation">,</span><span class="token keyword">NA</span><span class="token punctuation">,</span><span class="token keyword">NA</span><span class="token punctuation">,</span><span class="token keyword">NA</span><span class="token punctuation">,</span><span class="token keyword">NA</span><span class="token punctuation">,</span><span class="token keyword">NA</span><span class="token punctuation">,</span><span class="token number">13</span><span class="token punctuation">,</span><span class="token number">13</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token operator">:</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token number">21</span><span class="token operator">:</span><span class="token number">30</span><span class="token punctuation">)</span>
weights <span class="token operator">&lt;-</span> rep<span class="token punctuation">(</span>c<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> length<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">)</span>
cbind<span class="token punctuation">(</span>weights<span class="token punctuation">,</span> x<span class="token punctuation">,</span> PCTILE.alt2<span class="token operator">=</span>assign.pctiles.alt2<span class="token punctuation">(</span>x<span class="token punctuation">,</span> weights<span class="token punctuation">,</span> na.rm<span class="token operator">=</span><span class="token boolean">FALSE</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
 pctile<span class="token operator">=</span>assign.pctiles<span class="token punctuation">(</span>x<span class="token punctuation">,</span>weights<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">[</span>order<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span>
cbind<span class="token punctuation">(</span>weights<span class="token punctuation">,</span> x<span class="token punctuation">,</span> PCTILE.alt2<span class="token operator">=</span>assign.pctiles.alt2<span class="token punctuation">(</span>x<span class="token punctuation">,</span> weights<span class="token punctuation">,</span> na.rm<span class="token operator">=</span><span class="token boolean">TRUE</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
 pctile<span class="token operator">=</span>assign.pctiles<span class="token punctuation">(</span>x<span class="token punctuation">,</span>weights<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">[</span>order<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span>

V<span class="token operator">=</span><span class="token number">9</span>
sum<span class="token punctuation">(</span>weights<span class="token punctuation">[</span><span class="token operator">!</span>is.na<span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token operator">&amp;</span> x <span class="token operator">&lt;=</span> V<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">/</span> sum<span class="token punctuation">(</span>weights<span class="token punctuation">[</span><span class="token operator">!</span>is.na<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment">#A value (V) being at this PCTILE% means that (assuming na.rm=TRUE):</span>

<span class="token comment"># V &gt;= x  for        PCTILE% of weights     (for non-NA x), so</span>
<span class="token comment"># V &lt; x   for 100% - PCTILE% of weights     (for non-NA x), or</span>
<span class="token comment"># PCTILE% of all weights have V &gt;= x (for non-NA x), so</span>
<span class="token comment"># 100% - PCTILE% of all weights have V &lt; x  (for non-NA x).</span>

x <span class="token operator">&lt;-</span> c<span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">,</span> <span class="token keyword">NA</span><span class="token punctuation">,</span> <span class="token keyword">NA</span><span class="token punctuation">,</span> <span class="token keyword">NA</span><span class="token punctuation">,</span><span class="token keyword">NA</span><span class="token punctuation">,</span><span class="token keyword">NA</span><span class="token punctuation">,</span><span class="token keyword">NA</span><span class="token punctuation">,</span><span class="token keyword">NA</span><span class="token punctuation">,</span><span class="token keyword">NA</span><span class="token punctuation">,</span><span class="token keyword">NA</span><span class="token punctuation">,</span><span class="token number">13</span><span class="token punctuation">,</span><span class="token number">13</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token operator">:</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token keyword">NA</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token number">21</span><span class="token operator">:</span><span class="token number">30</span><span class="token punctuation">)</span>
weights <span class="token operator">&lt;-</span> rep<span class="token punctuation">(</span>c<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> length<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">)</span>
cbind<span class="token punctuation">(</span>weights<span class="token punctuation">,</span> x<span class="token punctuation">,</span> PCTILE.alt2<span class="token operator">=</span>assign.pctiles.alt2<span class="token punctuation">(</span>x<span class="token punctuation">,</span> weights<span class="token punctuation">,</span> na.rm<span class="token operator">=</span><span class="token boolean">FALSE</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
 pctile<span class="token operator">=</span>assign.pctiles<span class="token punctuation">(</span>x<span class="token punctuation">,</span>weights<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">[</span>order<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span>
cbind<span class="token punctuation">(</span>weights<span class="token punctuation">,</span> x<span class="token punctuation">,</span> PCTILE.alt2<span class="token operator">=</span>assign.pctiles.alt2<span class="token punctuation">(</span>x<span class="token punctuation">,</span> weights<span class="token punctuation">,</span> na.rm<span class="token operator">=</span><span class="token boolean">TRUE</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
 pctile<span class="token operator">=</span>assign.pctiles<span class="token punctuation">(</span>x<span class="token punctuation">,</span>weights<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">[</span>order<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="bgtest">

<a href="#bgtest" class="help-page-title"><h2>Test dataset for ejanalysis</h2></a>

<h3>Description</h3>

<p>This data set provides test data, with
Environmental, Demographic, and EJ Index fields,
one row per block group for about 32,698 blockgroups, covering a few states.
This is roughly a subset of ejscreen data like bg21 (see  ejscreen  package).
It does not have of the columns in the ejscreen dataset.
Can be used like this:  data('bgtest', package = 'ejanalysis')
</p>


<h3>See Also</h3>

<p><a>ejscreen::names.d</a> (http://ejanalysis.github.io/ejscreen/)
</p>

<hr>
</div>
<div class="container manual-page" id="clean.fips">

<a href="#clean.fips" class="help-page-title"><h2>Clean up US Census FIPS (Add Missing Leading Zeroes)</h2></a>

<h3>Description</h3>

<p>Clean up US Census FIPS (add any missing leading zeroes)
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">clean.fips<span class="token punctuation">(</span>fips<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table><tr style="vertical-align: top;">
<td><code>fips</code></td>
<td>
<p>Vector of numeric or character class, required. Can be state FIPs as number or character, for example.</p>
</td>
</tr></table>
<h3>Details</h3>

<p>For information on FIPS codes, see <a href="http://www.census.gov/geo/reference/ansi.html" target="_blank">http://www.census.gov/geo/reference/ansi.html</a>,
and also see <a href="https://www.census.gov/geo/reference/geoidentifiers.html" target="_blank">https://www.census.gov/geo/reference/geoidentifiers.html</a> <br><br>
If FIPS provided is 1-2 digits long assume it is a State.<br>
If FIPS provided is 3 digits long, it is a mistake and return NA.<br>
If FIPS provided is 4-5 digits, assume it is a County.<br>
If FIPS provided is 6-9 digits, it is a mistake and return NA.<br>
If FIPS provided is 10 digits long, assume it is a tract missing a leading zero on the state portion (should have 11 characters).<br>
If FIPS provided is 11 digits long, assume it is a tract (correctly 11 characters), not simply a block group FIPS missing a leading zero (block group FIPS would correctly would have 12 characters).<br>
If FIPS provided is 12 digits long, assume it is a block group (correctly 12 characters).<br>
If FIPS provided is 13 digits long, it is a mistake and return NA.<br>
If FIPS provided is 14 OR 15 digits long, assume it is a block.
</p>


<h3>Value</h3>

<p>Returns vector of FIPS (all characters from 2-digit State code onwards as appropriate) as character with leading zeroes
</p>


<h3>See Also</h3>

<p><code><a href="#clean.fips1215">clean.fips1215</a></code>, <code><a href="#get.fips.bg">get.fips.bg</a></code>, <code><a href="#get.fips.tract">get.fips.tract</a></code>, <code><a href="#get.fips.county">get.fips.county</a></code>, <code><a href="#get.fips.st">get.fips.st</a></code> to get partial FIPS from longer FIPS, or
<code><a href="#get.name.county">get.name.county</a></code>, <code><a href="#get.name.state">get.name.state</a></code> to extract name from longer Census name, or
<code><a href="#get.state.info">get.state.info</a></code>, <code><a href="#get.county.info">get.county.info</a></code>, <code><a href="#get.epa.region">get.epa.region</a></code>
to look up info such as FIPS, state abbreviation, statename, countyname, or region based on FIPS or name.
</p>

<hr>
</div>
<div class="container manual-page" id="clean.fips1215">

<a href="#clean.fips1215" class="help-page-title"><h2>Check and clean Census block group or block FIPS - only check number of characters and if NA, not if valid number otherwise</h2></a>

<h3>Description</h3>

<p>Check if valid Census block group or block FIPS, warn if not, add missing leading zero if inferred.
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">clean.fips1215<span class="token punctuation">(</span>fips<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table><tr style="vertical-align: top;">
<td><code>fips</code></td>
<td>
<p>Vector of one or more elements, ideally character class, ideally 12 or 15 characters long (block group or block), required.</p>
</td>
</tr></table>
<h3>Details</h3>

<p>For information on FIPS codes, see <a href="http://www.census.gov/geo/reference/ansi.html" target="_blank">http://www.census.gov/geo/reference/ansi.html</a>,
and also see <a href="https://www.census.gov/geo/reference/geoidentifiers.html" target="_blank">https://www.census.gov/geo/reference/geoidentifiers.html</a>
</p>


<h3>Value</h3>

<p>Returns a vector of one or more character elements, same lengths as fips, NA if NA input
</p>


<h3>See Also</h3>

<p><code><a href="#clean.fips1215">clean.fips1215</a></code>, <code><a href="#get.fips.bg">get.fips.bg</a></code>, <code><a href="#get.fips.tract">get.fips.tract</a></code>, <code><a href="#get.fips.county">get.fips.county</a></code>, <code><a href="#get.fips.st">get.fips.st</a></code> to get partial FIPS from longer FIPS, or
<code><a href="#get.name.county">get.name.county</a></code>, <code><a href="#get.name.state">get.name.state</a></code> to extract name from longer Census name, or
<code><a href="#get.state.info">get.state.info</a></code>, <code><a href="#get.county.info">get.county.info</a></code>, <code><a href="#get.epa.region">get.epa.region</a></code>
to look up info such as FIPS, state abbreviation, statename, countyname, or region based on FIPS or name.
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r">samplefips <span class="token operator">&lt;-</span> c<span class="token punctuation">(</span><span class="token string">"011030001003"</span><span class="token punctuation">,</span> <span class="token string">"011030001003001"</span><span class="token punctuation">,</span> <span class="token number">11030001003001</span><span class="token punctuation">,</span> <span class="token number">35</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">NA</span><span class="token punctuation">,</span> <span class="token string">'invalidtext'</span><span class="token punctuation">,</span> <span class="token string">'02'</span><span class="token punctuation">)</span>
  clean.fips1215<span class="token punctuation">(</span>samplefips<span class="token punctuation">)</span>
  clean.fips1215<span class="token punctuation">(</span><span class="token string">"011030001003001"</span><span class="token punctuation">)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="ej.added">

<a href="#ej.added" class="help-page-title"><h2>Contribution of each place to net excess people-points in demographic group</h2></a>

<h3>Description</h3>

<p>US total sum of net excess vulnerable * E = net excess people-points
and contribution of one place = what the EJ Index intends to indicate
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">ej.added<span class="token punctuation">(</span>e<span class="token punctuation">,</span> d<span class="token punctuation">,</span> p<span class="token punctuation">,</span> vs <span class="token operator">=</span> <span class="token string">"nond"</span><span class="token punctuation">,</span> silent <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>e</code></td>
<td>
<p>Environmental indicator</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>d</code></td>
<td>
<p>Demographic indicator</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>p</code></td>
<td>
<p>Population count (universe for d)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>vs</code></td>
<td>
<p>Reference group, optional, 'nond' by default
which means the reference group is everyone other than the d group (everyone else),
but can also specify 'avg' in which case the overall average value
including the d group is used as the reference value.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>silent</code></td>
<td>
<p>Optional, TRUE by default, in which case more details are printed.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>WORK IN PROGRESS. ! e.g.,  presumes one setting for vs..... ***
Directly calculate total number of excess people-points in a demographic subgroup,
across all locations
**** here by default defining "excess" as above
what it would be if e in d group were same as e in nond group.**** <br>
where people-points are e * p * d <br>
e = environmental points or individual risk (vector of places) <br>
p = population counts (vector of places) <br>
d = demographic fraction that is in specified demographic group (vector of places) <br><br></p>
<p>For example, if e=cancer risk (individual risk) and p=pop and d=%lowincome,
value returned is number of cases among lowincome individuals in excess of what it
would be if their average risk was the same as that of nonlowincome individuals. <br>
net excess vulnerable * E = net excess people-points <br>
vs can be 'avg' or 'nonD' (default) (not case sensitive),  <br>
for, respectively, excess cases relative to risk scenario where  <br>
avg d's e is set to that of avg person (all people including d and nonD), <br>
or avg d's e is set to that of avg nonD person.
</p>


<h3>Value</h3>

<p>Returns numeric vector
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r">x<span class="token operator">=</span>data.frame<span class="token punctuation">(</span>pop<span class="token operator">=</span>rep<span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span> pct<span class="token operator">=</span><span class="token number">0.05</span><span class="token operator">+</span><span class="token number">6</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">100</span><span class="token punctuation">,</span> e<span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">10</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">100</span> <span class="token punctuation">)</span>
y<span class="token operator">=</span>ej.added<span class="token punctuation">(</span>x<span class="token operator">$</span>e<span class="token punctuation">,</span> x<span class="token operator">$</span>pct<span class="token punctuation">,</span> x<span class="token operator">$</span>pop<span class="token punctuation">,</span> silent<span class="token operator">=</span><span class="token boolean">FALSE</span><span class="token punctuation">)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="ej.indexes">

<a href="#ej.indexes" class="help-page-title"><h2>Calculate environmental justice (EJ) index for each place</h2></a>

<h3>Description</h3>

<p>Create an index that combines environmental and demographic indicators for each Census unit (e.g., block group).
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">ej.indexes<span class="token punctuation">(</span>
  env.df<span class="token punctuation">,</span>
  demog<span class="token punctuation">,</span>
  weights<span class="token punctuation">,</span>
  us.demog<span class="token punctuation">,</span>
  universe.us.demog<span class="token punctuation">,</span>
  as.df <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">,</span>
  prefix <span class="token operator">=</span> <span class="token string">"EJ.DISPARITY."</span><span class="token punctuation">,</span>
  type <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span>
  na.rm <span class="token operator">=</span> <span class="token boolean">FALSE</span>
<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>env.df</code></td>
<td>
<p>Environmental indicators vector or numeric data.frame, one column per environmental factor, one row per place (e.g., block group).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>demog</code></td>
<td>
<p>Demographic indicator(s) vector or data.frame, numeric fractions of population that is in specified demographic group
(e.g., fraction below poverty line), one per place.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>weights</code></td>
<td>
<p>Optional, and default is equal weighting. If us.demog and universe.us.demog are not specified, weights are used to find
weighted mean of demog to use as area-wide overall average (e.g., population-weighted average percent Hispanic, for all block groups in USA). One weight per place.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>us.demog</code></td>
<td>
<p>Optional overall area-wide value for demog percentage share of population as fraction 0 to 1
(e.g., US Demographic Indicator).
The correct value to use for EJScreen 2.0, for example, is
with(ejscreen::bg21, ( sum(mins)/sum(pop)  +  sum(lowinc)/sum(povknownratio) ) / 2)
Default is to approximate it as weighted mean of demog,
where the weights are universe.us.demog if specified, or else just 'weights'.
If the weights are population counts and demog is percent Hispanic, for example, us.demog is the percent  of US population that is Hispanic.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>universe.us.demog</code></td>
<td>
<p>Optional numeric vector. If specified and us.demog not specified, used instead of weights to get weighted mean of demog to find area-wide demog.
This should be the actual denominator, or universe, that was used to create percent demog 
universe.us.demog if specified should be a vector that has the count, for each place, of the denominator for finding the US overall percent
and this may be slightly different than total population.
For example if demog=places$pctlowinc then true universe.us.demog=places$povknownratio which is the count for whom poverty ratio is known in each place, which is &lt;= pop.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>as.df</code></td>
<td>
<p>Default is TRUE.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>prefix</code></td>
<td>
<p>Optional character string used as first part of each colname in results. Default is "EJ.DISPARITY."</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>type</code></td>
<td>
<p>Specifies type of EJ Index. Default is type=1. Several formulas are available: <br></p>

<ul>
<li>
<p> For type=1,   ej.indexes = weights * env.df * (demog  - us.demog)  ## This is the EJ Index in EJScreen from 2015-2022. Note: us.demog could also be called d.avg.all, and note that na.rm is currently ignored for type=1
</p>
</li>
<li>
<p> For type=1.5, ej.indexes = weights * env.df * (demog  - d.avg.all.elsewhere) # for a place that is one of many this can be almost identical to type 1 <br></p>
</li>
<li>
<p> For type=2.1, ej.indexes = weights * demog  * (env.df - e.avg.all)  # like type 1 but env and demog roles are swapped <br></p>
</li>
<li>
<p> For type=2,   ej.indexes = weights * demog  * (env.df - e.avg.nond) <br></p>
</li>
<li>
<p> For type=2.5, ej.indexes = weights * demog  * (env.df - e.avg.nond.elsewhere )  <br></p>
</li>
<li>
<p> For type=3,   ej.indexes = weights * ((demog * env.df) - (d.avg.all           * e.avg.nond ) )   <br></p>
</li>
<li>
<p> For type=3.5, ej.indexes = weights * ((demog * env.df) - (d.avg.all.elsewhere * e.avg.nond.elsewhere) )   <br></p>
</li>
<li>
<p> For type 4  , ej.indexes = weights * ((demog - d.avg.all          ) * (env.df - e.avg.nond ) ) <br></p>
</li>
<li>
<p> For type=4.5, ej.indexes = weights * ((demog - d.avg.all.elsewhere) * (env.df - e.avg.nond.elsewhere) ) <br></p>
</li>
<li>
<p> For type=5  , ej.indexes = weights * env.df * demog ## A "Population Risk" or "Burden" index = Number of cases among D group if e is individual risk, or just "people-points among D" if e is "points" <br></p>
</li>
<li>
<p> For type=6,   ej.indexes = env.df *  demog ## A "unweighted" simple product of Envt x percent_D. A "percent-based" indicator = percent in group D times envt indicator  <br></p>
</li>
<li>
<p> For type=7,   ej.indexes = env.df * (demog  - us.demog) # Like type 1 or EJScreen 2.0, but without the pop count in the formula  <br></p>
</li>
</ul>
<p>where
</p>

<ul>
<li>
<p> us.demog = overall demog where avg person lives (pop wtd mean of demog). This may be almost exactly the same as d.avg.all.elsewhere <br></p>
</li>
<li>
<p> d.avg.all            = overall value for d as fraction of entire population (including the one place being analyzed). <br></p>
</li>
<li>
<p> d.avg.all.elsewhere  = overall value for d as fraction of entire population other than the one place being analyzed. <br></p>
</li>
<li>
<p> e.avg.all            =  avg environmental indicator value for average person  <br></p>
</li>
<li>
<p> e.avg.nond           =  avg environmental indicator value for average person who is not in the D-group, among all (including the one place being analyzed). This is typically the expected as opposed to observed value of e within group D, in the context of EJ analysis of disparity in e. <br></p>
</li>
<li>
<p> e.avg.nond.elsewhere =  avg environmental indicator value for average person who is not in the D-group, among all except in the one place being analyzed. <br></p>
</li>
</ul>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>na.rm</code></td>
<td>
<p>Default is FALSE. NOTE: This is complicated but important. See notes in source code about handling NA values in various formulas here.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Creates one EJ index column for each environmental indicator column,
or if given a vector or single column of environmental indicators instead of data.frame, returns a vector or column.
Each "place" can be a Census unit such as a State, County, zip code, tract, block group, block, for example (or even by individual if person-level data are available).<br><br>
Note: For 1.5, 3.5, 4.5 need vector d.avg.all.elsewhere. calculated in each of those.<br></p>

<ul>
<li>
<p> But does not properly handle cases where us.demog or universe.us.demog specified because denominator is not same as pop <br></p>
</li>
<li>
<p> and need to fix for when  is.na(p) | is.na(demog) <br>
Type 2 however does handle NA values appropriately, meaning a result for a given col of env.df is set to NA for a given row <br>
(assuming na.rm=FALSE) if and only if NA is found in that row, in demog or weights or that one col of env.df.
</p>
</li>
</ul>
<h3>Value</h3>

<p>Returns a numeric data.frame (or matrix if <code>as.df=FALSE</code>) of EJ indexes, one per place per environmental indicator.
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r">statedat <span class="token operator">&lt;-</span> data.frame<span class="token punctuation">(</span>state.x77<span class="token punctuation">)</span>
 hist<span class="token punctuation">(</span>myej <span class="token operator">&lt;-</span> ej.indexes<span class="token punctuation">(</span>env.df<span class="token operator">=</span>statedat<span class="token punctuation">[</span> <span class="token punctuation">,</span> c<span class="token punctuation">(</span><span class="token string">'Life.Exp'</span><span class="token punctuation">,</span> <span class="token string">'Frost'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  demog<span class="token operator">=</span>statedat<span class="token operator">$</span>HS.Grad<span class="token operator">/</span><span class="token number">100</span><span class="token punctuation">,</span> weights<span class="token operator">=</span>statedat<span class="token operator">$</span>Population<span class="token punctuation">,</span> prefix<span class="token operator">=</span><span class="token string">'EJtype1.'</span><span class="token punctuation">,</span> type<span class="token operator">=</span><span class="token number">1</span> <span class="token punctuation">)</span><span class="token punctuation">)</span>
 set.seed<span class="token punctuation">(</span><span class="token number">999</span><span class="token punctuation">)</span>
 myej <span class="token operator">&lt;-</span> ej.indexes<span class="token punctuation">(</span>env.df<span class="token operator">=</span>rnorm<span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> demog<span class="token operator">=</span>runif<span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  weights<span class="token operator">=</span>runif<span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">,</span> <span class="token number">5000</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
 myej</code></pre>

<hr>
</div>
<div class="container manual-page" id="ejanalysis">

<a href="#ejanalysis" class="help-page-title"><h2>Tools for Environmental Justice (EJ) Analysis</h2></a>

<h3>Description</h3>

<p>This R package provides tools for environmental justice (EJ) analysis,
including metrics characterizing disparities between demographic groups,
such as differences in environmental or other indicators measured for each Census unit
such as Census blocks, block groups, tracts, zip codes, or counties.
</p>
<p>These tools simplify some basic tasks in
exploring and analyzing a dataset in a matrix or data.frame
that contains data on demographics (e.g., counts of residents in poverty)
and local environmental indicators (e.g., an air quality index),
with one row per spatial location (e.g., Census block group).
Key functions help to find relative risk or similar ratios of means in demographic groups,
, etc.
</p>


<h3>Details</h3>

<p>Key functions include
</p>

<ul>
<li> <p><code><a href="#RR">RR()</a></code>
</p>
</li>
<li> <p><code><a href="#pop.ecdf">pop.ecdf()</a></code>
</p>
</li>
<li> <p><code><a href="#ej.indexes">ej.indexes()</a></code>
</p>
</li>
<li> <p><code><a href="#assign.pctiles">assign.pctiles()</a></code>
</p>
</li>
<li> <p><code><a href="#make.bin.pctile.cols">make.bin.pctile.cols()</a></code>
</p>
</li>
<li> <p><code><a href="#get.county.info">get.county.info()</a></code>
</p>
</li>
<li> <p><code><a href="#state.health.url">state.health.url()</a></code>
</p>
</li>
</ul>
<h3>References</h3>

<p><a href="http://ejanalysis.github.io" target="_blank">http://ejanalysis.github.io</a> <br><a href="http://www.ejanalysis.com/" target="_blank">http://www.ejanalysis.com/</a> <br></p>

<hr>
</div>
<div class="container manual-page" id="ejRRadded">

<a href="#ejRRadded" class="help-page-title"><h2>Formulas for local contributions to EJ metrics</h2></a>

<h3>Description</h3>

<p>Formulas for pop counts, pop demog pct, risk, cases, RR,
excess risk, excess cases (like EJ index sum),
and how those are different under 4 alt scenarios like E of D is set to that of dref.
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">ejRRadded<span class="token punctuation">(</span>E<span class="token punctuation">,</span> D <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> P <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> na.rm <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">,</span> n <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token ellipsis">...</span><span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>E</code></td>
<td>
<p>Environmental indicator (e.g., risk, exposure, or any local indicator, but if it is individual risk then number of cases can be calculated rather than just people-points)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>D</code></td>
<td>
<p>Demographic group per place as fraction of P (default is 1)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>P</code></td>
<td>
<p>Population count per place (default is 1)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>na.rm</code></td>
<td>
<p>Default is TRUE.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n</code></td>
<td>
<p>Default is 5.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>NOT USED. Would pass additional parameters to other functions</p>
</td>
</tr>
</table>
<hr>
</div>
<div class="container manual-page" id="flagged">

<a href="#flagged" class="help-page-title"><h2>Which rows have a value above cutoff in at least one column</h2></a>

<h3>Description</h3>

<p>Flags rows that have values above some cutoff in at least one column.
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">flagged<span class="token punctuation">(</span>df<span class="token punctuation">,</span> cutoff <span class="token operator">=</span> <span class="token number">0.8</span><span class="token punctuation">,</span> or.tied <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>df</code></td>
<td>
<p>Data.frame with numeric values to be checked against the threshold.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cutoff</code></td>
<td>
<p>Number that is the threshold that must be (met or) exceeded for a row to be flagged. Optional, default is 0.80</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>or.tied</code></td>
<td>
<p>Logical, optional, default is TRUE, in which case a value equal to the cutoff also flags the row.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The use of na.rm=TRUE in this function means it will always ignore NA values in a given place and take the max of the valid (non-NA) values instead of returning NA when there is an NA in that row
</p>


<h3>Value</h3>

<p>Returns a logical vector or data.frame the shape of df
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r">set.seed<span class="token punctuation">(</span><span class="token number">999</span><span class="token punctuation">)</span>
places <span class="token operator">&lt;-</span> data.frame<span class="token punctuation">(</span>p1<span class="token operator">=</span>runif<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> p2<span class="token operator">=</span>c<span class="token punctuation">(</span><span class="token keyword">NA</span><span class="token punctuation">,</span> runif<span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> p3<span class="token operator">=</span>runif<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
pctilecols <span class="token operator">&lt;-</span> c<span class="token punctuation">(</span><span class="token string">'p1'</span><span class="token punctuation">,</span><span class="token string">'p2'</span><span class="token punctuation">,</span> <span class="token string">'p3'</span><span class="token punctuation">)</span>
x <span class="token operator">&lt;-</span> flagged<span class="token punctuation">(</span>places<span class="token punctuation">[</span> <span class="token punctuation">,</span> pctilecols<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">0.80</span><span class="token punctuation">)</span>
a <span class="token operator">&lt;-</span> cbind<span class="token punctuation">(</span>any.over.<span class="token number">0.8</span><span class="token operator">=</span>x<span class="token punctuation">,</span> round<span class="token punctuation">(</span>places<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
a<span class="token punctuation">[</span>order<span class="token punctuation">(</span>a<span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="flagged.by">

<a href="#flagged.by" class="help-page-title"><h2>flagged.by</h2></a>

<h3>Description</h3>

<p>Flag which cells are at or above some cutoff.
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">flagged.by<span class="token punctuation">(</span>x<span class="token punctuation">,</span> cutoff<span class="token punctuation">,</span> or.tied<span class="token punctuation">,</span> below<span class="token punctuation">,</span> <span class="token ellipsis">...</span><span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>Data.frame or matrix of numbers to be compared to cutoff value.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cutoff</code></td>
<td>
<p>Numeric. The threshold or cutoff to which numbers are compared. Default is arithmetic mean of row. Usually one number, but can be a vector of same length as number of rows, in which case each row can use a different cutoff.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>or.tied</code></td>
<td>
<p>Logical. Default is FALSE, which means we check if number in x is greater than the cutoff (&gt;). If TRUE, check if greater than or equal (&gt;=).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>below</code></td>
<td>
<p>Logical. Default is FALSE. If TRUE, uses &gt; or &gt;= cutoff. If FALSE, uses &lt; or &lt;= cutoff.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>optional additional parameters to pass to <code><a>analyze.stuff::cols.above.which()</a></code></p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>For a matrix with a few cols of related data, find which cells are at/above (or below) some cutoff.
Returns a logical matrix, with TRUE for each cell that is at/above the cutoff.
Can be used in EJ analysis as 1st step in identifying places (rows) where some indicator(s) is/are at/above a cutoff, threshold value.
</p>


<h3>Value</h3>

<p>Returns a logical matrix the same size as x.
</p>


<h3>Note</h3>

<p>Future work: these functions could have wts, na.rm, &amp; allow cutoffs or benchmarks as a vector (not just 1 number), &amp; have benchnames.
</p>


<h3>See Also</h3>

<p>cols.above.which,  another name for the exact same function.
</p>
<p>cols.above.count or cols.above.pct to see, for each row, count or fraction of columns with numbers at/above/below cutoff.
</p>
<p>flagged.only.by to find cells that are the only one in the row that is at/above/below the cutoff.
</p>
<p>rows.above.count, rows.above.pct, rows.above.which
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r">out <span class="token operator">&lt;-</span> flagged.by<span class="token punctuation">(</span>x<span class="token operator">&lt;-</span>data.frame<span class="token punctuation">(</span>a<span class="token operator">=</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">,</span> b<span class="token operator">=</span>rep<span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span> c<span class="token operator">=</span><span class="token number">7</span><span class="token operator">:</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">,</span> cutoff<span class="token operator">=</span><span class="token number">7</span><span class="token punctuation">)</span>
x<span class="token punctuation">;</span> out <span class="token comment"># default is or.tied=FALSE</span>
out <span class="token operator">&lt;-</span> flagged.by<span class="token punctuation">(</span>data.frame<span class="token punctuation">(</span>a<span class="token operator">=</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">,</span> b<span class="token operator">=</span>rep<span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span> c<span class="token operator">=</span><span class="token number">7</span><span class="token operator">:</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">,</span> cutoff<span class="token operator">=</span><span class="token number">7</span><span class="token punctuation">,</span> or.tied<span class="token operator">=</span><span class="token boolean">TRUE</span><span class="token punctuation">,</span> below<span class="token operator">=</span><span class="token boolean">TRUE</span><span class="token punctuation">)</span>
out
out <span class="token operator">&lt;-</span> flagged.by<span class="token punctuation">(</span>data.frame<span class="token punctuation">(</span>a<span class="token operator">=</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">,</span> b<span class="token operator">=</span>rep<span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span> c<span class="token operator">=</span><span class="token number">7</span><span class="token operator">:</span><span class="token number">16</span><span class="token punctuation">)</span> <span class="token punctuation">)</span>
<span class="token comment"># Compares each number in each row to the row's mean.</span>
out</code></pre>

<hr>
</div>
<div class="container manual-page" id="flagged.only.by">

<a href="#flagged.only.by" class="help-page-title"><h2>flagged.only.by</h2></a>

<h3>Description</h3>

<p>Flag which cells are the only one in the row that is at/above a cutoff (find rows that meet only 1 of several criteria).
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">flagged.only.by<span class="token punctuation">(</span>x<span class="token punctuation">,</span> cutoff <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">,</span> or.tied <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">,</span> below <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>Data.frame or matrix of numbers to be compared to cutoff value.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cutoff</code></td>
<td>
<p>The numeric threshold or cutoff to which numbers are compared. Default is 8! Usually one number, but can be a vector of same length as number of rows, in which case each row can use a different cutoff.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>or.tied</code></td>
<td>
<p>Logical. Default is FALSE, which means we check if number in x is greater than the cutoff (&gt;). If TRUE, check if greater than or equal (&gt;=).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>below</code></td>
<td>
<p>Logical. Default is FALSE. If TRUE, uses &gt; or &gt;= cutoff. If FALSE, uses &lt; or &lt;= cutoff.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>For a data.frame with a few cols of related data, find which cells are the only one in the row that is at/above some cutoff.
This can find rows that meet only 1 of several criteria, for example.
Returns a logical matrix or data.frame, with TRUE for each cell that meets the test.
Can be used in EJ analysis in identifying places (rows) that were only flagged because one of the indicator(s) is at/above a cutoff, threshold value.
For example, if there were four criteria to be met in flagging a location, this function identifies
places that met only one of the criteria, and can show which one was met.
</p>


<h3>Value</h3>

<p>Returns a logical matrix the same size as x.
</p>


<h3>Note</h3>

<p>Future work: these functions could have wts, na.rm, &amp; allow cutoffs or benchmarks as a vector (not just 1 number), &amp; have benchnames.
</p>


<h3>See Also</h3>

<p>flagged.by or cols.above.which to see which cells are at/above/below some cutoff
</p>
<p>cols.above.count to see, for each row, how many columns are at/above some cutoff
</p>
<p>cols.above.percent to see, for each row, what fraction of columns are at/above some cutoff
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r">out <span class="token operator">&lt;-</span> flagged.only.by<span class="token punctuation">(</span>x<span class="token operator">&lt;-</span>data.frame<span class="token punctuation">(</span>a<span class="token operator">=</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">,</span> b<span class="token operator">=</span>rep<span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span> c<span class="token operator">=</span><span class="token number">7</span><span class="token operator">:</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">,</span> cutoff<span class="token operator">=</span><span class="token number">7</span><span class="token punctuation">)</span>
  x<span class="token punctuation">;</span>  out <span class="token comment"># default is or.tied=FALSE</span>
  out <span class="token operator">&lt;-</span> flagged.only.by<span class="token punctuation">(</span>data.frame<span class="token punctuation">(</span>a<span class="token operator">=</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">,</span> b<span class="token operator">=</span>rep<span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span> c<span class="token operator">=</span><span class="token number">7</span><span class="token operator">:</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">,</span> cutoff<span class="token operator">=</span><span class="token number">7</span><span class="token punctuation">,</span>
  or.tied<span class="token operator">=</span><span class="token boolean">TRUE</span><span class="token punctuation">,</span> below<span class="token operator">=</span><span class="token boolean">TRUE</span><span class="token punctuation">)</span>
  out
  out <span class="token operator">&lt;-</span> flagged.only.by<span class="token punctuation">(</span>data.frame<span class="token punctuation">(</span>a<span class="token operator">=</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">,</span> b<span class="token operator">=</span>rep<span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span> c<span class="token operator">=</span><span class="token number">7</span><span class="token operator">:</span><span class="token number">16</span><span class="token punctuation">)</span> <span class="token punctuation">)</span>
  <span class="token comment"># Compares each number in each row to the default cutoff.</span>
  out</code></pre>

<hr>
</div>
<div class="container manual-page" id="geofips">

<a href="#geofips" class="help-page-title"><h2>Convert between FIPS / ANSI codes and Names of U.S. Geographies</h2></a>

<h3>Description</h3>

<p>Tries to interpret vector of one or more FIPS codes and/or names of geographies,
and convert between them.
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">geofips<span class="token punctuation">(</span>x<span class="token punctuation">,</span> to<span class="token punctuation">,</span> clean <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>Required vector of one or more numeric or character FIPS and/or names of geographic locations.
Allowed types are State, County (or equivalent), tract, block group, and block.
Names for tracts, blockgroups, and blocks are not provided or interpreted.
FIPS codes here are all the relevant digits starting with the 2-character state FIPS,
so county fips must be 4-5 digits or characters for example (leading zeroes are inferred where
possible and included in outputs). See <code><a href="#clean.fips">clean.fips()</a></code> for details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>to</code></td>
<td>
<p>Optional. When the to parameter is not specified, then x that appear to be fips are converted to name, and x that appear to be names are converted to fips.
Can specify vector of types of geographies (state, etc.) to convert fips to.
This is useful to find County or State names for a list of tract fips, for example.
The to parameter can be fips (which converts names to any appropriate type of fips),
name (which converts to appropriate type of name based on fips length),
specific type of name including state, county, tract, bg (or blockgroup), or block, or
specific type of fips, including fips.st, fips.county, fips.tract, fips.bg, fips.block.
Names for tracts, blockgroups, and blocks are not provided or interpreted.
Variations also work such as plural and case-insensitive.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>clean</code></td>
<td>
<p>Does not use clean.fips() if FALSE, which helps if the countiesall or other list is not yet updated, for example and lacks some new FIPS code</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>Returns vector of same length as x, containing fips as character elements with any leading zeroes, and/or names of geographies.
</p>


<h3>See Also</h3>

<p><code><a href="#get.fips.st">get.fips.st()</a></code> and related functions noted there, <code><a href="#clean.fips">clean.fips()</a></code>, <code><a href="#get.state.info">get.state.info()</a></code>
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r">geofips<span class="token punctuation">(</span>c<span class="token punctuation">(</span><span class="token string">'NY'</span><span class="token punctuation">,</span> <span class="token string">'Alabama'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span> <span class="token string">'Montgomery County, Maryland'</span><span class="token punctuation">,</span>
    <span class="token string">'01121'</span><span class="token punctuation">,</span> <span class="token number">1121</span><span class="token punctuation">,</span> <span class="token string">'060690006002'</span><span class="token punctuation">,</span> <span class="token number">60690006002</span><span class="token punctuation">,</span> <span class="token string">'011210118001025'</span><span class="token punctuation">)</span>
   geofips<span class="token punctuation">(</span>c<span class="token punctuation">(</span><span class="token string">'01121'</span><span class="token punctuation">,</span> <span class="token string">'Montgomery County, Maryland'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> c<span class="token punctuation">(</span><span class="token string">'state'</span><span class="token punctuation">,</span> <span class="token string">'fips.st'</span><span class="token punctuation">)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="geotype">

<a href="#geotype" class="help-page-title"><h2>Infer Type of Data as FIPS / ANSI Codes or Names of U.S. Geographies</h2></a>

<h3>Description</h3>

<p>Tries to interpret vector of one or more FIPS codes and/or names of geographies.
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">geotype<span class="token punctuation">(</span>x<span class="token punctuation">,</span> cleancounties <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>Required vector of one or more numeric or character FIPS and/or names of geographic locations.
Allowed types are State, County (or equivalent), tract, block group, and block.
Names for tracts, blockgroups, and blocks are not provided or interpreted.
FIPS codes here are all the relevant digits starting with the 2-character state FIPS,
so county fips must be 4-5 digits or characters for example (leading zeroes are inferred where
possible and included in outputs). See <code><a href="#clean.fips">clean.fips()</a></code> for details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cleancounties</code></td>
<td>
<p>whether to try to validate county FIPS based on list that ideally is always up to date</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>***TBD *** Returns *** types as character strings, and maybe cleaned values themselves? ***
</p>


<h3>See Also</h3>

<p><code><a href="#geofips">geofips()</a></code>, <code><a href="#get.fips.st">get.fips.st()</a></code> and related functions noted there, <code><a href="#clean.fips">clean.fips()</a></code>, <code><a href="#get.state.info">get.state.info()</a></code>
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r"><span class="token comment"># none yet</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="get.county.info">

<a href="#get.county.info" class="help-page-title"><h2>Get info on US Counties</h2></a>

<h3>Description</h3>

<p>Function that reports some or all of a table of data
about queried (or all) US Counties (and county equivalents)
for 1 or more counties. Query terms can be 5-digit FIPS,
or  countyname, statename   or just   statename   or just   2-letter state abbrev.
Montgomery, MD   will not work.   Montgomery County, Maryland   will work.
UPDATED 6/2022 TO ACS 2020 COUNTY LIST (this relies on proxistat::countiesall)
</p>
<p>Requested fields can include any of these: ST, countyname, FIPS.COUNTY, statename, fullname
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">get.county.info<span class="token punctuation">(</span>query<span class="token punctuation">,</span> fields <span class="token operator">=</span> <span class="token string">"all"</span><span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>query</code></td>
<td>
<p>Vector of search terms.
Can be county's 5-digit FIPS code(s) (as numbers or strings with numbers),
and also could be 'countyname, statename' (fullname, exactly matching formats in countiesall$fullname, but case insensitive).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fields</code></td>
<td>
<p>Character string optional defaults to 'all' but can specify 'countyname' 'ST' and/or 'FIPS.COUNTY'</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Converted basic data to data, so now can also say data(counties, package="proxistat") or x &lt;- countiesall via lazy loading. <br>
also see various packages like acs package or help( package="choroplethr") <br>
Also see:
<a href="https://www.census.gov/geographies/reference-files/time-series/geo/gazetteer-files.html" target="_blank">https://www.census.gov/geographies/reference-files/time-series/geo/gazetteer-files.html</a>
</p>
<p>Note this other possible list of abbreviations (not used) lacks US, PR, DC:  <br>
require(datasets); state.abb <br>
Note another possible list of States, abbrev, FIPS
which has island areas but not US total and not leading zeroes on FIPS: <br>
require(acs) <br>
print(fips.state) <br></p>


<h3>Value</h3>

<p>Returns a data.frame or vector of results depending on fields selected.
Returns a data.frame (if query has 2+ elements), 'QUERY' as first column, and then all or specified fields of information, covering matching counties,
or NA if certain problems arise.
If no query term, or fields not specified, then all information fields are returned:
QUERY, ST, countyname, FIPS.COUNTY, statename, fullname
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r">testdata <span class="token operator">&lt;-</span> c<span class="token punctuation">(</span><span class="token string">'01001'</span><span class="token punctuation">,</span> <span class="token number">1001</span><span class="token punctuation">,</span> <span class="token string">'1001'</span><span class="token punctuation">,</span> <span class="token string">"Montgomery County, Maryland"</span><span class="token punctuation">,</span> <span class="token string">"Montgomery County, MD"</span><span class="token punctuation">,</span> <span class="token string">'montgomery county, maryland'</span><span class="token punctuation">,</span> <span class="token string">"Montgomery County MD"</span><span class="token punctuation">,</span> <span class="token string">"MontgomeryCountyMD"</span><span class="token punctuation">,</span> <span class="token string">"Montgomery County"</span><span class="token punctuation">,</span> <span class="token string">"NY"</span><span class="token punctuation">)</span>
 testonlystates <span class="token operator">&lt;-</span> c<span class="token punctuation">(</span><span class="token string">'NY'</span><span class="token punctuation">,</span> <span class="token string">'NJ'</span><span class="token punctuation">)</span>
 get.county.info<span class="token punctuation">(</span>testdata<span class="token punctuation">)</span>
 get.county.info<span class="token punctuation">(</span>testonlystates<span class="token punctuation">)</span>
 get.county.info<span class="token punctuation">(</span>c<span class="token punctuation">(</span><span class="token string">'New Jersey'</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="get.epa.region">

<a href="#get.epa.region" class="help-page-title"><h2>Identify EPA Region for given state (or FIPS)</h2></a>

<h3>Description</h3>

<p>Identify US Environmental Protection Agency region(s) containing given state(s) (or via FIPS)
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">get.epa.region<span class="token punctuation">(</span>state<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table><tr style="vertical-align: top;">
<td><code>state</code></td>
<td>
<p>Vector of numeric or character class, required. Can be state FIPs as number or character, 2-character state abbreviation, or full state name</p>
</td>
</tr></table>
<h3>Details</h3>

<p>For EPA Regions, see <a href="http://www2.epa.gov/aboutepa#pane-4" target="_blank">http://www2.epa.gov/aboutepa#pane-4</a> or <a href="http://www2.epa.gov/aboutepa/visiting-regional-office" target="_blank">http://www2.epa.gov/aboutepa/visiting-regional-office</a>.
For information on FIPS codes, see <a href="http://www.census.gov/geo/reference/ansi.html" target="_blank">http://www.census.gov/geo/reference/ansi.html</a>,
and also see <a href="https://www.census.gov/geo/reference/geoidentifiers.html" target="_blank">https://www.census.gov/geo/reference/geoidentifiers.html</a>
</p>


<h3>Value</h3>

<p>Returns a vector of numbers, same length as state
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r">myregions <span class="token operator">&lt;-</span> get.epa.region<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># to see full list</span>
 myregions <span class="token operator">&lt;-</span> get.epa.region<span class="token punctuation">(</span><span class="token string">'DC'</span><span class="token punctuation">)</span> <span class="token comment"># for one state by 2-letter abbreviation</span>
 myregions <span class="token operator">&lt;-</span> get.epa.region<span class="token punctuation">(</span>c<span class="token punctuation">(</span><span class="token string">'AK'</span><span class="token punctuation">,</span> <span class="token string">'NY'</span><span class="token punctuation">,</span> <span class="token string">'PR'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># for a vector of 2-letter abbreviations</span>
 myregions <span class="token operator">&lt;-</span> get.epa.region<span class="token punctuation">(</span>c<span class="token punctuation">(</span><span class="token string">'alaska'</span><span class="token punctuation">,</span> <span class="token string">'new york'</span><span class="token punctuation">,</span> <span class="token string">'puerto rico'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># vector of state names</span>
 myregions <span class="token operator">&lt;-</span> get.epa.region<span class="token punctuation">(</span>c<span class="token punctuation">(</span><span class="token string">'04'</span><span class="token punctuation">,</span> <span class="token string">'36'</span><span class="token punctuation">,</span> <span class="token string">'72'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># FIPS codes, character with leading zero</span>
 myregions <span class="token operator">&lt;-</span> get.epa.region<span class="token punctuation">(</span>c<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">36</span><span class="token punctuation">,</span><span class="token number">72</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># state FIPS codes, numeric with no leading zeroes</span>
 myregions <span class="token operator">&lt;-</span> get.epa.region<span class="token punctuation">(</span>c<span class="token punctuation">(</span><span class="token string">'NY'</span><span class="token punctuation">,</span> <span class="token string">'Ohio'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># CANNOT MIX WAYS TO DEFINE STATES- PICK 1 FORMAT</span>
 <span class="token operator">@</span>template seealsoFIPS</code></pre>

<hr>
</div>
<div class="container manual-page" id="get.fips.bg">

<a href="#get.fips.bg" class="help-page-title"><h2>Get Census block group FIPS from block or block group FIPS</h2></a>

<h3>Description</h3>

<p>Extract partial FIPS code from longer FIPS code
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">get.fips.bg<span class="token punctuation">(</span>fips<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table><tr style="vertical-align: top;">
<td><code>fips</code></td>
<td>
<p>Vector of one or more elements, character class, 12 or 15 characters long FIPS (block group or block), required.</p>
</td>
</tr></table>
<h3>Details</h3>

<p>For information on FIPS codes, see <a href="http://www.census.gov/geo/reference/ansi.html" target="_blank">http://www.census.gov/geo/reference/ansi.html</a>,
and also see <a href="https://www.census.gov/geo/reference/geoidentifiers.html" target="_blank">https://www.census.gov/geo/reference/geoidentifiers.html</a>
It does not check to see if the codes are valid other than counting how many characters each has.
</p>


<h3>Value</h3>

<p>Returns a vector of one or more character elements, same lengths as fips
</p>


<h3>See Also</h3>

<p><code><a href="#clean.fips1215">clean.fips1215</a></code>, <code><a href="#get.fips.bg">get.fips.bg</a></code>, <code><a href="#get.fips.tract">get.fips.tract</a></code>, <code><a href="#get.fips.county">get.fips.county</a></code>, <code><a href="#get.fips.st">get.fips.st</a></code> to get partial FIPS from longer FIPS, or
<code><a href="#get.name.county">get.name.county</a></code>, <code><a href="#get.name.state">get.name.state</a></code> to extract name from longer Census name, or
<code><a href="#get.state.info">get.state.info</a></code>, <code><a href="#get.county.info">get.county.info</a></code>, <code><a href="#get.epa.region">get.epa.region</a></code>
to look up info such as FIPS, state abbreviation, statename, countyname, or region based on FIPS or name.
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r">samplefips <span class="token operator">&lt;-</span> c<span class="token punctuation">(</span><span class="token string">"011030001003"</span><span class="token punctuation">,</span> <span class="token string">"011030001003001"</span><span class="token punctuation">,</span> <span class="token number">11030001003001</span><span class="token punctuation">,</span> <span class="token number">35</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">NA</span><span class="token punctuation">,</span> <span class="token string">'invalidtext'</span><span class="token punctuation">,</span> <span class="token string">'02'</span><span class="token punctuation">)</span>
get.fips.bg<span class="token punctuation">(</span>samplefips<span class="token punctuation">)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="get.fips.county">

<a href="#get.fips.county" class="help-page-title"><h2>Get County FIPS from block or block group FIPS</h2></a>

<h3>Description</h3>

<p>Extract partial FIPS code from longer FIPS code
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">get.fips.county<span class="token punctuation">(</span>fips<span class="token punctuation">,</span> clean <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>fips</code></td>
<td>
<p>Vector of one or more elements, character class, 5, 11, 12 or 15 characters long after missing leading zeroes inferred (county, tract, block group or block), required.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>clean</code></td>
<td>
<p>Does not use clean.fips() if FALSE, which helps if the countiesall or other list is not yet updated, for example and lacks some new FIPS code</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Each fips passed to the function is a FIPS code (see <a href="http://www.census.gov/geo/reference/ansi.html" target="_blank">http://www.census.gov/geo/reference/ansi.html</a>.)
It does not check to see if the codes are valid other than counting how many characters each has if clean=FALSE.
</p>


<h3>Value</h3>

<p>Returns a vector of one or more character elements, same lengths as fips
NA where input cannot be converted to county/tract/block group/block length code, as with state fips as input.
</p>


<h3>See Also</h3>

<p><code><a href="#clean.fips1215">clean.fips1215</a></code>, <code><a href="#get.fips.bg">get.fips.bg</a></code>, <code><a href="#get.fips.tract">get.fips.tract</a></code>, <code><a href="#get.fips.county">get.fips.county</a></code>, <code><a href="#get.fips.st">get.fips.st</a></code> to get partial FIPS from longer FIPS, or
<code><a href="#get.name.county">get.name.county</a></code>, <code><a href="#get.name.state">get.name.state</a></code> to extract name from longer Census name, or
<code><a href="#get.state.info">get.state.info</a></code>, <code><a href="#get.county.info">get.county.info</a></code>, <code><a href="#get.epa.region">get.epa.region</a></code>
to look up info such as FIPS, state abbreviation, statename, countyname, or region based on FIPS or name.
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r">samplefips <span class="token operator">&lt;-</span> c<span class="token punctuation">(</span><span class="token string">"011030001003"</span><span class="token punctuation">,</span> <span class="token string">"011030001003001"</span><span class="token punctuation">,</span> <span class="token number">02610</span><span class="token punctuation">,</span> <span class="token number">11030001003001</span><span class="token punctuation">,</span> <span class="token number">35</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>
 <span class="token keyword">NA</span><span class="token punctuation">,</span> <span class="token string">'invalidtext'</span><span class="token punctuation">,</span> <span class="token string">'02'</span><span class="token punctuation">)</span>
get.fips.county<span class="token punctuation">(</span>samplefips<span class="token punctuation">)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="get.fips.etc">

<a href="#get.fips.etc" class="help-page-title"><h2>Get tract, county, state, region info from US Census block group FIPS codes (unused?)</h2></a>

<h3>Description</h3>

<p>Use US Census block group FIPS codes to get more location information about each block group, such as State and County name.
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">get.fips.etc<span class="token punctuation">(</span>fips<span class="token punctuation">,</span> clean <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>fips</code></td>
<td>
<p>Vector of US Census block group FIPS codes (missing leading zeroes are added).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>clean</code></td>
<td>
<p>Does not use clean.fips() if FALSE, which helps if the countiesall or other list is not yet updated, for example and lacks some new FIPS code</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>Returns a data.frame with these fields: c("FIPS", "FIPS.TRACT", "FIPS.COUNTY", "FIPS.ST", "ST", "countyname", "statename", "REGION")
where FIPS is the input fips, the next few are the first few characters of fips corresponding to tract, county, or state, ST is the 2-letter state abbreviation, statename is state name, countyname is county name, and REGION is USEPA Region 1-10.
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r">x<span class="token operator">=</span>c<span class="token punctuation">(</span><span class="token string">"391670211002"</span><span class="token punctuation">,</span> <span class="token string">"060730185143"</span><span class="token punctuation">,</span> <span class="token string">"261079609003"</span><span class="token punctuation">,</span> <span class="token number">02</span><span class="token punctuation">,</span> <span class="token number">02610</span><span class="token punctuation">,</span>
  <span class="token string">"400353734002"</span><span class="token punctuation">,</span> <span class="token string">"371190030121"</span><span class="token punctuation">,</span> <span class="token string">"250235022001"</span><span class="token punctuation">,</span> <span class="token string">"550439609001"</span><span class="token punctuation">,</span> <span class="token string">"060730170302"</span><span class="token punctuation">)</span>
 get.fips.etc<span class="token punctuation">(</span>x<span class="token punctuation">)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="get.fips.st">

<a href="#get.fips.st" class="help-page-title"><h2>Get State FIPS from block or block group FIPS</h2></a>

<h3>Description</h3>

<p>Extract partial FIPS code from longer FIPS code
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">get.fips.st<span class="token punctuation">(</span>fips<span class="token punctuation">,</span> clean <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>fips</code></td>
<td>
<p>Vector of one or more elements, character class, 12 or 15 characters long (block group or block), required.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>clean</code></td>
<td>
<p>Does not use clean.fips() if FALSE, which helps if the countiesall or other list is not yet updated, for example and lacks some new FIPS code</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>For information on FIPS codes, see <a href="http://www.census.gov/geo/reference/ansi.html" target="_blank">http://www.census.gov/geo/reference/ansi.html</a>,
and also see <a href="https://www.census.gov/geo/reference/geoidentifiers.html" target="_blank">https://www.census.gov/geo/reference/geoidentifiers.html</a>
It does not check to see if the codes are valid other than counting how many characters each has.
</p>


<h3>Value</h3>

<p>Returns a vector of one or more character elements, same lengths as fips
</p>


<h3>See Also</h3>

<p><code><a href="#clean.fips1215">clean.fips1215</a></code>, <code><a href="#get.fips.bg">get.fips.bg</a></code>, <code><a href="#get.fips.tract">get.fips.tract</a></code>, <code><a href="#get.fips.county">get.fips.county</a></code>, <code><a href="#get.fips.st">get.fips.st</a></code> to get partial FIPS from longer FIPS, or
<code><a href="#get.name.county">get.name.county</a></code>, <code><a href="#get.name.state">get.name.state</a></code> to extract name from longer Census name, or
<code><a href="#get.state.info">get.state.info</a></code>, <code><a href="#get.county.info">get.county.info</a></code>, <code><a href="#get.epa.region">get.epa.region</a></code>
to look up info such as FIPS, state abbreviation, statename, countyname, or region based on FIPS or name.
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r">samplefips <span class="token operator">&lt;-</span> c<span class="token punctuation">(</span><span class="token string">"011030001003"</span><span class="token punctuation">,</span> <span class="token string">"011030001003001"</span><span class="token punctuation">,</span> <span class="token number">02610</span><span class="token punctuation">,</span> <span class="token number">11030001003001</span><span class="token punctuation">,</span> <span class="token number">35</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>
 <span class="token keyword">NA</span><span class="token punctuation">,</span> <span class="token string">'invalidtext'</span><span class="token punctuation">,</span> <span class="token string">'02'</span><span class="token punctuation">)</span>
get.fips.st<span class="token punctuation">(</span>samplefips<span class="token punctuation">)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="get.fips.tract">

<a href="#get.fips.tract" class="help-page-title"><h2>Get Census tract FIPS from block or block group FIPS</h2></a>

<h3>Description</h3>

<p>Extract partial FIPS code from longer FIPS code
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">get.fips.tract<span class="token punctuation">(</span>fips<span class="token punctuation">,</span> clean <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>fips</code></td>
<td>
<p>Vector of one or more elements, character class, 11, 12 or 15 characters long after missing leading zeroes inferred (tract, block group or block), required.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>clean</code></td>
<td>
<p>Does not use clean.fips() if FALSE, which helps if the countiesall or other list is not yet updated, for example and lacks some new FIPS code</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>For information on FIPS codes, see <a href="http://www.census.gov/geo/reference/ansi.html" target="_blank">http://www.census.gov/geo/reference/ansi.html</a>,
and also see <a href="https://www.census.gov/geo/reference/geoidentifiers.html" target="_blank">https://www.census.gov/geo/reference/geoidentifiers.html</a>
It does not check to see if the codes are valid other than counting how many characters each has.
</p>


<h3>Value</h3>

<p>Returns a vector of one or more character elements, same lengths as fips.
NA where input cannot be converted to tract/block group/block length code, as with county or state fips as input.
</p>


<h3>See Also</h3>

<p><code><a href="#clean.fips1215">clean.fips1215</a></code>, <code><a href="#get.fips.bg">get.fips.bg</a></code>, <code><a href="#get.fips.tract">get.fips.tract</a></code>, <code><a href="#get.fips.county">get.fips.county</a></code>, <code><a href="#get.fips.st">get.fips.st</a></code> to get partial FIPS from longer FIPS, or
<code><a href="#get.name.county">get.name.county</a></code>, <code><a href="#get.name.state">get.name.state</a></code> to extract name from longer Census name, or
<code><a href="#get.state.info">get.state.info</a></code>, <code><a href="#get.county.info">get.county.info</a></code>, <code><a href="#get.epa.region">get.epa.region</a></code>
to look up info such as FIPS, state abbreviation, statename, countyname, or region based on FIPS or name.
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r">samplefips <span class="token operator">&lt;-</span> c<span class="token punctuation">(</span><span class="token string">"011030001003"</span><span class="token punctuation">,</span> <span class="token string">"011030001003001"</span><span class="token punctuation">,</span> <span class="token number">02610</span><span class="token punctuation">,</span> <span class="token number">11030001003001</span><span class="token punctuation">,</span> <span class="token number">35</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>
 <span class="token keyword">NA</span><span class="token punctuation">,</span> <span class="token string">'invalidtext'</span><span class="token punctuation">,</span> <span class="token string">'02'</span><span class="token punctuation">)</span>
get.fips.tract<span class="token punctuation">(</span>samplefips<span class="token punctuation">)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="get.name.county">

<a href="#get.name.county" class="help-page-title"><h2>Extract county name from Census geo name field</h2></a>

<h3>Description</h3>

<p>Parse text names of places from Census Bureau datasets like American Community Survey 5-year Summary File.
Extracts partial (e.g., just state or county name) text name of a place from the full Census text name of a place.
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">get.name.county<span class="token punctuation">(</span>placename<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table><tr style="vertical-align: top;">
<td><code>placename</code></td>
<td>
<p>character vector, required, with text names of places from Census Bureau,
such as 'Block Group 1, Census Tract 1, Aleutians East Borough, Alaska'</p>
</td>
</tr></table>
<h3>Details</h3>

<p>Inputs can be tracts or block groups as in the relevant ACS summary files, possibly others at some point.  <br>
For tracts, there are only 3 parts to placename (tract, county, state)  <br>
For block groups, there are 4 parts to placename (block group, tract, county, state) <br>
Note that County names are not unique  the same County name may exist in 2+ States. <br>
also see <a href="http://www.census.gov/geo/reference/ansi.html" target="_blank">http://www.census.gov/geo/reference/ansi.html</a>  <br>
See <a href="http://www.census.gov/geo/reference/codes/files/national_county.txt" target="_blank">http://www.census.gov/geo/reference/codes/files/national_county.txt</a> but file has moved
Note old code was in GET COUNTY NAMES FROM NHGIS DATASET.R
</p>


<h3>Value</h3>

<p>character vector of names
</p>


<h3>See Also</h3>

<p><code><a href="#clean.fips1215">clean.fips1215</a></code>, <code><a href="#get.fips.bg">get.fips.bg</a></code>, <code><a href="#get.fips.tract">get.fips.tract</a></code>, <code><a href="#get.fips.county">get.fips.county</a></code>, <code><a href="#get.fips.st">get.fips.st</a></code> to get partial FIPS from longer FIPS, or
<code><a href="#get.name.county">get.name.county</a></code>, <code><a href="#get.name.state">get.name.state</a></code> to extract name from longer Census name, or
<code><a href="#get.state.info">get.state.info</a></code>, <code><a href="#get.county.info">get.county.info</a></code>, <code><a href="#get.epa.region">get.epa.region</a></code>
to look up info such as FIPS, state abbreviation, statename, countyname, or region based on FIPS or name.
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r"><span class="token comment"># Test data where some are block groups and some are tracts,</span>
<span class="token comment"># as in file downloaded from Census FTP site for ACS 5-year Summary File:</span>

testnames <span class="token operator">&lt;-</span> c<span class="token punctuation">(</span>
  <span class="token string">'Block Group 1, Census Tract 1, Aleutians East Borough, Alaska'</span><span class="token punctuation">,</span>
  <span class="token string">'Block Group 2, Census Tract 1, Aleutians East Borough, Alaska'</span><span class="token punctuation">,</span>
  <span class="token string">'Block Group 1, Census Tract 2, Aleutians West Census Area, Alaska'</span><span class="token punctuation">,</span>
  <span class="token string">'Block Group 2, Census Tract 2, Aleutians West Census Area, Alaska'</span><span class="token punctuation">,</span>
  <span class="token string">'Block Group 1, Census Tract 2.01, Anchorage Municipality, Alaska'</span><span class="token punctuation">,</span>
  <span class="token string">'Census Tract 1, Aleutians East Borough, Alaska'</span><span class="token punctuation">,</span>
  <span class="token string">'Census Tract 2, Aleutians West Census Area, Alaska'</span><span class="token punctuation">,</span>
  <span class="token string">'Census Tract 2.01, Anchorage Municipality, Alaska'</span><span class="token punctuation">)</span>
testnames <span class="token operator">&lt;-</span> rep<span class="token punctuation">(</span>testnames<span class="token punctuation">,</span> floor<span class="token punctuation">(</span><span class="token number">280000</span><span class="token operator">/</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

mynames1 <span class="token operator">&lt;-</span> get.name.state<span class="token punctuation">(</span>testnames<span class="token punctuation">)</span>
head<span class="token punctuation">(</span>mynames1<span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span>
mynames2 <span class="token operator">&lt;-</span> get.name.county<span class="token punctuation">(</span>testnames<span class="token punctuation">)</span>
head<span class="token punctuation">(</span>mynames2<span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="get.name.state">

<a href="#get.name.state" class="help-page-title"><h2>Extract state name from Census geo name field</h2></a>

<h3>Description</h3>

<p>Parse text names of places from Census Bureau datasets like American Community Survey 5-year Summary File.
Extracts partial (e.g., just state or county name) text name of a place from the full Census text name of a place.
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">get.name.state<span class="token punctuation">(</span>placename<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table><tr style="vertical-align: top;">
<td><code>placename</code></td>
<td>
<p>character vector, required, with text names of places from Census Bureau,
such as 'Block Group 1, Census Tract 1, Aleutians East Borough, Alaska'</p>
</td>
</tr></table>
<h3>Details</h3>

<p>Inputs can be tracts or block groups as in the relevant ACS summary files, possibly others at some point.  <br>
For tracts, there are only 3 parts to placename (tract, county, state)  <br>
For block groups, there are 4 parts to placename (block group, tract, county, state) <br>
Note that County names are not unique  the same County name may exist in 2+ States. <br>
also see http://www.census.gov/geo/reference/ansi.html  <br>
See <a href="http://www.census.gov/geo/reference/codes/files/national_county.txt" target="_blank">http://www.census.gov/geo/reference/codes/files/national_county.txt</a> but file has moved
Note old code was in GET COUNTY NAMES FROM NHGIS DATASET.R
</p>


<h3>Value</h3>

<p>character vector of names
</p>


<h3>See Also</h3>

<p><code><a href="#clean.fips1215">clean.fips1215</a></code>, <code><a href="#get.fips.bg">get.fips.bg</a></code>, <code><a href="#get.fips.tract">get.fips.tract</a></code>, <code><a href="#get.fips.county">get.fips.county</a></code>, <code><a href="#get.fips.st">get.fips.st</a></code> to get partial FIPS from longer FIPS, or
<code><a href="#get.name.county">get.name.county</a></code>, <code><a href="#get.name.state">get.name.state</a></code> to extract name from longer Census name, or
<code><a href="#get.state.info">get.state.info</a></code>, <code><a href="#get.county.info">get.county.info</a></code>, <code><a href="#get.epa.region">get.epa.region</a></code>
to look up info such as FIPS, state abbreviation, statename, countyname, or region based on FIPS or name.
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r"><span class="token comment"># Test data where some are block groups and some are tracts,</span>
<span class="token comment"># as in file downloaded from Census FTP site for ACS 5-year Summary File:</span>

testnames <span class="token operator">&lt;-</span> c<span class="token punctuation">(</span>
  <span class="token string">'Block Group 1, Census Tract 1, Aleutians East Borough, Alaska'</span><span class="token punctuation">,</span>
  <span class="token string">'Block Group 2, Census Tract 1, Aleutians East Borough, Alaska'</span><span class="token punctuation">,</span>
  <span class="token string">'Block Group 1, Census Tract 2, Aleutians West Census Area, Alaska'</span><span class="token punctuation">,</span>
  <span class="token string">'Block Group 2, Census Tract 2, Aleutians West Census Area, Alaska'</span><span class="token punctuation">,</span>
  <span class="token string">'Block Group 1, Census Tract 2.01, Anchorage Municipality, Alaska'</span><span class="token punctuation">,</span>
  <span class="token string">'Census Tract 1, Aleutians East Borough, Alaska'</span><span class="token punctuation">,</span>
  <span class="token string">'Census Tract 2, Aleutians West Census Area, Alaska'</span><span class="token punctuation">,</span>
  <span class="token string">'Census Tract 2.01, Anchorage Municipality, Alaska'</span><span class="token punctuation">)</span>
testnames <span class="token operator">&lt;-</span> rep<span class="token punctuation">(</span>testnames<span class="token punctuation">,</span> floor<span class="token punctuation">(</span><span class="token number">280000</span><span class="token operator">/</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

mynames1 <span class="token operator">&lt;-</span> get.name.state<span class="token punctuation">(</span>testnames<span class="token punctuation">)</span>
head<span class="token punctuation">(</span>mynames1<span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span>
mynames2 <span class="token operator">&lt;-</span> get.name.county<span class="token punctuation">(</span>testnames<span class="token punctuation">)</span>
head<span class="token punctuation">(</span>mynames2<span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="get.pctile">

<a href="#get.pctile" class="help-page-title"><h2>Determine (Weighted) Percentiles</h2></a>

<h3>Description</h3>

<p>Given a vector of numbers (a dataset), and one or more specific values of interest,
determine at what percentile(s) are those selected values. In other words,
what fraction of all of the numbers (actually weighted based on cumulative sum of weights)
are smaller than (or tied with) the selected value(s) of interest?
Based on analyze.stuff::pct.above (<code><a>analyze.stuff::pct.above()</a></code>)
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">get.pctile<span class="token punctuation">(</span>x<span class="token punctuation">,</span> values<span class="token punctuation">,</span> wts <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> or.tied <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">,</span> na.rm <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>Vector of numeric values (the distribution within which percentiles are sought)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>values</code></td>
<td>
<p>Required vector of one or more numbers for which percentiles are sought.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>wts</code></td>
<td>
<p>Optional weights, default is 1 (equal weighting). Useful to find for example what percent of people have an x score (at or) below a given value.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>or.tied</code></td>
<td>
<p>Default is TRUE which means percentile represents what fraction have x at or below value, not just below value.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>na.rm</code></td>
<td>
<p>Logical, optional, TRUE by default. Should NA values (missing data) be removed first to get percentile of those with valid (nonmissing) data.</p>
</td>
</tr>
</table>
<h3>See Also</h3>

<p><code><a href="#make.bin.pctile.cols">make.bin.pctile.cols</a></code> to call functions below, converting columns of values to percentiles and then bins <br><code><a href="#assign.pctiles">assign.pctiles</a></code> for one vector, assign (weighted) percentile (quantile) to each value within its zone (subset)  <br><code><a href="#assign.pctiles.alt2">assign.pctiles.alt2</a></code> as an alternative method, to replicate assign.pctiles, but not by zone <br><code><a href="#get.pctile">get.pctile</a></code> to get (weighted) percentile of just 1+ values within given vector of values <br><code><a href="#make.pctile.cols">make.pctile.cols</a></code> for a data.frame, assign percentiles, return a same-sized df that is wtd.quantile of each value within its column <br><code><a href="#make.pctile.cols.alt2">make.pctile.cols.alt2</a></code> as an alternative method, to replicate make.pctile.cols <br><code><a href="#assign.map.bins">assign.map.bins</a></code> for one vector (or data.frame) of values (e.g. percentiles), return same-sized df that is bin number (map color bin) using preset breaks. <br><code><a href="#make.bin.cols">make.bin.cols</a></code> for a data.frame of values (e.g. percentiles), return same-sized df that is bin number (map color bin) using preset breaks. <br><code><a href="#write.pctiles">write.pctiles</a></code> to save file that is lookup table of percentiles for columns of a data.frame <br><code><a href="#write.pctiles.by.zone">write.pctiles.by.zone</a></code> to save file that is lookup table of percentiles for columns of a data.frame, for each geographic zone (subset of rows) <br><code><a href="#write.wtd.pctiles">write.wtd.pctiles</a></code> to save file that is lookup table of weighted percentiles for columns of a data.frame <br><code><a href="#write.wtd.pctiles.by.zone">write.wtd.pctiles.by.zone</a></code> to save file that is lookup table of weighted percentiles for columns of a data.frame, for each geographic zone (subset of rows) <br><code><a href="#lookup.pctile">lookup.pctile</a></code> to look up current approx weighted percentiles in a lookup table that is already in global memory <br></p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r">get.pctile<span class="token punctuation">(</span><span class="token number">89</span><span class="token operator">:</span><span class="token number">95</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token operator">:</span><span class="token number">100</span><span class="token punctuation">)</span>
get.pctile<span class="token punctuation">(</span><span class="token number">89</span><span class="token operator">:</span><span class="token number">95</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token operator">:</span><span class="token number">100</span><span class="token punctuation">,</span> c<span class="token punctuation">(</span>rep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">90</span><span class="token punctuation">)</span><span class="token punctuation">,</span> rep<span class="token punctuation">(</span><span class="token number">10000</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="get.state.info">

<a href="#get.state.info" class="help-page-title"><h2>Get information on U.S. State(s)</h2></a>

<h3>Description</h3>

<p>Query information about States, from proxistat package data in data(lookup.states, package='proxistat')
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">get.state.info<span class="token punctuation">(</span>query<span class="token punctuation">,</span> fields <span class="token operator">=</span> <span class="token string">"all"</span><span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>query</code></td>
<td>
<p>vector of 1+ elements, which can be <br>
state FIPS code(s) (as numbers or strings with numbers), <br>
state name(s) (exactly matching formats here), or <br>
2-letter state abbreviation(s) (case insensitive). <br></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fields</code></td>
<td>
<p>vector of 1+ character string names of the fields available here:
FIPS.ST, ST, statename, ftpname, REGION, is.usa.plus.pr, is.usa, is.state, is.contiguous.us, is.island.areas, and others (see below)</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>See <a>proxistat::proxistat-package</a> for data source (<a href="http://ejanalysis.github.io/proxistat/" target="_blank">http://ejanalysis.github.io/proxistat/</a>)
For 1+ or all US States plus DC, PR, Island Areas (and USA overall for use in FTP URL):<br><br>
EPA Region, FIPS, State name, abbreviation for State(s); based on any of these query methods: <br><br>
State's FIPS, State's name, OR State's abbreviation, (i.e.,  FIPS.ST, statename, or ST). <br><br>
Also see data in packages <a href="https://eglenn.r-universe.dev/manual/acs.html#acs-package">acs</a> and choroplethr <br><br>
Also see <a href="http://www.census.gov/geo/reference/docs/state.txt" target="_blank">http://www.census.gov/geo/reference/docs/state.txt</a> and <a href="http://www.census.gov/geo/reference/ansi.html" target="_blank">http://www.census.gov/geo/reference/ansi.html</a> <br>
# Note on definitions of is.usa, is.contiguous.us, etc.:  <br><a href="https://www.census.gov/geo/reference/gtc/gtc_usa.html" target="_blank">https://www.census.gov/geo/reference/gtc/gtc_usa.html</a> <br><a href="https://www.census.gov/geo/reference/gtc/gtc_codes.html" target="_blank">https://www.census.gov/geo/reference/gtc/gtc_codes.html</a> <br><a href="https://www.census.gov/geo/reference/gtc/gtc_island.html" target="_blank">https://www.census.gov/geo/reference/gtc/gtc_island.html</a> <br><a href="http://en.wikipedia.org/wiki/Contiguous_United_States" target="_blank">http://en.wikipedia.org/wiki/Contiguous_United_States</a> <br><br>
Also note this other possible list of abbreviations (not used) lacks US, PR, DC: <br>
require(datasets); state.abb <br><br>
Note another possible list of States, abbrev, FIPS <br>
which has island areas but not US total and not leading zeroes on FIPS: <br>
require(acs) <br>
print(fips.state) <br><br>
Note FIPS were also available here: <br>
State: <a href="http://www.census.gov/geo/reference/ansi_statetables.html" target="_blank">http://www.census.gov/geo/reference/ansi_statetables.html</a>  <br>
County: <a href="http://www.census.gov/geo/www/codes/county/download.html" target="_blank">http://www.census.gov/geo/www/codes/county/download.html</a>  <br><br>
Also see <a href="https://www.census.gov/geo/reference/state-area.html" target="_blank">https://www.census.gov/geo/reference/state-area.html</a> for info on state area and internal point
</p>


<h3>Value</h3>

<p>A data.frame (if query has 2+ elements), providing all or specified fields of information, covering matching states/dc/pr/island areas,
a vector of the same type of information for just one place (if only 1 query term, i.e., one element in the query vector is provided),
or NA if certain problems arise.<br><br>
If no query term, or fields not specified, then all information fields are returned: <br>
get.state.info()1:2, <br><br>
statename FIPS.ST ST ftpname REGION is.usa.plus.pr is.usa is.state is.contiguous.us <br>
1   Alabama      01 AL Alabama      4           TRUE   TRUE     TRUE             TRUE <br>
2    Alaska      02 AK  Alaska     10           TRUE   TRUE     TRUE            FALSE <br><br></p>
<p>is.island.areas area.sqmi area.sqkm landarea.sqmi landarea.sqkm waterarea.sqmi waterarea.sqkm <br>
1           FALSE     52420    135767         50645        131171           1775           4597 <br>
2           FALSE    665384   1723337        570641       1477953          94743         245383 <br><br></p>
<p>inland.sqmi inland.sqkm coastal.sqmi coastal.sqkm greatlakes.sqmi greatlakes.sqkm <br>
1        1058        2740          517         1340               0               0 <br>
2       19304       49997        26119        67647               0               0 <br><br></p>
<p>territorial.sqmi territorial.sqkm      lat        lon <br>
1              199              516 32.73963  -86.84346 <br>
2            49320           127739 63.34619 -152.83707 <br></p>


<h3>See Also</h3>

<p><code><a href="#clean.fips1215">clean.fips1215</a></code>, <code><a href="#get.fips.bg">get.fips.bg</a></code>, <code><a href="#get.fips.tract">get.fips.tract</a></code>, <code><a href="#get.fips.county">get.fips.county</a></code>, <code><a href="#get.fips.st">get.fips.st</a></code> to get partial FIPS from longer FIPS, or
<code><a href="#get.name.county">get.name.county</a></code>, <code><a href="#get.name.state">get.name.state</a></code> to extract name from longer Census name, or
<code><a href="#get.state.info">get.state.info</a></code>, <code><a href="#get.county.info">get.county.info</a></code>, <code><a href="#get.epa.region">get.epa.region</a></code>
to look up info such as FIPS, state abbreviation, statename, countyname, or region based on FIPS or name.
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r"><span class="token comment"># data(lookup.states, package='proxistat')</span>
<span class="token comment"># x &lt;- get.state.info(); str(x); cat('\n'); x[ 1:2, ]</span>
<span class="token comment"># get.state.info(c('alaska','north carolina', 'montana', "hawaii"),</span>
 fields<span class="token operator">=</span>c<span class="token punctuation">(</span><span class="token string">'ST'</span><span class="token punctuation">,</span><span class="token string">'statename'</span><span class="token punctuation">,</span><span class="token string">'REGION'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># get.state.info('DC'); get.state.info('U.S. Virgin Islands'); get.state.info(4)</span>
<span class="token comment"># get.state.info(c('New york','alaska','North Carolina','MONTANA', 'typo'))</span>
<span class="token comment"># get.state.info(c('ny','DC','AK','mt', 'PR'))</span>
<span class="token comment"># get.state.info( c(36, 36, 'ny', '  ny', 'ny  ', 'California', 'DC','AK','mt', 'PR',</span>
 <span class="token string">'02'</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'North carolina'</span><span class="token punctuation">)</span> <span class="token punctuation">)</span>
<span class="token comment"># get.state.info(1:80)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="KolmPollak">

<a href="#KolmPollak" class="help-page-title"><h2>Kolm-Pollak Inequality Index adjustable for indexing inequality in bad outcomes</h2></a>

<h3>Description</h3>

<p>This is a simple wrapper for the ineq::Kolm function, but
it makes explicit the need to transform x first if x measures a harm or cost.
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">KolmPollak<span class="token punctuation">(</span>x<span class="token punctuation">,</span> parameter <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> na.rm <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">,</span> bigbadx <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>Same as in <code><a href="https://zeileis.r-universe.dev/manual/ineq.html#ineq">ineq::Kolm()</a></code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>parameter</code></td>
<td>
<p>Same as in <code><a href="https://zeileis.r-universe.dev/manual/ineq.html#ineq">ineq::Kolm()</a></code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>na.rm</code></td>
<td>
<p>Same as in <code><a href="https://zeileis.r-universe.dev/manual/ineq.html#ineq">ineq::Kolm()</a></code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>bigbadx</code></td>
<td>
<p>Optional, default is FALSE. Setting bigbadx = TRUE means bigger x values are bad, as in the case of x measuring levels of risk to health, or exposure to a pollutant.
If bigbadx=TRUE, the x values are first transformed into 0 - x</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The Kolm-Pollak inequality index is provided by the package <a href="https://zeileis.r-universe.dev/manual/ineq.html#ineq">ineq</a>
but that index is only suitable for use with a variable where larger values are preferred, such as with income.
The need for this type of transformation is noted by Maguire and Sheriff (2011) in <a href="http://dx.doi.org/10.3390/ijerph8051707" target="_blank">http://dx.doi.org/10.3390/ijerph8051707</a>
Many variables represent negative outcomes, such as measures of risks to health, or costs.
For those types of variables, the variable should first be transformed by multiplying it by negative one.
This function does that when a parameter is set appropriately. <br><br>
The typical KP index says inequality is <strong>worse if some incomes are very low</strong>
(than if some are very high). The adjusted KP index says
inequality is <strong>worse if some costs or health risks are very high</strong>
(than if some are very low).
</p>


<h3>Value</h3>

<p>This returns what Kolm does, except if bigbadx=TRUE it first transforms x.
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r"><span class="token comment"># Typical KP index says</span>
 <span class="token comment">#   inequality is worse</span>
 <span class="token comment">#   if some incomes are very low</span>
 <span class="token comment">#   (than if some are very high):</span>
 KolmPollak<span class="token punctuation">(</span>c<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> bigbadx <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">)</span> <span class="token comment">#[1] 2.577229</span>
 KolmPollak<span class="token punctuation">(</span>c<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> bigbadx <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">)</span> <span class="token comment">#[1] 1.549793</span>

 <span class="token comment"># Adjusted KP index says</span>
 <span class="token comment">#   inequality is worse</span>
 <span class="token comment">#   if some costs or health risks are very high</span>
 <span class="token comment">#   (than if some are very low):</span>
 KolmPollak<span class="token punctuation">(</span>c<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> bigbadx <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">)</span> <span class="token comment">#[1] 2.577229</span>
 KolmPollak<span class="token punctuation">(</span>c<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> bigbadx <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">)</span> <span class="token comment">#[1] 1.549793</span>

 set.seed<span class="token punctuation">(</span><span class="token number">99</span><span class="token punctuation">)</span>
 x<span class="token operator">=</span>rep<span class="token punctuation">(</span>c<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token operator">*</span>rnorm<span class="token punctuation">(</span>mean<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> sd<span class="token operator">=</span><span class="token number">0.2</span><span class="token punctuation">,</span> n<span class="token operator">=</span><span class="token number">50</span><span class="token operator">*</span><span class="token number">3</span><span class="token punctuation">)</span>
 ineq<span class="token operator">::</span>Kolm<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
 KolmPollak<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
 KolmPollak<span class="token punctuation">(</span>x<span class="token punctuation">,</span> bigbadx <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="lookup.pctile">

<a href="#lookup.pctile" class="help-page-title"><h2>Find approx wtd percentiles in lookup table that is in memory</h2></a>

<h3>Description</h3>

<p>This is used with lookup or us, a data.frame that is a lookup table created by
<code><a href="#write.pctiles">write.pctiles()</a></code>, <code><a href="#write.pctiles.by.zone">write.pctiles.by.zone()</a></code>, <code><a href="#write.wtd.pctiles">write.wtd.pctiles()</a></code>, or <code><a href="#write.wtd.pctiles.by.zone">write.wtd.pctiles.by.zone()</a></code>.
The data.frame us or lookup must have a field called "PCTILE" that contains quantiles/percentiles
and other column(s) with values that fall at those percentiles.
This function accepts lookup table (or uses one called us if that is in memory),
and finds the number in the PCTILE column that corresponds to where a specified value (in myvector)
appears in the column called varname.in.lookup.table.
The function just looks for where the specified value fits between values in the lookup table and returns the approximate percentile as found in the PCTILE column.
If the value is between the cutpoints listed as percentiles 89 and 90, it returns 89, for example.
If the value is exactly equal to the cutpoint listed as percentile 90, it returns percentile 90.
If the value is less than the cutpoint listed as percentile 0, which should be the minimum value in the dataset,
it still returns 0 as the percentile, but with a warning that the value checked was less than the minimum in the dataset.
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">lookup.pctile<span class="token punctuation">(</span>myvector<span class="token punctuation">,</span> varname.<span class="token keyword">in</span>.lookup.table<span class="token punctuation">,</span> lookup<span class="token punctuation">,</span> zone<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>myvector</code></td>
<td>
<p>Numeric vector, required. Values to look for in the lookup table.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>varname.in.lookup.table</code></td>
<td>
<p>Character element, required. Name of column in lookup table to look in to find interval where a given element of myvector values is.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lookup</code></td>
<td>
<p>Either lookup must be specified, or a lookup table called us must already be in memory. This is the lookup table data.frame with a PCTILE column and column whose name is the value of varname.in.lookup.table.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>zone</code></td>
<td>
<p>Character element (or vector as long as myvector), optional. If specified, must appear in a column called REGION within the lookup table. For example, it could be 'NY' for New York State.</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>By default, returns numeric vector length of myvector.
</p>


<h3>See Also</h3>

<p><code><a href="#write.pctiles">write.pctiles()</a></code>, <code><a href="#write.pctiles.by.zone">write.pctiles.by.zone()</a></code>, <code><a href="#write.wtd.pctiles">write.wtd.pctiles()</a></code>, and <code><a href="#write.wtd.pctiles.by.zone">write.wtd.pctiles.by.zone()</a></code>
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r">lookup.pctile<span class="token punctuation">(</span>myvector <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">99</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">,</span> <span class="token number">801</span><span class="token punctuation">,</span> <span class="token number">949.9</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">,</span> <span class="token number">99999</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    lookup <span class="token operator">=</span> data.frame<span class="token punctuation">(</span>PCTILE <span class="token operator">=</span> <span class="token number">0</span><span class="token operator">:</span><span class="token number">100</span><span class="token punctuation">,</span>
    myvar <span class="token operator">=</span> <span class="token number">10</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token operator">:</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    REGION <span class="token operator">=</span> <span class="token string">'USA'</span><span class="token punctuation">,</span> stringsAsFactors <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">)</span><span class="token punctuation">,</span> varname.<span class="token keyword">in</span>.lookup.table <span class="token operator">=</span> <span class="token string">'myvar'</span><span class="token punctuation">)</span>
 <span class="token comment">## Not run: </span>
   What is environmental score at given percentile?
 ejanalysis<span class="token operator">::</span>lookup.pctile<span class="token punctuation">(</span><span class="token number">40</span><span class="token punctuation">,</span><span class="token string">'cancer'</span><span class="token punctuation">,</span>lookupUSA<span class="token punctuation">)</span>
 <span class="token comment">#   84</span>
 ejanalysis<span class="token operator">::</span>lookup.pctile<span class="token punctuation">(</span><span class="token number">40</span><span class="token punctuation">,</span><span class="token string">'cancer'</span><span class="token punctuation">,</span>lookupStates<span class="token punctuation">,</span><span class="token string">'WV'</span><span class="token punctuation">)</span>
 <span class="token comment">#   93</span>
 <span class="token comment">#    What is percentile of given environmental score?</span>
 ejscreen<span class="token operator">::</span>lookupUSA<span class="token punctuation">[</span>lookupUSA<span class="token operator">$</span>PCTILE<span class="token operator">==</span><span class="token string">'84'</span> <span class="token punctuation">,</span><span class="token string">'cancer'</span><span class="token punctuation">]</span>
 <span class="token comment">#   39.83055</span>
 ejscreen<span class="token operator">::</span>lookupStates<span class="token punctuation">[</span>lookupStates<span class="token operator">$</span>PCTILE<span class="token operator">==</span><span class="token string">'84'</span> <span class="token operator">&amp;</span> lookupStates<span class="token operator">$</span>REGION <span class="token operator">==</span><span class="token string">'WV'</span><span class="token punctuation">,</span><span class="token string">'cancer'</span><span class="token punctuation">]</span>
 <span class="token comment">#   33.36371</span>
 <span class="token comment"># also see ejanalysis::assign.pctiles</span>
 
<span class="token comment">## End(Not run)</span>
  <span class="token comment">## Not run: </span>
     library<span class="token punctuation">(</span>ejscreen<span class="token punctuation">)</span>
       evarname <span class="token operator">&lt;-</span> <span class="token string">'traffic.score'</span>
       evalues <span class="token operator">&lt;-</span> bg21<span class="token punctuation">[</span> <span class="token punctuation">,</span> evarname<span class="token punctuation">]</span>
       emax <span class="token operator">&lt;-</span> max<span class="token punctuation">(</span>evalues<span class="token punctuation">,</span>na.rm <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">)</span>
       plot<span class="token punctuation">(</span>lookupUSA<span class="token punctuation">[</span><span class="token punctuation">,</span>evarname<span class="token punctuation">]</span><span class="token punctuation">,</span> lookupUSA<span class="token operator">$</span>PCTILE<span class="token punctuation">,</span> xlab <span class="token operator">=</span> evarname<span class="token punctuation">,</span> main<span class="token operator">=</span><span class="token string">'contents of lookup table'</span><span class="token punctuation">,</span> type<span class="token operator">=</span><span class="token string">'b'</span><span class="token punctuation">)</span>

       plot<span class="token punctuation">(</span>x <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">1000</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>emax <span class="token operator">/</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        y <span class="token operator">=</span> lookup.pctile<span class="token punctuation">(</span>myvector <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">1000</span><span class="token punctuation">)</span> <span class="token operator">*</span> emax <span class="token operator">/</span> <span class="token number">1000</span><span class="token punctuation">,</span> varname.<span class="token keyword">in</span>.lookup.table <span class="token operator">=</span> evarname<span class="token punctuation">,</span> lookup <span class="token operator">=</span> lookupUSA<span class="token punctuation">)</span><span class="token punctuation">,</span>
        ylim <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span>   type<span class="token operator">=</span><span class="token string">'b'</span><span class="token punctuation">,</span>
        xlab<span class="token operator">=</span>evarname<span class="token punctuation">,</span> ylab<span class="token operator">=</span><span class="token string">'percentile per lookup table'</span> <span class="token punctuation">,</span> main<span class="token operator">=</span><span class="token string">'Percentiles for various envt scores, as looked up in lookup table'</span><span class="token punctuation">)</span>
      abline<span class="token punctuation">(</span>v <span class="token operator">=</span> lookupUSA<span class="token punctuation">[</span> lookupUSA<span class="token operator">$</span>PCTILE <span class="token operator">==</span> <span class="token string">'mean'</span><span class="token punctuation">,</span> evarname<span class="token punctuation">]</span><span class="token punctuation">)</span>

  
<span class="token comment">## End(Not run)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="make.bin.cols">

<a href="#make.bin.cols" class="help-page-title"><h2>Create a Bin Numbers Column for each Percentiles Column</h2></a>

<h3>Description</h3>

<p>Simplifies creation of data.frame or matrix (or vector) with columns that specify bins by bin number,
based on values (percentiles for example) and specified cutpoints. Each bin is defined by cutpoints.
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">make.bin.cols<span class="token punctuation">(</span>
  pctile.df<span class="token punctuation">,</span>
  as.df <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">,</span>
  cutpoints <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token operator">:</span><span class="token number">9</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">0.95</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  labels <span class="token operator">=</span> <span class="token number">1</span><span class="token operator">:</span><span class="token number">11</span><span class="token punctuation">,</span>
  prefix <span class="token operator">=</span> <span class="token string">"bin."</span>
<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>pctile.df</code></td>
<td>
<p>Data.frame (or matrix or vector), required. Typically percentiles as decimal fractions, 0 to 1, one per place.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>as.df</code></td>
<td>
<p>Logical value, optional, TRUE by default. Defines whether results are data.frame or matrix.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cutpoints</code></td>
<td>
<p>Optional vector of cutpoints defining edges of bins. Default is every 0.10 from 0 through 1.00, as well as 0.95</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>labels</code></td>
<td>
<p>Vector of bin numbers (defining what is returned for values in those bins), optional (default is 1 through 11, and NA values are put in bin 0).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>prefix</code></td>
<td>
<p>Optional character element, ".bin" by default, pasted as prefix to each column name of pctile.df, and used as names of returned columns.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>This is one way to prepare data to be mapped in a series of choropleths, for example (color-coded maps).
</p>
<p>The default bins 0-11 are defined as follows: <br>
bin 0: PCTILE=NA <br>
... <br>
bin 9:  0.80&lt;=PCTILE&lt;0.90 <br>
bin 10: 0.90&lt;=PCTILE&lt;0.95 <br>
bin 11: 0.95&lt;=PCTILE&lt;=1.00  <br></p>


<h3>Value</h3>

<p>Returns a data.frame, matrix, or vector (depending on <code>as.df</code>) the same shape as pctile.df
</p>


<h3>See Also</h3>

<p><code><a href="#make.bin.pctile.cols">make.bin.pctile.cols</a></code> to call functions below, converting columns of values to percentiles and then bins <br><code><a href="#assign.pctiles">assign.pctiles</a></code> for one vector, assign (weighted) percentile (quantile) to each value within its zone (subset)  <br><code><a href="#assign.pctiles.alt2">assign.pctiles.alt2</a></code> as an alternative method, to replicate assign.pctiles, but not by zone <br><code><a href="#get.pctile">get.pctile</a></code> to get (weighted) percentile of just 1+ values within given vector of values <br><code><a href="#make.pctile.cols">make.pctile.cols</a></code> for a data.frame, assign percentiles, return a same-sized df that is wtd.quantile of each value within its column <br><code><a href="#make.pctile.cols.alt2">make.pctile.cols.alt2</a></code> as an alternative method, to replicate make.pctile.cols <br><code><a href="#assign.map.bins">assign.map.bins</a></code> for one vector (or data.frame) of values (e.g. percentiles), return same-sized df that is bin number (map color bin) using preset breaks. <br><code><a href="#make.bin.cols">make.bin.cols</a></code> for a data.frame of values (e.g. percentiles), return same-sized df that is bin number (map color bin) using preset breaks. <br><code><a href="#write.pctiles">write.pctiles</a></code> to save file that is lookup table of percentiles for columns of a data.frame <br><code><a href="#write.pctiles.by.zone">write.pctiles.by.zone</a></code> to save file that is lookup table of percentiles for columns of a data.frame, for each geographic zone (subset of rows) <br><code><a href="#write.wtd.pctiles">write.wtd.pctiles</a></code> to save file that is lookup table of weighted percentiles for columns of a data.frame <br><code><a href="#write.wtd.pctiles.by.zone">write.wtd.pctiles.by.zone</a></code> to save file that is lookup table of weighted percentiles for columns of a data.frame, for each geographic zone (subset of rows) <br><code><a href="#lookup.pctile">lookup.pctile</a></code> to look up current approx weighted percentiles in a lookup table that is already in global memory <br></p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r"><span class="token comment">#  new.bin.cols &lt;- make.bin.cols(places[ , names.e.pctile])</span>
	<span class="token comment"># new.bin.cols &lt;- make.bin.cols( new.pctile.cols )</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="make.bin.pctile.cols">

<a href="#make.bin.pctile.cols" class="help-page-title"><h2>Weighted Percentiles and Bin Numbers for Each Column, by zone, such as percentiles within each State</h2></a>

<h3>Description</h3>

<p>This function just combines <code><a href="#make.pctile.cols">make.pctile.cols()</a></code> and <code><a href="#make.bin.cols">make.bin.cols()</a></code>.
Takes a data.frame of values and returns a data.frame (or matrix) of percentiles,
showing the percentile of a value within all values in its column, as well as bin numbers,
showing what bin each falls into, based on specified cutoffs defining bins. <br><br>
** Work in progress/ not fully tested, e.g., need to test if all code below works with both as.df=TRUE and as.df=FALSE
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">make.bin.pctile.cols<span class="token punctuation">(</span>
  raw.data.frame<span class="token punctuation">,</span>
  weights <span class="token operator">=</span> <span class="token keyword">NULL</span><span class="token punctuation">,</span>
  zone <span class="token operator">=</span> <span class="token keyword">NULL</span><span class="token punctuation">,</span>
  as.df <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">,</span>
  prefix.bin <span class="token operator">=</span> <span class="token string">"bin."</span><span class="token punctuation">,</span>
  prefix.pctile <span class="token operator">=</span> <span class="token string">"pctile."</span><span class="token punctuation">,</span>
  cutpoints <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token operator">:</span><span class="token number">9</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">0.95</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  labels <span class="token operator">=</span> <span class="token number">1</span><span class="token operator">:</span><span class="token number">11</span>
<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>raw.data.frame</code></td>
<td>
<p>Data.frame of values</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>weights</code></td>
<td>
<p>Optional Numeric vector of weights to create weighted percentiles, such as population-weighted quantiles. Unweighted if not specified. Vector same length as number of rows in data.frame.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>zone</code></td>
<td>
<p>NULL by default, but if a vector is provided, it defines zones to group by, so percentiles are within a given zone only.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>as.df</code></td>
<td>
<p>Optional logical TRUE by default, in which case matrix results are converted to data.frame</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>prefix.bin</code></td>
<td>
<p>Optional character element, default is 'bin.', provides text to paste to beginning of input data.frame column names to use as bin output column names.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>prefix.pctile</code></td>
<td>
<p>Optional character element, default is 'pctile.', provides text to paste to beginning of input data.frame column names to use as pctile output column names.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cutpoints</code></td>
<td>
<p>Default is 1:11. see <code><a href="#make.bin.cols">make.bin.cols()</a></code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>labels</code></td>
<td>
<p>Default is c(0.00, 0.10, 0.20, 0.30, 0.40, 0.50, 0.60, 0.70, 0.80, 0.90,  0.95,  1.00). see <code><a href="#make.bin.cols">make.bin.cols()</a></code></p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>Returns a matrix or data.frame
</p>


<h3>See Also</h3>

<p><code><a href="#make.bin.pctile.cols">make.bin.pctile.cols</a></code> to call functions below, converting columns of values to percentiles and then bins <br><code><a href="#assign.pctiles">assign.pctiles</a></code> for one vector, assign (weighted) percentile (quantile) to each value within its zone (subset)  <br><code><a href="#assign.pctiles.alt2">assign.pctiles.alt2</a></code> as an alternative method, to replicate assign.pctiles, but not by zone <br><code><a href="#get.pctile">get.pctile</a></code> to get (weighted) percentile of just 1+ values within given vector of values <br><code><a href="#make.pctile.cols">make.pctile.cols</a></code> for a data.frame, assign percentiles, return a same-sized df that is wtd.quantile of each value within its column <br><code><a href="#make.pctile.cols.alt2">make.pctile.cols.alt2</a></code> as an alternative method, to replicate make.pctile.cols <br><code><a href="#assign.map.bins">assign.map.bins</a></code> for one vector (or data.frame) of values (e.g. percentiles), return same-sized df that is bin number (map color bin) using preset breaks. <br><code><a href="#make.bin.cols">make.bin.cols</a></code> for a data.frame of values (e.g. percentiles), return same-sized df that is bin number (map color bin) using preset breaks. <br><code><a href="#write.pctiles">write.pctiles</a></code> to save file that is lookup table of percentiles for columns of a data.frame <br><code><a href="#write.pctiles.by.zone">write.pctiles.by.zone</a></code> to save file that is lookup table of percentiles for columns of a data.frame, for each geographic zone (subset of rows) <br><code><a href="#write.wtd.pctiles">write.wtd.pctiles</a></code> to save file that is lookup table of weighted percentiles for columns of a data.frame <br><code><a href="#write.wtd.pctiles.by.zone">write.wtd.pctiles.by.zone</a></code> to save file that is lookup table of weighted percentiles for columns of a data.frame, for each geographic zone (subset of rows) <br><code><a href="#lookup.pctile">lookup.pctile</a></code> to look up current approx weighted percentiles in a lookup table that is already in global memory <br></p>

<hr>
</div>
<div class="container manual-page" id="make.bin.pctile.cols.byzone">

<a href="#make.bin.pctile.cols.byzone" class="help-page-title"><h2>May be obsolete-not used -was Percentile and bin number fields, by zone, such as percentiles within each State</h2></a>

<h3>Description</h3>

<p>May be obsolete- just uses make.bin.pctile.cols() which now has a zone parameter.
Get weighted percentiles and bin numbers, by subset of rows (zone), for each column of data.
This can be used to calculate population-weighted percentiles within each State, for national data on Census block groups, for example.
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">make.bin.pctile.cols.byzone<span class="token punctuation">(</span>
  bg<span class="token punctuation">,</span>
  zone<span class="token punctuation">,</span>
  wtsvarname<span class="token punctuation">,</span>
  keyvarname <span class="token operator">=</span> <span class="token string">"FIPS"</span><span class="token punctuation">,</span>
  datavarnames <span class="token operator">=</span> gsub<span class="token punctuation">(</span>keyvarname<span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">,</span> names<span class="token punctuation">(</span>bg<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  clean <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">,</span>
  <span class="token ellipsis">...</span>
<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>bg</code></td>
<td>
<p>Data.frame of data field(s), weights (optional), and a unique ID (e.g., FIPS), one row per place if geographic data is used.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>zone</code></td>
<td>
<p>Optional vector specifying subsets of rows (e.g. State name) within which percentiles are calculated</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>wtsvarname</code></td>
<td>
<p>Name of field in bg that has optional weights for weighted percentiles. Default is unweighted.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>keyvarname</code></td>
<td>
<p>Name of field in bg that has unique ID per row (per place). Default is "FIPS"</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>datavarnames</code></td>
<td>
<p>Vector of names of fields in bg that have numeric data for which percentiles are calculated.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>clean</code></td>
<td>
<p>Does not use clean.fips() if FALSE, which helps if the countiesall or other list is not yet updated, for example and lacks some new FIPS code</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Other parameters passed to <code><a href="#make.bin.pctile.cols">make.bin.pctile.cols()</a></code> such as <code>cutpoints</code> and <code>labels</code></p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>Returns a data.frame with one percentiles field and one bin numbers field for each of the datavarnames
</p>

<hr>
</div>
<div class="container manual-page" id="make.pctile.cols">

<a href="#make.pctile.cols" class="help-page-title"><h2>Make columns of (weighted) percentiles from columns of values</h2></a>

<h3>Description</h3>

<p>Takes values (vector, matrix, or data.frame) and returns percentiles,
showing the percentile of a value within all values in its column.
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">make.pctile.cols<span class="token punctuation">(</span>
  values<span class="token punctuation">,</span>
  weights <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span>
  prefix <span class="token operator">=</span> <span class="token string">"pctile."</span><span class="token punctuation">,</span>
  as.df <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">,</span>
  zone <span class="token operator">=</span> <span class="token keyword">NULL</span>
<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>values</code></td>
<td>
<p>Data.frame, matrix, or vector of values. One column at a time is analyzed using <code><a href="#assign.pctiles">assign.pctiles()</a></code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>weights</code></td>
<td>
<p>Optional numeric vector of weights (default is unweighted) to create weighted percentiles, such as population-weighted quantiles. Unweighted if not specified. Vector same length as number of rows in values parameter (or elements if vector).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>prefix</code></td>
<td>
<p>Optional character element, default is 'pctile.', provides text to paste to beginning of input data.frame column names to use as output column names.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>as.df</code></td>
<td>
<p>Optional logical TRUE by default, in which case matrix results are converted to data.frame</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>zone</code></td>
<td>
<p>NULL by default, but if a vector is provided, it defines zones to group by, so percentiles are within a given zone only.</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>Returns a matrix or data.frame
</p>


<h3>See Also</h3>

<p><code><a href="#make.bin.pctile.cols">make.bin.pctile.cols</a></code> to call functions below, converting columns of values to percentiles and then bins <br><code><a href="#assign.pctiles">assign.pctiles</a></code> for one vector, assign (weighted) percentile (quantile) to each value within its zone (subset)  <br><code><a href="#assign.pctiles.alt2">assign.pctiles.alt2</a></code> as an alternative method, to replicate assign.pctiles, but not by zone <br><code><a href="#get.pctile">get.pctile</a></code> to get (weighted) percentile of just 1+ values within given vector of values <br><code><a href="#make.pctile.cols">make.pctile.cols</a></code> for a data.frame, assign percentiles, return a same-sized df that is wtd.quantile of each value within its column <br><code><a href="#make.pctile.cols.alt2">make.pctile.cols.alt2</a></code> as an alternative method, to replicate make.pctile.cols <br><code><a href="#assign.map.bins">assign.map.bins</a></code> for one vector (or data.frame) of values (e.g. percentiles), return same-sized df that is bin number (map color bin) using preset breaks. <br><code><a href="#make.bin.cols">make.bin.cols</a></code> for a data.frame of values (e.g. percentiles), return same-sized df that is bin number (map color bin) using preset breaks. <br><code><a href="#write.pctiles">write.pctiles</a></code> to save file that is lookup table of percentiles for columns of a data.frame <br><code><a href="#write.pctiles.by.zone">write.pctiles.by.zone</a></code> to save file that is lookup table of percentiles for columns of a data.frame, for each geographic zone (subset of rows) <br><code><a href="#write.wtd.pctiles">write.wtd.pctiles</a></code> to save file that is lookup table of weighted percentiles for columns of a data.frame <br><code><a href="#write.wtd.pctiles.by.zone">write.wtd.pctiles.by.zone</a></code> to save file that is lookup table of weighted percentiles for columns of a data.frame, for each geographic zone (subset of rows) <br><code><a href="#lookup.pctile">lookup.pctile</a></code> to look up current approx weighted percentiles in a lookup table that is already in global memory <br></p>

<hr>
</div>
<div class="container manual-page" id="make.pctile.cols.alt2">

<a href="#make.pctile.cols.alt2" class="help-page-title"><h2>Alternative way to make columns of (weighted) percentiles from columns of values</h2></a>

<h3>Description</h3>

<p>Takes a data.frame of values and returns a data.frame of percentiles,
showing the percentile of a value within all values in its column.
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">make.pctile.cols.alt2<span class="token punctuation">(</span>
  raw.data.frame<span class="token punctuation">,</span>
  weights<span class="token punctuation">,</span>
  as.df <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">,</span>
  prefix <span class="token operator">=</span> <span class="token string">"pctile."</span><span class="token punctuation">,</span>
  na.rm <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">,</span>
  zone <span class="token operator">=</span> <span class="token keyword">NULL</span>
<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>raw.data.frame</code></td>
<td>
<p>Data.frame of values</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>weights</code></td>
<td>
<p>Optional Numeric vector of weights to create weighted percentiles, such as population-weighted quantiles. Unweighted if not specified. Vector same length as number of rows in data.frame.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>as.df</code></td>
<td>
<p>Optional logical TRUE by default, in which case matrix results are converted to data.frame</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>prefix</code></td>
<td>
<p>Optional character element, default is 'pctile.', provides text to paste to beginning of input data.frame column names to use as output column names.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>na.rm</code></td>
<td>
<p>Default is TRUE. Passed to <code><a href="#assign.pctiles.alt2">assign.pctiles.alt2()</a></code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>zone</code></td>
<td>
<p>NULL by default, but if a vector is provided, it defines zones to group by, so percentiles are within a given zone only.</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>Returns a matrix or data.frame
</p>


<h3>See Also</h3>

<p><code><a href="#make.bin.pctile.cols">make.bin.pctile.cols</a></code> to call functions below, converting columns of values to percentiles and then bins <br><code><a href="#assign.pctiles">assign.pctiles</a></code> for one vector, assign (weighted) percentile (quantile) to each value within its zone (subset)  <br><code><a href="#assign.pctiles.alt2">assign.pctiles.alt2</a></code> as an alternative method, to replicate assign.pctiles, but not by zone <br><code><a href="#get.pctile">get.pctile</a></code> to get (weighted) percentile of just 1+ values within given vector of values <br><code><a href="#make.pctile.cols">make.pctile.cols</a></code> for a data.frame, assign percentiles, return a same-sized df that is wtd.quantile of each value within its column <br><code><a href="#make.pctile.cols.alt2">make.pctile.cols.alt2</a></code> as an alternative method, to replicate make.pctile.cols <br><code><a href="#assign.map.bins">assign.map.bins</a></code> for one vector (or data.frame) of values (e.g. percentiles), return same-sized df that is bin number (map color bin) using preset breaks. <br><code><a href="#make.bin.cols">make.bin.cols</a></code> for a data.frame of values (e.g. percentiles), return same-sized df that is bin number (map color bin) using preset breaks. <br><code><a href="#write.pctiles">write.pctiles</a></code> to save file that is lookup table of percentiles for columns of a data.frame <br><code><a href="#write.pctiles.by.zone">write.pctiles.by.zone</a></code> to save file that is lookup table of percentiles for columns of a data.frame, for each geographic zone (subset of rows) <br><code><a href="#write.wtd.pctiles">write.wtd.pctiles</a></code> to save file that is lookup table of weighted percentiles for columns of a data.frame <br><code><a href="#write.wtd.pctiles.by.zone">write.wtd.pctiles.by.zone</a></code> to save file that is lookup table of weighted percentiles for columns of a data.frame, for each geographic zone (subset of rows) <br><code><a href="#lookup.pctile">lookup.pctile</a></code> to look up current approx weighted percentiles in a lookup table that is already in global memory <br></p>

<hr>
</div>
<div class="container manual-page" id="names.d">

<a href="#names.d" class="help-page-title"><h2>Fieldnames of demographic columns in ejscreen data</h2></a>

<h3>Description</h3>

<p>This data set provides variables that hold the colnames
of demographic fields in data.frames that may be used in the related ejscreen package
to make it easier to refer to them as a vector
</p>


<h3>See Also</h3>

<p><a>ejscreen::names.d</a>  <a>ejscreen::names.e</a>  <a>ejscreen::names.ej</a>
</p>

<hr>
</div>
<div class="container manual-page" id="names.e">

<a href="#names.e" class="help-page-title"><h2>Fieldnames of environmental indicator columns in ejscreen data</h2></a>

<h3>Description</h3>

<p>This data set provides variables that hold the colnames
of environmental indicator fields in data.frames that may be used in the ejscreen package
to make it easier to refer to them as a vector
</p>


<h3>See Also</h3>

<p><a>ejscreen::names.d</a>  <a>ejscreen::names.e</a>  <a>ejscreen::names.ej</a>
</p>

<hr>
</div>
<div class="container manual-page" id="names.ej">

<a href="#names.ej" class="help-page-title"><h2>Fieldnames of EJ index columns in ejscreen data</h2></a>

<h3>Description</h3>

<p>This data set provides variables that hold the colnames
of environmental justice index fields in data.frames that may be used in the ejscreen package
to make it easier to refer to them as a vector
</p>


<h3>See Also</h3>

<p><a>ejscreen::names.d</a>  <a>ejscreen::names.e</a>  <a>ejscreen::names.ej</a>
</p>

<hr>
</div>
<div class="container manual-page" id="narrativeprofile">

<a href="#narrativeprofile" class="help-page-title"><h2>Get County or Tract Narrative Profile webpage from Census</h2></a>

<h3>Description</h3>

<p>For 1 tract, URL could be for example
https://www.census.gov/acs/www/data/data-tables-and-tools/narrative-profiles/2019/report.php?geotype=tract&amp;tract=700311&amp;state=24&amp;county=031
For 1 county, URL could be for example
https://www.census.gov/acs/www/data/data-tables-and-tools/narrative-profiles/2019/report.php?geotype=county&amp;state=21&amp;county=017
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">narrativeprofile<span class="token punctuation">(</span>
  yearnumber <span class="token operator">=</span> <span class="token number">2020</span><span class="token punctuation">,</span>
  geotype <span class="token operator">=</span> <span class="token string">"county"</span><span class="token punctuation">,</span>
  statenumber2 <span class="token operator">=</span> <span class="token string">"24"</span><span class="token punctuation">,</span>
  countynumber3 <span class="token operator">=</span> <span class="token string">"031"</span><span class="token punctuation">,</span>
  tractnumber6 <span class="token operator">=</span> <span class="token keyword">NULL</span><span class="token punctuation">,</span>
  launch <span class="token operator">=</span> <span class="token boolean">FALSE</span>
<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>yearnumber</code></td>
<td>
<p>for what year of the 1-year American Community Survey data</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>geotype</code></td>
<td>
<p>county or tract</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>statenumber2</code></td>
<td>
<p>two digit state FIPS (leading zero added if necessary)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>countynumber3</code></td>
<td>
<p>three digit county FIPS (leading zero added if necessary)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tractnumber6</code></td>
<td>
<p>six digit tract FIPS</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>launch</code></td>
<td>
<p>If set to TRUE, will launch a web browser and open the narrative profile page using the url</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>URL that is link to Census Bureau webpage with narrative profile of multiple statistics
</p>

<hr>
</div>
<div class="container manual-page" id="pct.moe">

<a href="#pct.moe" class="help-page-title"><h2>Margin of Error for a Percent (Ratio)</h2></a>

<h3>Description</h3>

<p>Estimates the margin of error (MOE) that characterizes uncertainty, for a ratio (a/b),
based on a, b, and their MOE values.
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">pct.moe<span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> a.moe<span class="token punctuation">,</span> b.moe<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>a</code></td>
<td>
<p>Numerators, as a vector</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>b</code></td>
<td>
<p>Denominators, as a vector (should be same length as a, or it is recycled)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>a.moe</code></td>
<td>
<p>Margins of error for numerators, as a vector  (should be same length as a).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>b.moe</code></td>
<td>
<p>Margins of error for denominators, as a vector (should be same length as a, or it is recycled).</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>This is based on US Census Bureau recommendations for working with American Community Survey summary file data.
See <a href="http://www.census.gov/programs-surveys/acs/guidance.html" target="_blank">http://www.census.gov/programs-surveys/acs/guidance.html</a> and <a href="http://www.census.gov/library/publications/2009/acs/researchers.html" target="_blank">http://www.census.gov/library/publications/2009/acs/researchers.html</a>
For example, one can estimate MOE for percent poor in a block group, given
estimates and margins of error for the count who are poor, and the count for whom poverty status is known.
</p>


<h3>Value</h3>

<p>Returns margin(s) of error same shape as parameter a
</p>


<h3>See Also</h3>

<p><code><a href="#sumoe">sumoe()</a></code>
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r">x <span class="token operator">&lt;-</span> pct.moe<span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="plot_3_by_distance">

<a href="#plot_3_by_distance" class="help-page-title"><h2>create plot of 3 indicators versus distance
This makes a very simple scatter plot of 3 variables on y axis
as a function of distance on the x axis.
For example, it can show risk, percent demographic score, and population
density, e.g., using numbers created at random by sim_riskbydistance()</h2></a>

<h3>Description</h3>

<p>create plot of 3 indicators versus distance
This makes a very simple scatter plot of 3 variables on y axis
as a function of distance on the x axis.
For example, it can show risk, percent demographic score, and population
density, e.g., using numbers created at random by sim_riskbydistance()
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">plot_3_by_distance<span class="token punctuation">(</span>
  x<span class="token punctuation">,</span>
  xname <span class="token operator">=</span> <span class="token string">"dist"</span><span class="token punctuation">,</span>
  xlab <span class="token operator">=</span> <span class="token string">"Distance (miles)"</span><span class="token punctuation">,</span>
  ynames <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token string">"risk"</span><span class="token punctuation">,</span> <span class="token string">"pctd"</span><span class="token punctuation">,</span> <span class="token string">"popdensity"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  mylegend <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token string">"Risk"</span><span class="token punctuation">,</span> <span class="token string">"% Demog"</span><span class="token punctuation">,</span> <span class="token string">"Pop density"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  mycolors <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token string">"red"</span><span class="token punctuation">,</span> <span class="token string">"orange"</span><span class="token punctuation">,</span> <span class="token string">"blue"</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>data.frame such as output from <code><a href="#sim_riskbydistance">sim_riskbydistance()</a></code>, with
colnames like risk, pctd, popdensity, and dist (the defaults)
or any 3 with values for y axis and 1 with values for x axis like distance.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>xname</code></td>
<td>
<p>colname in x so that x,xname can be used as x values in plot</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>xlab</code></td>
<td>
<p>like in plot(), a string label for x axis</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ynames</code></td>
<td>
<p>3 colnames in x, with 3 sets of y values for the scatter plot,
but they have to be in the same units for the plot to make sense, so
they could be percentages, or percentiles, for example.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mylegend</code></td>
<td>
<p>3 strings to use in legend(legend=mylegend, fill=mycolors)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mycolors</code></td>
<td>
<p>3 colors for legend</p>
</td>
</tr>
</table>
<h3>See Also</h3>

<p><code><a href="#sim_riskbydistance">sim_riskbydistance()</a></code>
</p>

<hr>
</div>
<div class="container manual-page" id="pop.cdf">

<a href="#pop.cdf" class="help-page-title"><h2>Draw PDF (overlays histograms) comparing distributions of scores in selected demographic groups</h2></a>

<h3>Description</h3>

<p>Draws a histogram plot using <code><a href="https://jimlemon.r-universe.dev/manual/plotrix.html#weighted.hist">plotrix::weighted.hist()</a></code>, overlaying distribution functions,
one for each subgroup specified.
Useful to compare 2 groups based on each groups entire pdf distribution of peoples scores,
using data from small places like census block groups, based on having for each place the pop total
and % of pop that is in each group or perhaps already have count in each group.
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">pop.cdf<span class="token punctuation">(</span>
  scores<span class="token punctuation">,</span>
  pcts<span class="token punctuation">,</span>
  pops<span class="token punctuation">,</span>
  allothers <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">,</span>
  col <span class="token operator">=</span> <span class="token string">"lightblue"</span><span class="token punctuation">,</span>
  main<span class="token punctuation">,</span>
  weights<span class="token punctuation">,</span>
  <span class="token ellipsis">...</span>
<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>scores</code></td>
<td>
<p>Numeric vector (not data.frame currently), required. Values to analyze.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pcts</code></td>
<td>
<p>Numeric vector or data.frame, required. Same number of vector elements or data.frame
rows as length of scores. Specifies the fraction of population that is in demographic group(s) of interest, one row per place, one group per column.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pops</code></td>
<td>
<p>Vector used to define weights as pop<em>pcts, and if allothers=TRUE, for pop</em>(1-pcts) for nongroup</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>allothers</code></td>
<td>
<p>Logical value, optional, TRUE by default. Whether to plot a series for everyone else, using 1-pct</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>col</code></td>
<td>
<p>Optional, default is 'red' to signify line color red for key demographic group.
Can also be a vector of colors if pcts is a data.frame with one column per group, one color per group.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>main</code></td>
<td>
<p>Optional character specifying plot title. Default title notes colors of lines and if reference group used.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>weights</code></td>
<td>
<p>Not used currently (see <code>pop</code> parameter)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>other optional parameters to pass to weighted.hist()</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Notes: <br>
to compare zones, <br>
compare demog groups, (see parameter called group)<br>
compare multiple groups and/or multiple zones, like hisp vs others in us vs ca all on one graph<br>
see <code><a href="https://jimlemon.r-universe.dev/manual/plotrix.html#weighted.hist">plotrix::weighted.hist()</a></code> for options <br></p>


<h3>Value</h3>

<p>Draws a plot
</p>


<h3>See Also</h3>

<p><code><a href="https://harrelfe.r-universe.dev/manual/Hmisc.html#Ecdf">Hmisc::Ecdf()</a></code> <code><a href="#RR">RR()</a></code> <code><a href="#pop.cdf">pop.cdf()</a></code>   <code><a href="#pop.cdf2">pop.cdf2()</a></code> <code><a href="#pop.ecdf">pop.ecdf()</a></code>  <code><a href="#pop.cdf.density">pop.cdf.density()</a></code>
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r"><span class="token comment">## #</span>
<span class="token comment">## Not run: </span>


  bg <span class="token operator">&lt;-</span> ejscreen<span class="token operator">::</span>bg22<span class="token punctuation">[</span><span class="token punctuation">,</span> c<span class="token punctuation">(</span>ejscreen<span class="token operator">::</span>names.d<span class="token punctuation">,</span> <span class="token string">'pop'</span><span class="token punctuation">,</span> ejscreen<span class="token operator">::</span>names.e<span class="token punctuation">,</span> <span class="token string">'REGION'</span><span class="token punctuation">)</span><span class="token punctuation">]</span>

e <span class="token operator">&lt;-</span> bg<span class="token operator">$</span>pm<span class="token punctuation">[</span><span class="token operator">!</span>is.na<span class="token punctuation">(</span>bg<span class="token operator">$</span>pm<span class="token punctuation">)</span><span class="token punctuation">]</span>
dpct <span class="token operator">&lt;-</span> bg<span class="token operator">$</span>pctmin
dcount   <span class="token operator">&lt;-</span> bg<span class="token operator">$</span>pop<span class="token punctuation">[</span><span class="token operator">!</span>is.na<span class="token punctuation">(</span>bg<span class="token operator">$</span>pm<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">*</span>      dpct<span class="token punctuation">[</span><span class="token operator">!</span>is.na<span class="token punctuation">(</span>bg<span class="token operator">$</span>pm<span class="token punctuation">)</span><span class="token punctuation">]</span>
refcount <span class="token operator">&lt;-</span> bg<span class="token operator">$</span>pop<span class="token punctuation">[</span><span class="token operator">!</span>is.na<span class="token punctuation">(</span>bg<span class="token operator">$</span>pm<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">-</span> dpct<span class="token punctuation">[</span><span class="token operator">!</span>is.na<span class="token punctuation">(</span>bg<span class="token operator">$</span>pm<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
brks <span class="token operator">&lt;-</span> <span class="token number">0</span><span class="token operator">:</span><span class="token number">17</span>
etxt <span class="token operator">&lt;-</span> <span class="token string">'PM2.5'</span>
dtxt <span class="token operator">&lt;-</span> <span class="token string">'Minorities'</span>

pop.cdf<span class="token punctuation">(</span>        e<span class="token punctuation">,</span> pcts <span class="token operator">=</span> dpct<span class="token punctuation">,</span> pops <span class="token operator">=</span> bg<span class="token operator">$</span>pop<span class="token punctuation">)</span>
pop.cdf2<span class="token punctuation">(</span>       e<span class="token punctuation">,</span> dcount<span class="token punctuation">,</span> refcount<span class="token punctuation">,</span> etxt<span class="token punctuation">,</span> dtxt<span class="token punctuation">,</span> brks<span class="token punctuation">)</span>
pop.cdf.density<span class="token punctuation">(</span>e<span class="token punctuation">,</span> dcount<span class="token punctuation">,</span> refcount<span class="token punctuation">,</span> etxt<span class="token punctuation">,</span> dtxt <span class="token punctuation">)</span>


<span class="token comment"># pop.cdf( 31:35, c(0.10, 0.10, 0.40, 0, 0.20), 1001:1005 )</span>

set.seed<span class="token punctuation">(</span><span class="token number">99</span><span class="token punctuation">)</span>
pctminsim<span class="token operator">=</span>c<span class="token punctuation">(</span>runif<span class="token punctuation">(</span><span class="token number">7000</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> pmin<span class="token punctuation">(</span>rlnorm<span class="token punctuation">(</span><span class="token number">5000</span><span class="token punctuation">,</span> meanlog<span class="token operator">=</span>log<span class="token punctuation">(</span><span class="token number">0.30</span><span class="token punctuation">)</span><span class="token punctuation">,</span> sdlog<span class="token operator">=</span><span class="token number">1.7</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">4</span><span class="token punctuation">)</span>
popsim<span class="token operator">=</span> runif<span class="token punctuation">(</span><span class="token number">12000</span><span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span>
esim<span class="token operator">=</span> rlnorm<span class="token punctuation">(</span><span class="token number">12000</span><span class="token punctuation">,</span> log<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span> log<span class="token punctuation">(</span><span class="token number">1.15</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> rnorm<span class="token punctuation">(</span><span class="token number">12000</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">)</span> <span class="token operator">*</span> pctminsim <span class="token operator">-</span> <span class="token number">1</span>
pop.cdf<span class="token punctuation">(</span>esim<span class="token punctuation">,</span> pctminsim<span class="token punctuation">,</span> popsim<span class="token punctuation">,</span> xlab<span class="token operator">=</span><span class="token string">'Tract air pollution levels'</span><span class="token punctuation">,</span>
  main <span class="token operator">=</span> <span class="token string">'Air pollution levels among minorities (red bars) vs rest of US pop.'</span><span class="token punctuation">)</span>

<span class="token comment">#</span>
<span class="token comment"># pop.cdf(bg$pm, bg$pctmin, bg$pop)</span>
<span class="token comment"># pop.cdf(log10(places$traffic.score), places$pctmin, places$pop)</span>
<span class="token comment"># pop.cdf(places$cancer, places$pctmin, places$pop, allothers=FALSE)</span>
<span class="token comment"># pop.cdf(places$cancer, places$pctlingiso, places$pop, col='green', allothers=FALSE, add=TRUE)</span>
<span class="token comment"># Demog suscept  for each REGION (can't see if use vs others)</span>
pop.cdf<span class="token punctuation">(</span>bg<span class="token operator">$</span>traffic.score<span class="token punctuation">,</span> bg<span class="token operator">$</span>VSI.eo<span class="token punctuation">,</span> bg<span class="token operator">$</span>pop<span class="token punctuation">,</span> log<span class="token operator">=</span><span class="token string">'x'</span><span class="token punctuation">,</span> subtitles<span class="token operator">=</span><span class="token boolean">FALSE</span><span class="token punctuation">,</span>
         group<span class="token operator">=</span>bg<span class="token operator">$</span>REGION<span class="token punctuation">,</span> allothers<span class="token operator">=</span><span class="token boolean">FALSE</span><span class="token punctuation">,</span>
         xlab<span class="token operator">=</span><span class="token string">'Traffic score (log scale)'</span><span class="token punctuation">,</span> ylab<span class="token operator">=</span><span class="token string">'frequency in population'</span><span class="token punctuation">,</span>
          main<span class="token operator">=</span><span class="token string">'Distribution of scores by EPA Region'</span><span class="token punctuation">)</span>

<span class="token comment"># Demog suscept (how to show vs others??), one panel per ENVT FACTOR (ie per col in scores df)</span>
data<span class="token punctuation">(</span><span class="token string">'names.e'</span><span class="token punctuation">)</span>
<span class="token comment"># NOT</span>
pop.cdf<span class="token punctuation">(</span>bg<span class="token punctuation">[</span> <span class="token punctuation">,</span> names.e<span class="token punctuation">]</span><span class="token punctuation">,</span> bg<span class="token operator">$</span>VSI.eo<span class="token punctuation">,</span> bg<span class="token operator">$</span>pop<span class="token punctuation">,</span> log<span class="token operator">=</span><span class="token string">'x'</span><span class="token punctuation">,</span> subtitles<span class="token operator">=</span><span class="token boolean">FALSE</span><span class="token punctuation">,</span>
         allothers<span class="token operator">=</span><span class="token boolean">TRUE</span><span class="token punctuation">,</span> ylab<span class="token operator">=</span><span class="token string">'frequency in population'</span><span class="token punctuation">,</span>
          main<span class="token operator">=</span><span class="token string">'Distribution of scores by EPA Region'</span><span class="token punctuation">)</span>

<span class="token comment"># log scale is useful &amp; so are these labels passed to function</span>
<span class="token comment"># in CA vs not CA</span>
pop.cdf<span class="token punctuation">(</span>bg<span class="token operator">$</span>traffic.score<span class="token punctuation">,</span> bg<span class="token operator">$</span>ST<span class="token operator">==</span><span class="token string">'CA'</span><span class="token punctuation">,</span> bg<span class="token operator">$</span>pop<span class="token punctuation">,</span>
         subtitles<span class="token operator">=</span><span class="token boolean">FALSE</span><span class="token punctuation">,</span>
         log<span class="token operator">=</span><span class="token string">'x'</span><span class="token punctuation">,</span> ylab<span class="token operator">=</span><span class="token string">'frequency in population'</span><span class="token punctuation">,</span> xlab<span class="token operator">=</span><span class="token string">'Traffic scores (log scale)'</span><span class="token punctuation">,</span>
         main<span class="token operator">=</span><span class="token string">'Distribution of scores in CA (red) vs rest of US'</span><span class="token punctuation">)</span>

<span class="token comment"># Flagged vs not (all D, all zones)</span>
pop.cdf<span class="token punctuation">(</span>bg<span class="token operator">$</span>traffic.score<span class="token punctuation">,</span> bg<span class="token operator">$</span>flagged<span class="token punctuation">,</span> bg<span class="token operator">$</span>pop<span class="token punctuation">,</span> log<span class="token operator">=</span><span class="token string">'x'</span><span class="token punctuation">)</span>

<span class="token comment"># D=Hispanics vs others, within CA zone only</span>
pop.cdf<span class="token punctuation">(</span>bg<span class="token operator">$</span>traffic.score<span class="token punctuation">,</span> bg<span class="token operator">$</span>ST<span class="token operator">==</span><span class="token string">'CA'</span><span class="token punctuation">,</span> bg<span class="token operator">$</span>pop <span class="token operator">*</span> bg<span class="token operator">$</span>pcthisp<span class="token punctuation">,</span> log<span class="token operator">=</span><span class="token string">'x'</span><span class="token punctuation">)</span>
<span class="token comment"># Demog suscept vs others, within CA only</span>
pop.cdf<span class="token punctuation">(</span>bg<span class="token operator">$</span>traffic.score<span class="token punctuation">,</span> bg<span class="token operator">$</span>ST<span class="token operator">==</span><span class="token string">'CA'</span><span class="token punctuation">,</span> bg<span class="token operator">$</span>pop <span class="token operator">*</span> bg<span class="token operator">$</span>VSI.eo<span class="token punctuation">,</span> log<span class="token operator">=</span><span class="token string">'x'</span><span class="token punctuation">)</span>


<span class="token comment">## End(Not run)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="pop.cdf.density">

<a href="#pop.cdf.density" class="help-page-title"><h2>Overlay 2 PDFs as Weighted Histograms</h2></a>

<h3>Description</h3>

<p>OK but there now are better ways to compare pdf plots
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">pop.cdf.density<span class="token punctuation">(</span>e<span class="token punctuation">,</span> dcount<span class="token punctuation">,</span> refcount<span class="token punctuation">,</span> etxt<span class="token punctuation">,</span> dtxt<span class="token punctuation">,</span> brks <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token ellipsis">...</span><span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>e</code></td>
<td>
<p>Environmental or other indicator values vector</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dcount</code></td>
<td>
<p>Vector of weights for the demographic group of interest, such as population counts of Hispanics by Census tract.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>refcount</code></td>
<td>
<p>Vector of weights for the reference group, such as population counts of individuals who are not Hispanic, by Census tract.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>etxt</code></td>
<td>
<p>Character string to name e in graph</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dtxt</code></td>
<td>
<p>Character string to name d in graph</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>brks</code></td>
<td>
<p>Default is 10. Passed as breaks param to plot function</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>other parameters passed to <code>plot</code> # used to pass to density() but this is more useful</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>For an easy, nice, smoothed density plot,
try plot(stats::density(bw = .001)); points(density(, bw = .001), col="red")
to see overlay of two frequency distributions.
Assumes you have weights for each and are comparing values in one group vs another.
</p>


<h3>Value</h3>

<p>Creates a plot
</p>


<h3>See Also</h3>

<p><code><a href="#pop.cdf">pop.cdf()</a></code>   <code><a href="#pop.cdf2">pop.cdf2()</a></code> <code><a href="#pop.ecdf">pop.ecdf()</a></code>  <code><a href="#pop.cdf.density">pop.cdf.density()</a></code>
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r"><span class="token comment">## Not run: </span>
  bg <span class="token operator">&lt;-</span> ejscreen<span class="token operator">::</span>bg22<span class="token punctuation">[</span><span class="token punctuation">,</span> c<span class="token punctuation">(</span>ejscreen<span class="token operator">::</span>names.d<span class="token punctuation">,</span> <span class="token string">'pop'</span><span class="token punctuation">,</span> ejscreen<span class="token operator">::</span>names.e<span class="token punctuation">,</span> <span class="token string">'REGION'</span><span class="token punctuation">)</span><span class="token punctuation">]</span>

e <span class="token operator">&lt;-</span> bg<span class="token operator">$</span>pm<span class="token punctuation">[</span><span class="token operator">!</span>is.na<span class="token punctuation">(</span>bg<span class="token operator">$</span>pm<span class="token punctuation">)</span><span class="token punctuation">]</span>
dpct <span class="token operator">&lt;-</span> bg<span class="token operator">$</span>pctmin
dcount   <span class="token operator">&lt;-</span> bg<span class="token operator">$</span>pop<span class="token punctuation">[</span><span class="token operator">!</span>is.na<span class="token punctuation">(</span>bg<span class="token operator">$</span>pm<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">*</span>      dpct<span class="token punctuation">[</span><span class="token operator">!</span>is.na<span class="token punctuation">(</span>bg<span class="token operator">$</span>pm<span class="token punctuation">)</span><span class="token punctuation">]</span>
refcount <span class="token operator">&lt;-</span> bg<span class="token operator">$</span>pop<span class="token punctuation">[</span><span class="token operator">!</span>is.na<span class="token punctuation">(</span>bg<span class="token operator">$</span>pm<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">-</span> dpct<span class="token punctuation">[</span><span class="token operator">!</span>is.na<span class="token punctuation">(</span>bg<span class="token operator">$</span>pm<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
brks <span class="token operator">&lt;-</span> <span class="token number">0</span><span class="token operator">:</span><span class="token number">17</span>
etxt <span class="token operator">&lt;-</span> <span class="token string">'PM2.5'</span>
dtxt <span class="token operator">&lt;-</span> <span class="token string">'Minorities'</span>

pop.cdf<span class="token punctuation">(</span>        e<span class="token punctuation">,</span> pcts <span class="token operator">=</span> dpct<span class="token punctuation">,</span> pops <span class="token operator">=</span> bg<span class="token operator">$</span>pop<span class="token punctuation">)</span>
pop.cdf2<span class="token punctuation">(</span>       e<span class="token punctuation">,</span> dcount<span class="token punctuation">,</span> refcount<span class="token punctuation">,</span> etxt<span class="token punctuation">,</span> dtxt<span class="token punctuation">,</span> brks<span class="token punctuation">)</span>
pop.cdf.density<span class="token punctuation">(</span>e<span class="token punctuation">,</span> dcount<span class="token punctuation">,</span> refcount<span class="token punctuation">,</span> etxt<span class="token punctuation">,</span> dtxt <span class="token punctuation">)</span>

  pop.cdf.density<span class="token punctuation">(</span>e <span class="token operator">=</span> e<span class="token punctuation">,</span> dcount <span class="token operator">=</span> dcount<span class="token punctuation">,</span> refcount <span class="token operator">=</span> refcount<span class="token punctuation">,</span> etxt <span class="token operator">=</span> etxt<span class="token punctuation">,</span> dtxt <span class="token operator">=</span> dtxt<span class="token punctuation">,</span>
               adjust<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> brks <span class="token operator">=</span> brks<span class="token punctuation">)</span>

<span class="token comment">## End(Not run)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="pop.cdf2">

<a href="#pop.cdf2" class="help-page-title"><h2>Overlay Two PDFs as Weighted Histograms</h2></a>

<h3>Description</h3>

<p>Use plotrix::weighted.hist to see overlay of two weighted histograms.
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">pop.cdf2<span class="token punctuation">(</span>e<span class="token punctuation">,</span> dcount<span class="token punctuation">,</span> refcount<span class="token punctuation">,</span> etxt<span class="token punctuation">,</span> dtxt<span class="token punctuation">,</span> brks <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token ellipsis">...</span><span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>e</code></td>
<td>
<p>Environmental or other indicator values vector</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dcount</code></td>
<td>
<p>Vector of weights for the demographic group of interest, such as population counts of Hispanics by Census tract.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>refcount</code></td>
<td>
<p>Vector of weights for the reference group, such as population counts of individuals who are not Hispanic, by Census tract.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>etxt</code></td>
<td>
<p>Character string to name e in graph</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dtxt</code></td>
<td>
<p>Character string to name d in graph</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>brks</code></td>
<td>
<p>Default is 10. Passed as breaks param to plot function</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>passed to plotrix::weighted.hist()</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Does not handle NA values well yet. Assumes you have weights for each and are comparing values in one group vs another.
</p>


<h3>Value</h3>

<p>Creates a plot
</p>


<h3>See Also</h3>

<p><code><a href="#pop.cdf">pop.cdf()</a></code>   <code><a href="#pop.cdf2">pop.cdf2()</a></code> <code><a href="#pop.ecdf">pop.ecdf()</a></code>  <code><a href="#pop.cdf.density">pop.cdf.density()</a></code>
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r"><span class="token comment">## Not run: </span>
<span class="token comment"># can get a dataset for examples</span>
load<span class="token punctuation">(</span><span class="token string">"~/../../Dropbox/EJSCREEN/R analysis/bg 2015-04-22 Rnames plus subgroups.RData"</span><span class="token punctuation">)</span>
<span class="token comment"># # to do this manually</span>
<span class="token comment"># require(plotrix)</span>
<span class="token comment">#weighted.hist(bg$proximity.rmp, bg$pop*bg$pctmin,</span>
<span class="token comment"># main='pop hist for pctmin of RMP score', xlim=c(0,1.8),freq=FALSE,breaks=c(0:18)/10,col='red')</span>
<span class="token comment">#weighted.hist(bg$proximity.rmp,bg$pop*(1-bg$pctmin),</span>
<span class="token comment"># main='pop hist for pctmin of RMP score', xlim=c(0,1.8),freq=FALSE,breaks=c(0:18)/10,add=TRUE)</span>

  bg <span class="token operator">&lt;-</span> ejscreen<span class="token operator">::</span>bg22<span class="token punctuation">[</span><span class="token punctuation">,</span> c<span class="token punctuation">(</span>ejscreen<span class="token operator">::</span>names.d<span class="token punctuation">,</span> <span class="token string">'pop'</span><span class="token punctuation">,</span> ejscreen<span class="token operator">::</span>names.e<span class="token punctuation">,</span> <span class="token string">'REGION'</span><span class="token punctuation">)</span><span class="token punctuation">]</span>

e <span class="token operator">&lt;-</span> bg<span class="token operator">$</span>pm<span class="token punctuation">[</span><span class="token operator">!</span>is.na<span class="token punctuation">(</span>bg<span class="token operator">$</span>pm<span class="token punctuation">)</span><span class="token punctuation">]</span>
dpct <span class="token operator">&lt;-</span> bg<span class="token operator">$</span>pctmin
dcount   <span class="token operator">&lt;-</span> bg<span class="token operator">$</span>pop<span class="token punctuation">[</span><span class="token operator">!</span>is.na<span class="token punctuation">(</span>bg<span class="token operator">$</span>pm<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">*</span>      dpct<span class="token punctuation">[</span><span class="token operator">!</span>is.na<span class="token punctuation">(</span>bg<span class="token operator">$</span>pm<span class="token punctuation">)</span><span class="token punctuation">]</span>
refcount <span class="token operator">&lt;-</span> bg<span class="token operator">$</span>pop<span class="token punctuation">[</span><span class="token operator">!</span>is.na<span class="token punctuation">(</span>bg<span class="token operator">$</span>pm<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">-</span> dpct<span class="token punctuation">[</span><span class="token operator">!</span>is.na<span class="token punctuation">(</span>bg<span class="token operator">$</span>pm<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
brks <span class="token operator">&lt;-</span> <span class="token number">0</span><span class="token operator">:</span><span class="token number">17</span>
etxt <span class="token operator">&lt;-</span> <span class="token string">'PM2.5'</span>
dtxt <span class="token operator">&lt;-</span> <span class="token string">'Minorities'</span>

pop.cdf<span class="token punctuation">(</span>        e<span class="token punctuation">,</span> pcts <span class="token operator">=</span> dpct<span class="token punctuation">,</span> pops <span class="token operator">=</span> bg<span class="token operator">$</span>pop<span class="token punctuation">)</span>
pop.cdf2<span class="token punctuation">(</span>       e<span class="token punctuation">,</span> dcount<span class="token punctuation">,</span> refcount<span class="token punctuation">,</span> etxt<span class="token punctuation">,</span> dtxt<span class="token punctuation">,</span> brks<span class="token punctuation">)</span>
pop.cdf.density<span class="token punctuation">(</span>e<span class="token punctuation">,</span> dcount<span class="token punctuation">,</span> refcount<span class="token punctuation">,</span> etxt<span class="token punctuation">,</span> dtxt <span class="token punctuation">)</span>

pop.cdf<span class="token punctuation">(</span>scores <span class="token operator">=</span> e<span class="token punctuation">,</span> pcts <span class="token operator">=</span> bg<span class="token operator">$</span>pctmin<span class="token punctuation">,</span> pops <span class="token operator">=</span> bg<span class="token operator">$</span>pop<span class="token punctuation">,</span>
 main<span class="token operator">=</span><span class="token string">'PM2.5 distribution within each group (minority vs other)'</span><span class="token punctuation">,</span>
  ylab<span class="token operator">=</span><span class="token string">'Density (percentage of group population)'</span><span class="token punctuation">)</span>

<span class="token comment">## End(Not run)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="pop.ecdf">

<a href="#pop.ecdf" class="help-page-title"><h2>Draw an Ecdf plot comparing distributions of scores in selected demographic groups</h2></a>

<h3>Description</h3>

<p>Draws a plot using <code><a href="https://harrelfe.r-universe.dev/manual/Hmisc.html#Ecdf">Hmisc::Ecdf()</a></code>, overlaying cumulative distribution functions,
one for each subgroup specified.
Useful to compare 2 groups based on each groups entire pdf or cdf  distribution of peoples scores,
using data from small places like census block groups, based on having for each place the pop total
and \
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">pop.ecdf<span class="token punctuation">(</span>
  scores<span class="token punctuation">,</span>
  pcts<span class="token punctuation">,</span>
  pops<span class="token punctuation">,</span>
  allothers <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">,</span>
  col <span class="token operator">=</span> <span class="token string">"red"</span><span class="token punctuation">,</span>
  main <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">,</span>
  weights<span class="token punctuation">,</span>
  subtitles <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">,</span>
  <span class="token ellipsis">...</span>
<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>scores</code></td>
<td>
<p>Numeric vector (or data.frame) required. Values to analyze.
If data.frame, then each column is plotted in its own panel.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pcts</code></td>
<td>
<p>Numeric vector (or data.frame), required. Same number of vector elements or data.frame
rows as length of scores vector (not sure what happens if pcts and scores are both data.frames).
Specifies the fraction of population that is in demographic group(s) of interest, one row per place, one column per group.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pops</code></td>
<td>
<p>Vector used to define weights as <code>pop * pcts</code>, and if <code>allothers=TRUE</code>, for <code>pop * (1-pcts)</code> for nongroup</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>allothers</code></td>
<td>
<p>Logical value, optional, TRUE by default. Whether to plot a series for everyone else, using 1-pct</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>col</code></td>
<td>
<p>Optional, default is 'red' to signify line color red for key demographic group.
Can also be a vector of colors if pcts is a data.frame with one column per group, one color per group.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>main</code></td>
<td>
<p>Optional character specifying plot title. Default title notes colors of lines and if reference group used.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>weights</code></td>
<td>
<p>Not used currently. See <code>pops</code> parameter</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>subtitles</code></td>
<td>
<p>Logical FALSE by default, which means extra info is not shown (see help on <code><a href="https://harrelfe.r-universe.dev/manual/Hmisc.html#Ecdf">Hmisc::Ecdf()</a></code>)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>other optional parameters to pass to Ecdf</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Notes: <br>
to compare zones, <br>
compare demog groups, (see parameter called group)<br>
compare multiple groups and/or multiple zones, like hisp vs others in us vs ca all on one graph<br>
see <code><a href="https://harrelfe.r-universe.dev/manual/Hmisc.html#Ecdf">Ecdf()</a></code> for options &amp; try passing a data.frame instead of just vector<br></p>


<h3>Value</h3>

<p>draws a plot
</p>


<h3>See Also</h3>

<p><code><a href="https://harrelfe.r-universe.dev/manual/Hmisc.html#Ecdf">Hmisc::Ecdf()</a></code> <code><a href="#RR">RR()</a></code> <code><a href="#pop.cdf">pop.cdf()</a></code>   <code><a href="#pop.cdf2">pop.cdf2()</a></code> <code><a href="#pop.ecdf">pop.ecdf()</a></code>  <code><a href="#pop.cdf.density">pop.cdf.density()</a></code>
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r"><span class="token comment">## #</span>
<span class="token comment">## Not run: </span>
pop.ecdf<span class="token punctuation">(</span> <span class="token number">31</span><span class="token operator">:</span><span class="token number">35</span><span class="token punctuation">,</span> c<span class="token punctuation">(</span><span class="token number">0.10</span><span class="token punctuation">,</span> <span class="token number">0.10</span><span class="token punctuation">,</span> <span class="token number">0.40</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0.20</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1001</span><span class="token operator">:</span><span class="token number">1005</span> <span class="token punctuation">)</span>

set.seed<span class="token punctuation">(</span><span class="token number">99</span><span class="token punctuation">)</span>
pctminsim<span class="token operator">=</span>c<span class="token punctuation">(</span>runif<span class="token punctuation">(</span><span class="token number">7000</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> pmin<span class="token punctuation">(</span>rlnorm<span class="token punctuation">(</span><span class="token number">5000</span><span class="token punctuation">,</span> meanlog<span class="token operator">=</span>log<span class="token punctuation">(</span><span class="token number">0.30</span><span class="token punctuation">)</span><span class="token punctuation">,</span> sdlog<span class="token operator">=</span><span class="token number">1.7</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">4</span><span class="token punctuation">)</span>
popsim<span class="token operator">=</span> runif<span class="token punctuation">(</span><span class="token number">12000</span><span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span>
esim<span class="token operator">=</span> rlnorm<span class="token punctuation">(</span><span class="token number">12000</span><span class="token punctuation">,</span> log<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span> log<span class="token punctuation">(</span><span class="token number">1.15</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> rnorm<span class="token punctuation">(</span><span class="token number">12000</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">)</span> <span class="token operator">*</span> pctminsim <span class="token operator">-</span> <span class="token number">1</span>
pop.ecdf<span class="token punctuation">(</span>esim<span class="token punctuation">,</span> pctminsim<span class="token punctuation">,</span> popsim<span class="token punctuation">,</span>
 xlab<span class="token operator">=</span><span class="token string">'Tract air pollution levels (vertical lines are group means)'</span><span class="token punctuation">,</span>
  main <span class="token operator">=</span> <span class="token string">'Air pollution levels among minorities (red curve) vs rest of US pop.'</span><span class="token punctuation">)</span>
abline<span class="token punctuation">(</span>v<span class="token operator">=</span>wtd.mean<span class="token punctuation">(</span>esim<span class="token punctuation">,</span> weights <span class="token operator">=</span> pctminsim <span class="token operator">*</span> popsim<span class="token punctuation">)</span><span class="token punctuation">,</span> col<span class="token operator">=</span><span class="token string">'red'</span><span class="token punctuation">)</span>
abline<span class="token punctuation">(</span>v<span class="token operator">=</span>wtd.mean<span class="token punctuation">(</span>esim<span class="token punctuation">,</span> weights <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">-</span>pctminsim<span class="token punctuation">)</span> <span class="token operator">*</span> popsim<span class="token punctuation">)</span><span class="token punctuation">,</span> col<span class="token operator">=</span><span class="token string">'black'</span><span class="token punctuation">)</span>

pop.ecdf<span class="token punctuation">(</span>bg<span class="token operator">$</span>pm<span class="token punctuation">,</span> bg<span class="token operator">$</span>pctmin<span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">,</span>
 xlab<span class="token operator">=</span><span class="token string">'Tract air pollution levels (vertical lines are group means)'</span><span class="token punctuation">,</span>
main <span class="token operator">=</span> <span class="token string">'PM2.5 levels among minorities (red curve) vs rest of US pop.'</span><span class="token punctuation">)</span>
abline<span class="token punctuation">(</span>v<span class="token operator">=</span>wtd.mean<span class="token punctuation">(</span>bg<span class="token operator">$</span>pm<span class="token punctuation">,</span> weights <span class="token operator">=</span> bg<span class="token operator">$</span>pctmin <span class="token operator">*</span> bg<span class="token operator">$</span>pop<span class="token punctuation">)</span><span class="token punctuation">,</span> col<span class="token operator">=</span><span class="token string">'red'</span><span class="token punctuation">)</span>
abline<span class="token punctuation">(</span>v<span class="token operator">=</span>wtd.mean<span class="token punctuation">(</span>bg<span class="token operator">$</span>pm<span class="token punctuation">,</span> weights <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">-</span>bg<span class="token operator">$</span>pctmin<span class="token punctuation">)</span> <span class="token operator">*</span> bg<span class="token operator">$</span>pop<span class="token punctuation">)</span><span class="token punctuation">,</span> col<span class="token operator">=</span><span class="token string">'black'</span><span class="token punctuation">)</span>

<span class="token comment">#pop.ecdf(dat$Murder, dat$Population * (dat$Illiteracy/100))</span>
pop.ecdf<span class="token punctuation">(</span>bg<span class="token operator">$</span>pm<span class="token punctuation">,</span> bg<span class="token operator">$</span>pctmin<span class="token punctuation">,</span> bg<span class="token operator">$</span>pop<span class="token punctuation">,</span>
 main<span class="token operator">=</span><span class="token string">'PM2.5 levels among minorities (red curve) vs rest of pop (vertical lines=group means)'</span><span class="token punctuation">)</span>
abline<span class="token punctuation">(</span>v<span class="token operator">=</span>wtd.mean<span class="token punctuation">(</span>bg<span class="token operator">$</span>pm<span class="token punctuation">,</span> weights <span class="token operator">=</span> bg<span class="token operator">$</span>pctmin <span class="token operator">*</span> bg<span class="token operator">$</span>pop<span class="token punctuation">)</span><span class="token punctuation">,</span> col<span class="token operator">=</span><span class="token string">'red'</span><span class="token punctuation">)</span>
abline<span class="token punctuation">(</span>v<span class="token operator">=</span>wtd.mean<span class="token punctuation">(</span>bg<span class="token operator">$</span>pm<span class="token punctuation">,</span> weights <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">-</span>bg<span class="token operator">$</span>pctmin<span class="token punctuation">)</span> <span class="token operator">*</span> bg<span class="token operator">$</span>pop<span class="token punctuation">)</span><span class="token punctuation">,</span> col<span class="token operator">=</span><span class="token string">'black'</span><span class="token punctuation">)</span>

pop.ecdf<span class="token punctuation">(</span>log10<span class="token punctuation">(</span>places<span class="token operator">$</span>traffic.score<span class="token punctuation">)</span><span class="token punctuation">,</span> places<span class="token operator">$</span>pctmin<span class="token punctuation">,</span> places<span class="token operator">$</span>pop<span class="token punctuation">)</span>
pop.ecdf<span class="token punctuation">(</span>places<span class="token operator">$</span>cancer<span class="token punctuation">,</span> places<span class="token operator">$</span>pctmin<span class="token punctuation">,</span> places<span class="token operator">$</span>pop<span class="token punctuation">,</span> allothers<span class="token operator">=</span><span class="token boolean">FALSE</span><span class="token punctuation">)</span>
pop.ecdf<span class="token punctuation">(</span>places<span class="token operator">$</span>cancer<span class="token punctuation">,</span> places<span class="token operator">$</span>pctlingiso<span class="token punctuation">,</span> places<span class="token operator">$</span>pop<span class="token punctuation">,</span> col<span class="token operator">=</span><span class="token string">'green'</span><span class="token punctuation">,</span> allothers<span class="token operator">=</span><span class="token boolean">FALSE</span><span class="token punctuation">,</span> add<span class="token operator">=</span><span class="token boolean">TRUE</span><span class="token punctuation">)</span>
<span class="token comment"># Demog suscept  for each REGION (can't see if use vs others)</span>
pop.ecdf<span class="token punctuation">(</span>bg<span class="token operator">$</span>traffic.score<span class="token punctuation">,</span> bg<span class="token operator">$</span>VSI.eo<span class="token punctuation">,</span> bg<span class="token operator">$</span>pop<span class="token punctuation">,</span> log<span class="token operator">=</span><span class="token string">'x'</span><span class="token punctuation">,</span> subtitles<span class="token operator">=</span><span class="token boolean">FALSE</span><span class="token punctuation">,</span>
         group<span class="token operator">=</span>bg<span class="token operator">$</span>REGION<span class="token punctuation">,</span> allothers<span class="token operator">=</span><span class="token boolean">FALSE</span><span class="token punctuation">,</span>
         xlab<span class="token operator">=</span><span class="token string">'Traffic score (log scale)'</span><span class="token punctuation">,</span> ylab<span class="token operator">=</span><span class="token string">'%ile of population'</span><span class="token punctuation">,</span>
          main<span class="token operator">=</span><span class="token string">'Distribution of scores by EPA Region'</span><span class="token punctuation">)</span>

<span class="token comment"># Demog suscept (how to show vs others??), one panel per ENVT FACTOR (ie per col in scores df)</span>
data<span class="token punctuation">(</span><span class="token string">'names.e'</span><span class="token punctuation">)</span>
pop.ecdf<span class="token punctuation">(</span>bg<span class="token punctuation">[</span> <span class="token punctuation">,</span> names.e<span class="token punctuation">]</span><span class="token punctuation">,</span> bg<span class="token operator">$</span>VSI.eo<span class="token punctuation">,</span> bg<span class="token operator">$</span>pop<span class="token punctuation">,</span> log<span class="token operator">=</span><span class="token string">'x'</span><span class="token punctuation">,</span> subtitles<span class="token operator">=</span><span class="token boolean">FALSE</span><span class="token punctuation">,</span>
         allothers<span class="token operator">=</span><span class="token boolean">TRUE</span><span class="token punctuation">,</span> ylab<span class="token operator">=</span><span class="token string">'%ile of population'</span><span class="token punctuation">,</span>
          main<span class="token operator">=</span><span class="token string">'Distribution of scores by EPA Region'</span><span class="token punctuation">)</span>

<span class="token comment"># log scale is useful &amp; so are these labels passed to function</span>
<span class="token comment"># in CA vs not CA</span>
pop.ecdf<span class="token punctuation">(</span>bg<span class="token operator">$</span>traffic.score<span class="token punctuation">,</span> bg<span class="token operator">$</span>ST<span class="token operator">==</span><span class="token string">'CA'</span><span class="token punctuation">,</span> bg<span class="token operator">$</span>pop<span class="token punctuation">,</span>
         subtitles<span class="token operator">=</span><span class="token boolean">FALSE</span><span class="token punctuation">,</span>
         log<span class="token operator">=</span><span class="token string">'x'</span><span class="token punctuation">,</span> xlab<span class="token operator">=</span><span class="token string">'%ile of population'</span><span class="token punctuation">,</span> ylab<span class="token operator">=</span><span class="token string">'Traffic scores (log scale)'</span><span class="token punctuation">,</span>
         main<span class="token operator">=</span><span class="token string">'Distribution of scores in CA (red) vs rest of US'</span><span class="token punctuation">)</span>

<span class="token comment"># Flagged vs not (all D, all zones)</span>
pop.ecdf<span class="token punctuation">(</span>bg<span class="token operator">$</span>traffic.score<span class="token punctuation">,</span> bg<span class="token operator">$</span>flagged<span class="token punctuation">,</span> bg<span class="token operator">$</span>pop<span class="token punctuation">,</span> log<span class="token operator">=</span><span class="token string">'x'</span><span class="token punctuation">)</span>

<span class="token comment"># D=Hispanics vs others, within CA zone only</span>
pop.ecdf<span class="token punctuation">(</span>bg<span class="token operator">$</span>traffic.score<span class="token punctuation">,</span> bg<span class="token operator">$</span>ST<span class="token operator">==</span><span class="token string">'CA'</span><span class="token punctuation">,</span> bg<span class="token operator">$</span>pop <span class="token operator">*</span> bg<span class="token operator">$</span>pcthisp<span class="token punctuation">,</span> log<span class="token operator">=</span><span class="token string">'x'</span><span class="token punctuation">)</span>
<span class="token comment"># Demog suscept vs others, within CA only</span>
pop.ecdf<span class="token punctuation">(</span>bg<span class="token operator">$</span>traffic.score<span class="token punctuation">,</span> bg<span class="token operator">$</span>ST<span class="token operator">==</span><span class="token string">'CA'</span><span class="token punctuation">,</span> bg<span class="token operator">$</span>pop <span class="token operator">*</span> bg<span class="token operator">$</span>VSI.eo<span class="token punctuation">,</span> log<span class="token operator">=</span><span class="token string">'x'</span><span class="token punctuation">)</span>


<span class="token comment">## End(Not run)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="pop.ecdf.dd">

<a href="#pop.ecdf.dd" class="help-page-title"><h2>Draw an Ecdf plot showing the distribution of scores in each demographic subgroup</h2></a>

<h3>Description</h3>

<p>Draws a plot using <code><a href="https://harrelfe.r-universe.dev/manual/Hmisc.html#Ecdf">Hmisc::Ecdf()</a></code>, overlaying cumulative distribution functions,
one for each subgroup specified, and one for overall population.
Useful to compare subgroups based on the distribution of scores among people in that subgroup
using data from small places like census block groups, based on having for each place the pop total
and % of pop that is in each group.
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">pop.ecdf.dd<span class="token punctuation">(</span>
  e<span class="token punctuation">,</span>
  elab<span class="token punctuation">,</span>
  mydf<span class="token punctuation">,</span>
  dlabs <span class="token operator">=</span> colnames<span class="token punctuation">(</span>mydf<span class="token punctuation">)</span><span class="token punctuation">,</span>
  mywt <span class="token operator">=</span> rep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> NROW<span class="token punctuation">(</span>mydf<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  main<span class="token punctuation">,</span>
  mycolors<span class="token punctuation">,</span>
  refcolor <span class="token operator">=</span> <span class="token string">"black"</span><span class="token punctuation">,</span>
  sorted <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">,</span>
  log <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">,</span>
  <span class="token ellipsis">...</span>
<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>e</code></td>
<td>
<p>Required numeric vector of scores (e.g., environmental indicator values) for places like block groups, one place per row</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>elab</code></td>
<td>
<p>Required character single element vector with text label for environmental score, used in xlab of plot</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mydf</code></td>
<td>
<p>Required data.frame where each row is a place and each column is the percent of place population that is in given demographic subgroup, one subgroup per column</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dlabs</code></td>
<td>
<p>Optional, charater vector that specifies text for legend, same length as number of columns in mydf</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mywt</code></td>
<td>
<p>Optional, default is unweighted, but normally would specify as the population counts for places analyzed</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>main</code></td>
<td>
<p>Optional character specifying plot title at top of plot. Default title notes names of subgroups</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mycolors</code></td>
<td>
<p>Optional vector of colors as long as number of columns in mydf, specifies colors of lines</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>refcolor</code></td>
<td>
<p>Optional color, default is 'black'</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sorted</code></td>
<td>
<p>Optional logical, default is TRUE. Should the legend be sorted in order of population weighted mean values of e?</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>log</code></td>
<td>
<p>Default is . Passed to <code><a href="#pop.ecdf">pop.ecdf()</a></code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Other optional parameters to pass to Ecdf</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>Draws a plot
</p>


<h3>See Also</h3>

<p><code><a href="https://harrelfe.r-universe.dev/manual/Hmisc.html#Ecdf">Hmisc::Ecdf()</a></code> <code><a href="#RR">RR()</a></code> <code><a href="#pop.cdf">pop.cdf()</a></code>   <code><a href="#pop.cdf2">pop.cdf2()</a></code> <code><a href="#pop.ecdf">pop.ecdf()</a></code>  <code><a href="#pop.cdf.density">pop.cdf.density()</a></code>
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r"><span class="token comment">## #</span>
<span class="token comment">## Not run: </span>
set.seed<span class="token punctuation">(</span><span class="token number">99</span><span class="token punctuation">)</span>
pctminsim<span class="token operator">=</span>c<span class="token punctuation">(</span>runif<span class="token punctuation">(</span><span class="token number">7000</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> pmin<span class="token punctuation">(</span>rlnorm<span class="token punctuation">(</span><span class="token number">5000</span><span class="token punctuation">,</span> meanlog<span class="token operator">=</span>log<span class="token punctuation">(</span><span class="token number">0.30</span><span class="token punctuation">)</span><span class="token punctuation">,</span> sdlog<span class="token operator">=</span><span class="token number">1.7</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">4</span><span class="token punctuation">)</span>
popsim<span class="token operator">=</span> runif<span class="token punctuation">(</span><span class="token number">12000</span><span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span>
esim<span class="token operator">=</span> rlnorm<span class="token punctuation">(</span><span class="token number">12000</span><span class="token punctuation">,</span> log<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span> log<span class="token punctuation">(</span><span class="token number">1.15</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> rnorm<span class="token punctuation">(</span><span class="token number">12000</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">)</span> <span class="token operator">*</span> pctminsim <span class="token operator">-</span> <span class="token number">1</span>

<span class="token comment">## End(Not run)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="rollup">

<a href="#rollup" class="help-page-title"><h2>Aggregate multiple columns of values by group</h2></a>

<h3>Description</h3>

<p>aggregate over zones - !!! work in progress  NOT DONE YET !!! see source code for notes on data.table and speed
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">rollup<span class="token punctuation">(</span>x<span class="token punctuation">,</span> by <span class="token operator">=</span> <span class="token keyword">NULL</span><span class="token punctuation">,</span> wts <span class="token operator">=</span> <span class="token keyword">NULL</span><span class="token punctuation">,</span> FUN<span class="token punctuation">,</span> prefix <span class="token operator">=</span> <span class="token string">"wtd.mean."</span><span class="token punctuation">,</span> na.rm <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>Dataset</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>by</code></td>
<td>
<p>No default. Vector that defines groups, for aggregating by group.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>wts</code></td>
<td>
<p>Weights, default is unweighted</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>FUN</code></td>
<td>
<p>Default is weighted mean</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>prefix</code></td>
<td>
<p>Default is 'wtd.mean.'</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>na.rm</code></td>
<td>
<p>Default is TRUE, NOT USED IF FUN IS DEFINED BY CALL TO THIS FUNCTION. passed to <code><a href="https://harrelfe.r-universe.dev/manual/Hmisc.html#wtd.stats">Hmisc::wtd.mean()</a></code></p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>by Vector defining groups
</p>


<h3>See Also</h3>

<p><code><a>wtd.colMeans()</a></code> <code><a>ejscreen::ejscreen.rollup()</a></code>
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r"><span class="token comment"># See ejscreen package function called ejscreen.rollup()</span>
  <span class="token comment">## Not run: </span>
  <span class="token comment"># draft of COMPLETE EXAMPLE - NOT TESTED:</span>
 <span class="token comment"># SPECIFY FIELDS TO ROLLUP VIA WTD AVG AND</span>
 <span class="token comment"># WHICH TO DO VIA SUM OVER US/REGION/COUNTY/STATE/TRACT</span>

 <span class="token comment"># load('bg ... plus race eth subgrps ACS0812.RData') # if not already working with it</span>

require<span class="token punctuation">(</span>analyze.stuff<span class="token punctuation">)</span>
require<span class="token punctuation">(</span>ejanalysis<span class="token punctuation">)</span>
require<span class="token punctuation">(</span>ejscreen<span class="token punctuation">)</span>

data<span class="token punctuation">(</span>names.e<span class="token punctuation">)</span><span class="token punctuation">;</span> data<span class="token punctuation">(</span>names.ej<span class="token punctuation">)</span><span class="token punctuation">;</span> data<span class="token punctuation">(</span>names.d<span class="token punctuation">)</span>
<span class="token comment"># Available for rolling up by: 'FIPS', "FIPS.TRACT", "FIPS.COUNTY", "FIPS.ST", 'REGION'</span>

 <span class="token comment"># Get the sum for all the raw counts, and area</span>
sumnames <span class="token operator">&lt;-</span> c<span class="token punctuation">(</span><span class="token string">'area'</span><span class="token punctuation">,</span> <span class="token string">'pop'</span><span class="token punctuation">,</span> <span class="token string">'povknownratio'</span><span class="token punctuation">,</span> <span class="token string">'age25up'</span><span class="token punctuation">,</span> <span class="token string">'hhlds'</span><span class="token punctuation">,</span> <span class="token string">'builtunits'</span><span class="token punctuation">,</span>
              <span class="token string">'mins'</span><span class="token punctuation">,</span> <span class="token string">'lowinc'</span><span class="token punctuation">,</span> <span class="token string">'lths'</span><span class="token punctuation">,</span> <span class="token string">'lingiso'</span><span class="token punctuation">,</span> <span class="token string">'under5'</span><span class="token punctuation">,</span> <span class="token string">'over64'</span><span class="token punctuation">,</span> <span class="token string">'pre1960'</span><span class="token punctuation">,</span>
              <span class="token string">'VNI.eo'</span><span class="token punctuation">,</span> <span class="token string">'VNI.svi6'</span><span class="token punctuation">,</span>
              <span class="token string">'VDI.eo'</span><span class="token punctuation">,</span> <span class="token string">'VDI.svi6'</span><span class="token punctuation">,</span>
              names.d.subgroups.count<span class="token punctuation">,</span> <span class="token string">'nonmins'</span><span class="token punctuation">)</span>
<span class="token comment"># Get the rollups of summed cols</span>
us       <span class="token operator">&lt;-</span> rollup<span class="token punctuation">(</span> bg<span class="token punctuation">[</span> <span class="token punctuation">,</span> sumnames<span class="token punctuation">]</span><span class="token punctuation">,</span> FUN<span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span>z<span class="token punctuation">)</span> sum<span class="token punctuation">(</span>z<span class="token punctuation">,</span> na.rm <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">)</span><span class="token punctuation">,</span> prefix <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">)</span>
regions  <span class="token operator">&lt;-</span> rollup<span class="token punctuation">(</span> bg<span class="token punctuation">[</span> <span class="token punctuation">,</span> sumnames<span class="token punctuation">]</span><span class="token punctuation">,</span> FUN<span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span>z<span class="token punctuation">)</span> sum<span class="token punctuation">(</span>z<span class="token punctuation">,</span> na.rm <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">)</span><span class="token punctuation">,</span> prefix <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">,</span> by<span class="token operator">=</span>bg<span class="token operator">$</span>REGION<span class="token punctuation">)</span>
names<span class="token punctuation">(</span>regions<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">&lt;-</span> <span class="token string">'REGION'</span>
states   <span class="token operator">&lt;-</span> rollup<span class="token punctuation">(</span> bg<span class="token punctuation">[</span> <span class="token punctuation">,</span> sumnames<span class="token punctuation">]</span><span class="token punctuation">,</span> FUN<span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span>z<span class="token punctuation">)</span> sum<span class="token punctuation">(</span>z<span class="token punctuation">,</span> na.rm <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">)</span><span class="token punctuation">,</span> prefix <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">,</span> by<span class="token operator">=</span>bg<span class="token operator">$</span>FIPS.ST<span class="token punctuation">)</span>
names<span class="token punctuation">(</span>states<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">&lt;-</span> <span class="token string">'FIPS.ST'</span>
counties <span class="token operator">&lt;-</span> rollup<span class="token punctuation">(</span> bg<span class="token punctuation">[</span> <span class="token punctuation">,</span> sumnames<span class="token punctuation">]</span><span class="token punctuation">,</span> FUN<span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span>z<span class="token punctuation">)</span> sum<span class="token punctuation">(</span>z<span class="token punctuation">,</span> na.rm <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">)</span><span class="token punctuation">,</span> prefix <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">,</span> by<span class="token operator">=</span>bg<span class="token operator">$</span>FIPS.COUNTY<span class="token punctuation">)</span>
names<span class="token punctuation">(</span>counties<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">&lt;-</span> <span class="token string">'FIPS.COUNTY'</span>
tracts   <span class="token operator">&lt;-</span> rollup<span class="token punctuation">(</span> bg<span class="token punctuation">[</span> <span class="token punctuation">,</span> sumnames<span class="token punctuation">]</span><span class="token punctuation">,</span> FUN<span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span>z<span class="token punctuation">)</span> sum<span class="token punctuation">(</span>z<span class="token punctuation">,</span> na.rm <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">)</span><span class="token punctuation">,</span> prefix <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">,</span> by<span class="token operator">=</span>bg<span class="token operator">$</span>FIPS.TRACT<span class="token punctuation">)</span>
names<span class="token punctuation">(</span>tracts<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">&lt;-</span> <span class="token string">'FIPS.TRACT'</span>

 <span class="token comment"># Get the rollups of wtd.mean cols (at least E cols)</span>
avgnames <span class="token operator">&lt;-</span> names.e
us.avg       <span class="token operator">&lt;-</span> rollup<span class="token punctuation">(</span> bg<span class="token punctuation">[</span> <span class="token punctuation">,</span> avgnames<span class="token punctuation">]</span><span class="token punctuation">,</span> prefix <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">,</span> wts<span class="token operator">=</span>bg<span class="token operator">$</span>pop<span class="token punctuation">)</span>
regions.avg  <span class="token operator">&lt;-</span> rollup<span class="token punctuation">(</span> bg<span class="token punctuation">[</span> <span class="token punctuation">,</span> avgnames<span class="token punctuation">]</span><span class="token punctuation">,</span> prefix <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">,</span> wts<span class="token operator">=</span>bg<span class="token operator">$</span>pop<span class="token punctuation">,</span> by<span class="token operator">=</span>bg<span class="token operator">$</span>REGION<span class="token punctuation">)</span>
names<span class="token punctuation">(</span>regions.avg<span class="token punctuation">)</span>  <span class="token operator">&lt;-</span> gsub<span class="token punctuation">(</span><span class="token string">'by'</span><span class="token punctuation">,</span> <span class="token string">'REGION'</span><span class="token punctuation">,</span>  names<span class="token punctuation">(</span>regions.avg<span class="token punctuation">)</span><span class="token punctuation">)</span>
states.avg   <span class="token operator">&lt;-</span> rollup<span class="token punctuation">(</span> bg<span class="token punctuation">[</span> <span class="token punctuation">,</span> avgnames<span class="token punctuation">]</span><span class="token punctuation">,</span> prefix <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">,</span> wts<span class="token operator">=</span>bg<span class="token operator">$</span>pop<span class="token punctuation">,</span> by<span class="token operator">=</span>bg<span class="token operator">$</span>FIPS.ST<span class="token punctuation">)</span>
names<span class="token punctuation">(</span>states.avg<span class="token punctuation">)</span>   <span class="token operator">&lt;-</span> gsub<span class="token punctuation">(</span><span class="token string">'by'</span><span class="token punctuation">,</span> <span class="token string">'FIPS.ST'</span><span class="token punctuation">,</span> names<span class="token punctuation">(</span>states.avg<span class="token punctuation">)</span><span class="token punctuation">)</span>
counties.avg <span class="token operator">&lt;-</span> rollup<span class="token punctuation">(</span> bg<span class="token punctuation">[</span> <span class="token punctuation">,</span> avgnames<span class="token punctuation">]</span><span class="token punctuation">,</span> prefix <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">,</span> wts<span class="token operator">=</span>bg<span class="token operator">$</span>pop<span class="token punctuation">,</span> by<span class="token operator">=</span>bg<span class="token operator">$</span>FIPS.COUNTY<span class="token punctuation">)</span>
names<span class="token punctuation">(</span>counties.avg<span class="token punctuation">)</span> <span class="token operator">&lt;-</span> gsub<span class="token punctuation">(</span><span class="token string">'by'</span><span class="token punctuation">,</span> <span class="token string">'FIPS.COUNTY'</span><span class="token punctuation">,</span> names<span class="token punctuation">(</span>counties.avg<span class="token punctuation">)</span><span class="token punctuation">)</span>
tracts.avg   <span class="token operator">&lt;-</span> rollup<span class="token punctuation">(</span> bg<span class="token punctuation">[</span> <span class="token punctuation">,</span> avgnames<span class="token punctuation">]</span><span class="token punctuation">,</span> prefix <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">,</span> wts<span class="token operator">=</span>bg<span class="token operator">$</span>pop<span class="token punctuation">,</span> by<span class="token operator">=</span>bg<span class="token operator">$</span>FIPS.TRACT<span class="token punctuation">)</span>
names<span class="token punctuation">(</span>tracts.avg<span class="token punctuation">)</span>   <span class="token operator">&lt;-</span> gsub<span class="token punctuation">(</span><span class="token string">'by'</span><span class="token punctuation">,</span> <span class="token string">'FIPS.TRACT'</span><span class="token punctuation">,</span>  names<span class="token punctuation">(</span>tracts.avg<span class="token punctuation">)</span><span class="token punctuation">)</span>

 <span class="token comment"># Merge sum and mean types of cols</span>
us <span class="token operator">&lt;-</span> cbind<span class="token punctuation">(</span>us<span class="token punctuation">,</span> us.avg<span class="token punctuation">,</span> stringsAsFactors<span class="token operator">=</span><span class="token boolean">FALSE</span><span class="token punctuation">)</span>
regions  <span class="token operator">&lt;-</span> merge<span class="token punctuation">(</span>regions<span class="token punctuation">,</span> regions.avg<span class="token punctuation">,</span> by<span class="token operator">=</span><span class="token string">'REGION'</span><span class="token punctuation">)</span>
states   <span class="token operator">&lt;-</span> merge<span class="token punctuation">(</span>states<span class="token punctuation">,</span>   states.avg<span class="token punctuation">,</span> by<span class="token operator">=</span><span class="token string">'FIPS.ST'</span><span class="token punctuation">)</span>
counties <span class="token operator">&lt;-</span> merge<span class="token punctuation">(</span>counties<span class="token punctuation">,</span> counties.avg<span class="token punctuation">,</span> by<span class="token operator">=</span><span class="token string">'FIPS.COUNTY'</span><span class="token punctuation">)</span>
tracts   <span class="token operator">&lt;-</span> merge<span class="token punctuation">(</span>tracts<span class="token punctuation">,</span>   tracts.avg<span class="token punctuation">,</span> by<span class="token operator">=</span><span class="token string">'FIPS.TRACT'</span><span class="token punctuation">)</span>

 <span class="token comment"># Now calculate the derived fields like pct demog fields, EJ indexes, pctiles, bins, etc.</span>
See ejscreen<span class="token operator">::</span>ejscreen.acs.calc<span class="token punctuation">(</span><span class="token punctuation">)</span>


<span class="token comment">## End(Not run)</span>

<span class="token comment">## Not run: </span>
<span class="token comment"># OLDER, SLOW BUT SEEMS TO WORK SOMEWHAT</span>
<span class="token comment"># 1.Do rollup of most fields as wtd mean</span>
   t2 <span class="token operator">&lt;-</span> rollup<span class="token punctuation">(</span>bg<span class="token punctuation">[</span> <span class="token punctuation">,</span> names.e<span class="token punctuation">]</span><span class="token punctuation">,</span> by<span class="token operator">=</span>bg<span class="token operator">$</span>FIPS.TRACT<span class="token punctuation">,</span> wts<span class="token operator">=</span>bg<span class="token operator">$</span>pop<span class="token punctuation">)</span>
   names<span class="token punctuation">(</span>t2<span class="token punctuation">)</span> <span class="token operator">&lt;-</span> gsub<span class="token punctuation">(</span><span class="token string">'by'</span><span class="token punctuation">,</span> <span class="token string">'FIPS.TRACT'</span><span class="token punctuation">,</span> names<span class="token punctuation">(</span>t2<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># 2.Do rollup of pop and areas as sum not wtd.mean:</span>
 <span class="token comment"># not sure aggregate preserves sort order that rollup created,</span>
 <span class="token comment"># so use merge to be sure they match up on fips:</span>
   tractpop <span class="token operator">&lt;-</span> aggregate<span class="token punctuation">(</span>bg<span class="token punctuation">[</span> <span class="token punctuation">,</span> c<span class="token punctuation">(</span><span class="token string">'pop'</span><span class="token punctuation">,</span> <span class="token string">'area'</span><span class="token punctuation">,</span> <span class="token string">'sqmi'</span><span class="token punctuation">,</span> <span class="token string">'sqkm'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> by<span class="token operator">=</span>list<span class="token punctuation">(</span>bg<span class="token operator">$</span>FIPS.TRACT<span class="token punctuation">)</span><span class="token punctuation">,</span> sum<span class="token punctuation">)</span>
   names<span class="token punctuation">(</span>tractpop<span class="token punctuation">)</span> <span class="token operator">&lt;-</span> c<span class="token punctuation">(</span><span class="token string">'FIPS.TRACT'</span><span class="token punctuation">,</span> c<span class="token punctuation">(</span><span class="token string">'pop'</span><span class="token punctuation">,</span> <span class="token string">'sqmi'</span><span class="token punctuation">,</span> <span class="token string">'sqkm'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># 3.Merge the wtd.mean fields and sum fields, sort results.</span>
   t2 <span class="token operator">&lt;-</span> merge<span class="token punctuation">(</span>t2<span class="token punctuation">,</span> tractpop<span class="token punctuation">,</span> by<span class="token operator">=</span><span class="token string">'FIPS.TRACT'</span><span class="token punctuation">)</span>
   rm<span class="token punctuation">(</span>tractpop<span class="token punctuation">)</span>
   t2 <span class="token operator">&lt;-</span> t2<span class="token punctuation">[</span> order<span class="token punctuation">(</span>t2<span class="token operator">$</span>FIPS.TRACT<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">]</span>

<span class="token comment">## End(Not run)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="rollup.pct">

<a href="#rollup.pct" class="help-page-title"><h2>Calculate a/b for each Subset</h2></a>

<h3>Description</h3>

<p>Uses data.table package to quickly calculate
ratio of a/b within each subset of a dataset (e.g., by zone).
This will be superseded by <code><a href="#rollup">rollup()</a></code> once that is completed.
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">rollup.pct<span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> zone<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>a</code></td>
<td>
<p>Required numeric vector, numerator</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>b</code></td>
<td>
<p>Required numeric vector, denominator. Same length as a.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>zone</code></td>
<td>
<p>Optional, vector to group by. Same length as a and b.</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>Returns a table with a/b calculated within each zone.
</p>


<h3>See Also</h3>

<p><code><a href="#make.bin.pctile.cols">make.bin.pctile.cols</a></code> to call functions below, converting columns of values to percentiles and then bins <br><code><a href="#assign.pctiles">assign.pctiles</a></code> for one vector, assign (weighted) percentile (quantile) to each value within its zone (subset)  <br><code><a href="#assign.pctiles.alt2">assign.pctiles.alt2</a></code> as an alternative method, to replicate assign.pctiles, but not by zone <br><code><a href="#get.pctile">get.pctile</a></code> to get (weighted) percentile of just 1+ values within given vector of values <br><code><a href="#make.pctile.cols">make.pctile.cols</a></code> for a data.frame, assign percentiles, return a same-sized df that is wtd.quantile of each value within its column <br><code><a href="#make.pctile.cols.alt2">make.pctile.cols.alt2</a></code> as an alternative method, to replicate make.pctile.cols <br><code><a href="#assign.map.bins">assign.map.bins</a></code> for one vector (or data.frame) of values (e.g. percentiles), return same-sized df that is bin number (map color bin) using preset breaks. <br><code><a href="#make.bin.cols">make.bin.cols</a></code> for a data.frame of values (e.g. percentiles), return same-sized df that is bin number (map color bin) using preset breaks. <br><code><a href="#write.pctiles">write.pctiles</a></code> to save file that is lookup table of percentiles for columns of a data.frame <br><code><a href="#write.pctiles.by.zone">write.pctiles.by.zone</a></code> to save file that is lookup table of percentiles for columns of a data.frame, for each geographic zone (subset of rows) <br><code><a href="#write.wtd.pctiles">write.wtd.pctiles</a></code> to save file that is lookup table of weighted percentiles for columns of a data.frame <br><code><a href="#write.wtd.pctiles.by.zone">write.wtd.pctiles.by.zone</a></code> to save file that is lookup table of weighted percentiles for columns of a data.frame, for each geographic zone (subset of rows) <br><code><a href="#lookup.pctile">lookup.pctile</a></code> to look up current approx weighted percentiles in a lookup table that is already in global memory <br></p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r">pre1960<span class="token operator">=</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">100</span><span class="token punctuation">;</span> builtunits<span class="token operator">=</span>rep<span class="token punctuation">(</span>c<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">;</span> zone<span class="token operator">=</span>rep<span class="token punctuation">(</span>c<span class="token punctuation">(</span><span class="token string">'NY'</span><span class="token punctuation">,</span><span class="token string">'MA'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">50</span><span class="token punctuation">)</span>
  rollup.pct<span class="token punctuation">(</span>a<span class="token punctuation">,</span>b<span class="token punctuation">,</span>zone<span class="token punctuation">)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="RR">

<a href="#RR" class="help-page-title"><h2>Relative Risk (RR) by demographic group by indicator based on Census data</h2></a>

<h3>Description</h3>

<p>Finds the ratio of mean indicator value in one demographic subgroup to mean in everyone else,
based on data for each spatial unit such as for block groups or tracts.
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">RR<span class="token punctuation">(</span>e<span class="token punctuation">,</span> d<span class="token punctuation">,</span> pop<span class="token punctuation">,</span> dref<span class="token punctuation">,</span> na.rm <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>e</code></td>
<td>
<p>Vector or data.frame or matrix with 1 or more environmental indicator(s) or health risk level
(e.g., PM2.5 concentration to which this person or place is exposed),
one row per Census unit and one column per indicator.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>d</code></td>
<td>
<p>Vector or data.frame or matrix with 1 or more demog groups percentage
(as fraction of 1, not 0-100!)
of place that is selected demog group (e.g. percent Hispanic)
(or d=1 or 0 per row if this is a vector of individuals)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pop</code></td>
<td>
<p>Vector of one row per location providing population count of place
(or pop=1 if this is a vector of individuals),
to convert d into a count since d is a fraction</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dref</code></td>
<td>
<p>Optional vector specifying a reference group for RR calculation
by providing what percentage (as fraction of 1, not 0-100!) of place that is individuals in the reference group
(or dref= vector of ones and zeroes if this is a vector of individuals)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>na.rm</code></td>
<td>
<p>Optional, logical, TRUE by default. Specify if NA values should be removed first.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>This function requires, for each Census unit, demographic data on total population and percent in each demographic group,
and some indicator(s) for each Census unit, such as health status, exposure estimates, or environmental health risk.
For example, given population count, percent Hispanic, and ppm of ozone for each tract, this calculates the ratio
of the population mean tract-level ozone concentration among Hispanics divided by the same value among all non-Hispanics.
The result is a ratio of means for two demographic groups, or for each of several groups and indicators.
Each e (for environmental indicator) or d (for demographic percentage) is specified as a vector over small places like Census blocks or block groups
or even individuals (ideally) but then d would be a dummy=1 for selected group and 0 for people not in selected group
</p>
<p>note: this currently does not use rrf() &amp; rrfv() but perhaps it would be faster if it did? but rrfv not tested for multiple demog groups <br></p>
<p>NEED TO VERIFY/TEST THIS: REMOVES PLACES WITH NA in any one or more of the values used (e, d, pop, dref) in numerators and denominators. <br></p>
<p>Note also that THIS REMOVES NA VALUES FOR one e factor and not for another,
so results can use different places &amp; people for different e factors
</p>


<h3>Value</h3>

<p>numeric results as vector or data.frame
</p>


<h3>See Also</h3>


<ul>
<li> <p><code><a href="#ej.indexes">ej.indexes</a></code> for local contribution to a variety of overall disparity metrics such as excess risk
</p>
</li>
<li> <p><code><a href="#RR">RR</a></code> to calculate overall disparity metric as relative risk (RR), ratio of mean environmental indicator values across demographic groups
</p>
</li>
<li> <p><code><a href="#RR.table">RR.table</a></code> to create 3-D table of RR values, by demographic group by environmental indicator by zone
</p>
</li>
<li> <p><code><a href="#RR.table.sort">RR.table.sort</a></code> to sort existing RR table
</p>
</li>
<li> <p><code><a href="#RR.table.add">RR.table.add</a></code> to add zone(s) to existing RR table
</p>
</li>
<li> <p><code><a href="#write.RR.tables">write.RR.tables</a></code> to write a file with a table or RR by indicator by group
</p>
</li>
<li> <p><code><a href="#ej.added">ej.added</a></code> to find EJ Index as local contribution to sum of EJ Indexes
</p>
</li>
<li> <p><code><a href="#RR.cut.if.gone">RR.cut.if.gone</a></code> to find local contribution to RR
</p>
</li>
<li> <p><code><a href="#RR.if.address.top.x">RR.if.address.top.x</a></code> to find how much RR would change if top-ranked places had different conditions
</p>
</li>
<li> <p><code><a href="#rrfv">rrfv</a></code> for obsolete attempt to vectorize rrf
</p>
</li>
<li> <p><code><a href="#rrf">rrf</a></code> for older simpler function for RR of one indicator for one demographic group
</p>
</li>
<li> <p><code><a href="#pop.ecdf">pop.ecdf</a></code> to compare plots of cumulative frequency distribution of indicator values by group
</p>
</li>
</ul>
<h3>Examples</h3>

<pre class="language-r"><code class="language-r">bg <span class="token operator">&lt;-</span> structure<span class="token punctuation">(</span>list<span class="token punctuation">(</span>state <span class="token operator">=</span> structure<span class="token punctuation">(</span>c<span class="token punctuation">(</span><span class="token number">1L</span><span class="token punctuation">,</span> <span class="token number">2L</span><span class="token punctuation">,</span> <span class="token number">3L</span><span class="token punctuation">,</span> <span class="token number">4L</span><span class="token punctuation">,</span> <span class="token number">5L</span><span class="token punctuation">,</span> <span class="token number">6L</span><span class="token punctuation">,</span> <span class="token number">7L</span><span class="token punctuation">,</span>
 <span class="token number">8L</span><span class="token punctuation">,</span> <span class="token number">10L</span><span class="token punctuation">,</span> <span class="token number">11L</span><span class="token punctuation">,</span> <span class="token number">12L</span><span class="token punctuation">,</span> <span class="token number">13L</span><span class="token punctuation">,</span> <span class="token number">14L</span><span class="token punctuation">,</span> <span class="token number">15L</span><span class="token punctuation">,</span> <span class="token number">16L</span><span class="token punctuation">,</span> <span class="token number">17L</span><span class="token punctuation">,</span> <span class="token number">18L</span><span class="token punctuation">,</span> <span class="token number">19L</span><span class="token punctuation">,</span> <span class="token number">20L</span><span class="token punctuation">,</span> <span class="token number">21L</span><span class="token punctuation">,</span>
 <span class="token number">22L</span><span class="token punctuation">,</span> <span class="token number">23L</span><span class="token punctuation">,</span> <span class="token number">24L</span><span class="token punctuation">,</span> <span class="token number">25L</span><span class="token punctuation">,</span> <span class="token number">26L</span><span class="token punctuation">,</span> <span class="token number">27L</span><span class="token punctuation">,</span> <span class="token number">28L</span><span class="token punctuation">,</span> <span class="token number">29L</span><span class="token punctuation">,</span> <span class="token number">30L</span><span class="token punctuation">,</span> <span class="token number">31L</span><span class="token punctuation">,</span> <span class="token number">32L</span><span class="token punctuation">,</span> <span class="token number">33L</span><span class="token punctuation">,</span> <span class="token number">34L</span><span class="token punctuation">,</span>
 <span class="token number">35L</span><span class="token punctuation">,</span> <span class="token number">36L</span><span class="token punctuation">,</span> <span class="token number">37L</span><span class="token punctuation">,</span> <span class="token number">38L</span><span class="token punctuation">,</span> <span class="token number">39L</span><span class="token punctuation">,</span> <span class="token number">41L</span><span class="token punctuation">,</span> <span class="token number">42L</span><span class="token punctuation">,</span> <span class="token number">43L</span><span class="token punctuation">,</span> <span class="token number">44L</span><span class="token punctuation">,</span> <span class="token number">45L</span><span class="token punctuation">,</span> <span class="token number">46L</span><span class="token punctuation">,</span> <span class="token number">47L</span><span class="token punctuation">,</span> <span class="token number">48L</span><span class="token punctuation">,</span>
 <span class="token number">49L</span><span class="token punctuation">,</span> <span class="token number">50L</span><span class="token punctuation">,</span> <span class="token number">51L</span><span class="token punctuation">,</span> <span class="token number">52L</span><span class="token punctuation">)</span><span class="token punctuation">,</span> .Label <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token string">"Alabama"</span><span class="token punctuation">,</span> <span class="token string">"Alaska"</span><span class="token punctuation">,</span> <span class="token string">"Arizona"</span><span class="token punctuation">,</span>
 <span class="token string">"Arkansas"</span><span class="token punctuation">,</span> <span class="token string">"California"</span><span class="token punctuation">,</span> <span class="token string">"Colorado"</span><span class="token punctuation">,</span> <span class="token string">"Connecticut"</span><span class="token punctuation">,</span> <span class="token string">"Delaware"</span><span class="token punctuation">,</span>
 <span class="token string">"District of Columbia"</span><span class="token punctuation">,</span> <span class="token string">"Florida"</span><span class="token punctuation">,</span> <span class="token string">"Georgia"</span><span class="token punctuation">,</span> <span class="token string">"Hawaii"</span><span class="token punctuation">,</span> <span class="token string">"Idaho"</span><span class="token punctuation">,</span>
 <span class="token string">"Illinois"</span><span class="token punctuation">,</span> <span class="token string">"Indiana"</span><span class="token punctuation">,</span> <span class="token string">"Iowa"</span><span class="token punctuation">,</span> <span class="token string">"Kansas"</span><span class="token punctuation">,</span> <span class="token string">"Kentucky"</span><span class="token punctuation">,</span> <span class="token string">"Louisiana"</span><span class="token punctuation">,</span>
 <span class="token string">"Maine"</span><span class="token punctuation">,</span> <span class="token string">"Maryland"</span><span class="token punctuation">,</span> <span class="token string">"Massachusetts"</span><span class="token punctuation">,</span> <span class="token string">"Michigan"</span><span class="token punctuation">,</span> <span class="token string">"Minnesota"</span><span class="token punctuation">,</span>
 <span class="token string">"Mississippi"</span><span class="token punctuation">,</span> <span class="token string">"Missouri"</span><span class="token punctuation">,</span> <span class="token string">"Montana"</span><span class="token punctuation">,</span> <span class="token string">"Nebraska"</span><span class="token punctuation">,</span> <span class="token string">"Nevada"</span><span class="token punctuation">,</span> <span class="token string">"New Hampshire"</span><span class="token punctuation">,</span>
 <span class="token string">"New Jersey"</span><span class="token punctuation">,</span> <span class="token string">"New Mexico"</span><span class="token punctuation">,</span> <span class="token string">"New York"</span><span class="token punctuation">,</span> <span class="token string">"North Carolina"</span><span class="token punctuation">,</span> <span class="token string">"North Dakota"</span><span class="token punctuation">,</span>
 <span class="token string">"Ohio"</span><span class="token punctuation">,</span> <span class="token string">"Oklahoma"</span><span class="token punctuation">,</span> <span class="token string">"Oregon"</span><span class="token punctuation">,</span> <span class="token string">"Pennsylvania"</span><span class="token punctuation">,</span> <span class="token string">"Puerto Rico"</span><span class="token punctuation">,</span>
 <span class="token string">"Rhode Island"</span><span class="token punctuation">,</span> <span class="token string">"South Carolina"</span><span class="token punctuation">,</span> <span class="token string">"South Dakota"</span><span class="token punctuation">,</span> <span class="token string">"Tennessee"</span><span class="token punctuation">,</span>
 <span class="token string">"Texas"</span><span class="token punctuation">,</span> <span class="token string">"Utah"</span><span class="token punctuation">,</span> <span class="token string">"Vermont"</span><span class="token punctuation">,</span> <span class="token string">"Virginia"</span><span class="token punctuation">,</span> <span class="token string">"Washington"</span><span class="token punctuation">,</span> <span class="token string">"West Virginia"</span><span class="token punctuation">,</span>
 <span class="token string">"Wisconsin"</span><span class="token punctuation">,</span> <span class="token string">"Wyoming"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> class <span class="token operator">=</span> <span class="token string">"factor"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> pcthisp <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token number">0.0381527239296627</span><span class="token punctuation">,</span>
 <span class="token number">0.056769492321473</span><span class="token punctuation">,</span> <span class="token number">0.296826116572835</span><span class="token punctuation">,</span> <span class="token number">0.0635169313105461</span><span class="token punctuation">,</span> <span class="token number">0.375728960493789</span><span class="token punctuation">,</span>
 <span class="token number">0.206327251656949</span><span class="token punctuation">,</span> <span class="token number">0.134422275491411</span><span class="token punctuation">,</span> <span class="token number">0.0813548250199138</span><span class="token punctuation">,</span> <span class="token number">0.2249082771481</span><span class="token punctuation">,</span>
 <span class="token number">0.0878682317249484</span><span class="token punctuation">,</span> <span class="token number">0.0901734019211436</span><span class="token punctuation">,</span> <span class="token number">0.111947738331921</span><span class="token punctuation">,</span> <span class="token number">0.158094676641822</span><span class="token punctuation">,</span>
 <span class="token number">0.0599941716405598</span><span class="token punctuation">,</span> <span class="token number">0.0495552961203499</span><span class="token punctuation">,</span> <span class="token number">0.104741084665558</span><span class="token punctuation">,</span> <span class="token number">0.0301921562004411</span><span class="token punctuation">,</span>
 <span class="token number">0.0425162900517816</span><span class="token punctuation">,</span> <span class="token number">0.0129720920573869</span><span class="token punctuation">,</span> <span class="token number">0.0816325860392955</span><span class="token punctuation">,</span> <span class="token number">0.0960897601513277</span><span class="token punctuation">,</span>
 <span class="token number">0.0442948677533508</span><span class="token punctuation">,</span> <span class="token number">0.0470583828855611</span><span class="token punctuation">,</span> <span class="token number">0.0264973278249911</span><span class="token punctuation">,</span> <span class="token number">0.0354626134972627</span><span class="token punctuation">,</span>
 <span class="token number">0.0292535716628734</span><span class="token punctuation">,</span> <span class="token number">0.0914761950105784</span><span class="token punctuation">,</span> <span class="token number">0.265451497002445</span><span class="token punctuation">,</span> <span class="token number">0.0283535007142456</span><span class="token punctuation">,</span>
 <span class="token number">0.177132117215957</span><span class="token punctuation">,</span> <span class="token number">0.463472498001496</span><span class="token punctuation">,</span> <span class="token number">0.176607017430808</span><span class="token punctuation">,</span> <span class="token number">0.0834317084560556</span><span class="token punctuation">,</span>
 <span class="token number">0.0209906647364226</span><span class="token punctuation">,</span> <span class="token number">0.0307719359181436</span><span class="token punctuation">,</span> <span class="token number">0.0883052970054721</span><span class="token punctuation">,</span> <span class="token number">0.117261303415395</span><span class="token punctuation">,</span>
 <span class="token number">0.0568442805511265</span><span class="token punctuation">,</span> <span class="token number">0.124769233546578</span><span class="token punctuation">,</span> <span class="token number">0.0503041778042313</span><span class="token punctuation">,</span> <span class="token number">0.0279186292931113</span><span class="token punctuation">,</span>
 <span class="token number">0.0454229079840698</span><span class="token punctuation">,</span> <span class="token number">0.376044616311455</span><span class="token punctuation">,</span> <span class="token number">0.129379195461843</span><span class="token punctuation">,</span> <span class="token number">0.0151111594281676</span><span class="token punctuation">,</span>
 <span class="token number">0.0788112971314249</span><span class="token punctuation">,</span> <span class="token number">0.111945098129999</span><span class="token punctuation">,</span> <span class="token number">0.0119028512046327</span><span class="token punctuation">,</span> <span class="token number">0.0589405823830593</span><span class="token punctuation">,</span>
 <span class="token number">0.0893971780534219</span><span class="token punctuation">)</span><span class="token punctuation">,</span> pop <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token number">3615</span><span class="token punctuation">,</span> <span class="token number">365</span><span class="token punctuation">,</span> <span class="token number">2212</span><span class="token punctuation">,</span> <span class="token number">2110</span><span class="token punctuation">,</span> <span class="token number">21198</span><span class="token punctuation">,</span> <span class="token number">2541</span><span class="token punctuation">,</span>
 <span class="token number">3100</span><span class="token punctuation">,</span> <span class="token number">579</span><span class="token punctuation">,</span> <span class="token number">8277</span><span class="token punctuation">,</span> <span class="token number">4931</span><span class="token punctuation">,</span> <span class="token number">868</span><span class="token punctuation">,</span> <span class="token number">813</span><span class="token punctuation">,</span> <span class="token number">11197</span><span class="token punctuation">,</span> <span class="token number">5313</span><span class="token punctuation">,</span> <span class="token number">2861</span><span class="token punctuation">,</span> <span class="token number">2280</span><span class="token punctuation">,</span> <span class="token number">3387</span><span class="token punctuation">,</span>
 <span class="token number">3806</span><span class="token punctuation">,</span> <span class="token number">1058</span><span class="token punctuation">,</span> <span class="token number">4122</span><span class="token punctuation">,</span> <span class="token number">5814</span><span class="token punctuation">,</span> <span class="token number">9111</span><span class="token punctuation">,</span> <span class="token number">3921</span><span class="token punctuation">,</span> <span class="token number">2341</span><span class="token punctuation">,</span> <span class="token number">4767</span><span class="token punctuation">,</span> <span class="token number">746</span><span class="token punctuation">,</span> <span class="token number">1544</span><span class="token punctuation">,</span> <span class="token number">590</span><span class="token punctuation">,</span>
 <span class="token number">812</span><span class="token punctuation">,</span> <span class="token number">7333</span><span class="token punctuation">,</span> <span class="token number">1144</span><span class="token punctuation">,</span> <span class="token number">18076</span><span class="token punctuation">,</span> <span class="token number">5441</span><span class="token punctuation">,</span> <span class="token number">637</span><span class="token punctuation">,</span> <span class="token number">10735</span><span class="token punctuation">,</span> <span class="token number">2715</span><span class="token punctuation">,</span> <span class="token number">2284</span><span class="token punctuation">,</span> <span class="token number">11860</span><span class="token punctuation">,</span>
 <span class="token number">931</span><span class="token punctuation">,</span> <span class="token number">2816</span><span class="token punctuation">,</span> <span class="token number">681</span><span class="token punctuation">,</span> <span class="token number">4173</span><span class="token punctuation">,</span> <span class="token number">12237</span><span class="token punctuation">,</span> <span class="token number">1203</span><span class="token punctuation">,</span> <span class="token number">472</span><span class="token punctuation">,</span> <span class="token number">4981</span><span class="token punctuation">,</span> <span class="token number">3559</span><span class="token punctuation">,</span> <span class="token number">1799</span><span class="token punctuation">,</span> <span class="token number">4589</span><span class="token punctuation">,</span>
 <span class="token number">376</span><span class="token punctuation">)</span><span class="token punctuation">,</span> murder <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token number">15.1</span><span class="token punctuation">,</span> <span class="token number">11.3</span><span class="token punctuation">,</span> <span class="token number">7.8</span><span class="token punctuation">,</span> <span class="token number">10.1</span><span class="token punctuation">,</span> <span class="token number">10.3</span><span class="token punctuation">,</span> <span class="token number">6.8</span><span class="token punctuation">,</span> <span class="token number">3.1</span><span class="token punctuation">,</span> <span class="token number">6.2</span><span class="token punctuation">,</span>
 <span class="token number">10.7</span><span class="token punctuation">,</span> <span class="token number">13.9</span><span class="token punctuation">,</span> <span class="token number">6.2</span><span class="token punctuation">,</span> <span class="token number">5.3</span><span class="token punctuation">,</span> <span class="token number">10.3</span><span class="token punctuation">,</span> <span class="token number">7.1</span><span class="token punctuation">,</span> <span class="token number">2.3</span><span class="token punctuation">,</span> <span class="token number">4.5</span><span class="token punctuation">,</span> <span class="token number">10.6</span><span class="token punctuation">,</span> <span class="token number">13.2</span><span class="token punctuation">,</span> <span class="token number">2.7</span><span class="token punctuation">,</span> <span class="token number">8.5</span><span class="token punctuation">,</span>
 <span class="token number">3.3</span><span class="token punctuation">,</span> <span class="token number">11.1</span><span class="token punctuation">,</span> <span class="token number">2.3</span><span class="token punctuation">,</span> <span class="token number">12.5</span><span class="token punctuation">,</span> <span class="token number">9.3</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">2.9</span><span class="token punctuation">,</span> <span class="token number">11.5</span><span class="token punctuation">,</span> <span class="token number">3.3</span><span class="token punctuation">,</span> <span class="token number">5.2</span><span class="token punctuation">,</span> <span class="token number">9.7</span><span class="token punctuation">,</span> <span class="token number">10.9</span><span class="token punctuation">,</span>
 <span class="token number">11.1</span><span class="token punctuation">,</span> <span class="token number">1.4</span><span class="token punctuation">,</span> <span class="token number">7.4</span><span class="token punctuation">,</span> <span class="token number">6.4</span><span class="token punctuation">,</span> <span class="token number">4.2</span><span class="token punctuation">,</span> <span class="token number">6.1</span><span class="token punctuation">,</span> <span class="token number">2.4</span><span class="token punctuation">,</span> <span class="token number">11.6</span><span class="token punctuation">,</span> <span class="token number">1.7</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">12.2</span><span class="token punctuation">,</span> <span class="token number">4.5</span><span class="token punctuation">,</span>
 <span class="token number">5.5</span><span class="token punctuation">,</span> <span class="token number">9.5</span><span class="token punctuation">,</span> <span class="token number">4.3</span><span class="token punctuation">,</span> <span class="token number">6.7</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">6.9</span><span class="token punctuation">)</span><span class="token punctuation">,</span> area <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token number">50708</span><span class="token punctuation">,</span> <span class="token number">566432</span><span class="token punctuation">,</span> <span class="token number">113417</span><span class="token punctuation">,</span>
 <span class="token number">51945</span><span class="token punctuation">,</span> <span class="token number">156361</span><span class="token punctuation">,</span> <span class="token number">103766</span><span class="token punctuation">,</span> <span class="token number">4862</span><span class="token punctuation">,</span> <span class="token number">1982</span><span class="token punctuation">,</span> <span class="token number">54090</span><span class="token punctuation">,</span> <span class="token number">58073</span><span class="token punctuation">,</span> <span class="token number">6425</span><span class="token punctuation">,</span> <span class="token number">82677</span><span class="token punctuation">,</span>
 <span class="token number">55748</span><span class="token punctuation">,</span> <span class="token number">36097</span><span class="token punctuation">,</span> <span class="token number">55941</span><span class="token punctuation">,</span> <span class="token number">81787</span><span class="token punctuation">,</span> <span class="token number">39650</span><span class="token punctuation">,</span> <span class="token number">44930</span><span class="token punctuation">,</span> <span class="token number">30920</span><span class="token punctuation">,</span> <span class="token number">9891</span><span class="token punctuation">,</span> <span class="token number">7826</span><span class="token punctuation">,</span>
 <span class="token number">56817</span><span class="token punctuation">,</span> <span class="token number">79289</span><span class="token punctuation">,</span> <span class="token number">47296</span><span class="token punctuation">,</span> <span class="token number">68995</span><span class="token punctuation">,</span> <span class="token number">145587</span><span class="token punctuation">,</span> <span class="token number">76483</span><span class="token punctuation">,</span> <span class="token number">109889</span><span class="token punctuation">,</span> <span class="token number">9027</span><span class="token punctuation">,</span> <span class="token number">7521</span><span class="token punctuation">,</span>
 <span class="token number">121412</span><span class="token punctuation">,</span> <span class="token number">47831</span><span class="token punctuation">,</span> <span class="token number">48798</span><span class="token punctuation">,</span> <span class="token number">69273</span><span class="token punctuation">,</span> <span class="token number">40975</span><span class="token punctuation">,</span> <span class="token number">68782</span><span class="token punctuation">,</span> <span class="token number">96184</span><span class="token punctuation">,</span> <span class="token number">44966</span><span class="token punctuation">,</span> <span class="token number">1049</span><span class="token punctuation">,</span>
 <span class="token number">30225</span><span class="token punctuation">,</span> <span class="token number">75955</span><span class="token punctuation">,</span> <span class="token number">41328</span><span class="token punctuation">,</span> <span class="token number">262134</span><span class="token punctuation">,</span> <span class="token number">82096</span><span class="token punctuation">,</span> <span class="token number">9267</span><span class="token punctuation">,</span> <span class="token number">39780</span><span class="token punctuation">,</span> <span class="token number">66570</span><span class="token punctuation">,</span> <span class="token number">24070</span><span class="token punctuation">,</span>
 <span class="token number">54464</span><span class="token punctuation">,</span> <span class="token number">97203</span><span class="token punctuation">)</span><span class="token punctuation">,</span> temp <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token number">62.8</span><span class="token punctuation">,</span> <span class="token number">26.6</span><span class="token punctuation">,</span> <span class="token number">60.3</span><span class="token punctuation">,</span> <span class="token number">60.4</span><span class="token punctuation">,</span> <span class="token number">59.4</span><span class="token punctuation">,</span> <span class="token number">45.1</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">,</span>
 <span class="token number">55.3</span><span class="token punctuation">,</span> <span class="token number">70.7</span><span class="token punctuation">,</span> <span class="token number">63.5</span><span class="token punctuation">,</span> <span class="token number">70</span><span class="token punctuation">,</span> <span class="token number">44.4</span><span class="token punctuation">,</span> <span class="token number">51.8</span><span class="token punctuation">,</span> <span class="token number">51.7</span><span class="token punctuation">,</span> <span class="token number">47.8</span><span class="token punctuation">,</span> <span class="token number">54.3</span><span class="token punctuation">,</span> <span class="token number">55.6</span><span class="token punctuation">,</span> <span class="token number">66.4</span><span class="token punctuation">,</span>
 <span class="token number">41</span><span class="token punctuation">,</span> <span class="token number">54.2</span><span class="token punctuation">,</span> <span class="token number">47.9</span><span class="token punctuation">,</span> <span class="token number">44.4</span><span class="token punctuation">,</span> <span class="token number">41.2</span><span class="token punctuation">,</span> <span class="token number">63.4</span><span class="token punctuation">,</span> <span class="token number">54.5</span><span class="token punctuation">,</span> <span class="token number">42.7</span><span class="token punctuation">,</span> <span class="token number">48.8</span><span class="token punctuation">,</span> <span class="token number">49.9</span><span class="token punctuation">,</span> <span class="token number">43.8</span><span class="token punctuation">,</span>
 <span class="token number">52.7</span><span class="token punctuation">,</span> <span class="token number">53.4</span><span class="token punctuation">,</span> <span class="token number">45.4</span><span class="token punctuation">,</span> <span class="token number">59</span><span class="token punctuation">,</span> <span class="token number">40.4</span><span class="token punctuation">,</span> <span class="token number">50.7</span><span class="token punctuation">,</span> <span class="token number">59.6</span><span class="token punctuation">,</span> <span class="token number">48.4</span><span class="token punctuation">,</span> <span class="token number">48.8</span><span class="token punctuation">,</span> <span class="token number">50.1</span><span class="token punctuation">,</span> <span class="token number">62.4</span><span class="token punctuation">,</span>
 <span class="token number">45.2</span><span class="token punctuation">,</span> <span class="token number">57.6</span><span class="token punctuation">,</span> <span class="token number">64.8</span><span class="token punctuation">,</span> <span class="token number">48.6</span><span class="token punctuation">,</span> <span class="token number">42.9</span><span class="token punctuation">,</span> <span class="token number">55.1</span><span class="token punctuation">,</span> <span class="token number">48.3</span><span class="token punctuation">,</span> <span class="token number">51.8</span><span class="token punctuation">,</span> <span class="token number">43.1</span><span class="token punctuation">,</span> <span class="token number">42</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> .Names <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token string">"state"</span><span class="token punctuation">,</span>
 <span class="token string">"pcthisp"</span><span class="token punctuation">,</span> <span class="token string">"pop"</span><span class="token punctuation">,</span> <span class="token string">"murder"</span><span class="token punctuation">,</span> <span class="token string">"area"</span><span class="token punctuation">,</span> <span class="token string">"temp"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> class <span class="token operator">=</span> <span class="token string">"data.frame"</span><span class="token punctuation">,</span> row.names <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token keyword">NA</span><span class="token punctuation">,</span>
 <span class="token operator">-</span><span class="token number">50L</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

  RR<span class="token punctuation">(</span>bg<span class="token operator">$</span>area<span class="token punctuation">,</span> bg<span class="token operator">$</span>pcthisp<span class="token punctuation">,</span> bg<span class="token operator">$</span>pop<span class="token punctuation">)</span>
 <span class="token comment"># Avg Hispanic lives in a State that is 69 percent larger than</span>
 <span class="token comment">#   that of avg. non-Hispanic</span>

RR<span class="token punctuation">(</span>bg<span class="token operator">$</span>pcthisp<span class="token punctuation">,</span> bg<span class="token operator">$</span>pcthisp<span class="token punctuation">,</span> bg<span class="token operator">$</span>pop<span class="token punctuation">)</span>
   Avg Hispanic persons local percent Hispanic <span class="token punctuation">(</span>their blockgroup<span class="token punctuation">)</span> is <span class="token number">4</span>x as everyone elses on avg<span class="token punctuation">,</span>
  but avg low income persons local percent low income is only <span class="token number">1.8</span>x as high as everyone elses.
 <span class="token comment"># cbind(RR=RR(e=data.frame(local_pct_hispanic=bg$pcthisp, local_pct_lowincome=bg$pctlowinc),</span>
 <span class="token comment"># d= cbind(Ratio_of_avg_among_hispanics_to_avg_among_nonhispanics=bg$pcthisp, avg_among_lowinc_vs_rest_of_pop=bg$pctlowinc), bg$pop))</span>

<span class="token comment"># RR(bg[ , names.e], bg$pctlowinc, bg$pop)</span>
 <span class="token comment"># sapply(bg[ , names.d], function(z) RR(bg[ , names.e], z, bg$pop) )</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="RR.cut.if.gone">

<a href="#RR.cut.if.gone" class="help-page-title"><h2>How much is overal RR reduced if a given place did not exist?</h2></a>

<h3>Description</h3>

<p>As with RR function, calculates RR as ratio of means in one demographic group vs reference,
based on Census demographic data and environmental indicator data on each place.
Then this finds how much smaller RR would be if the given place did not exist.
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">RR.cut.<span class="token keyword">if</span>.gone<span class="token punctuation">(</span>e<span class="token punctuation">,</span> d<span class="token punctuation">,</span> pop<span class="token punctuation">,</span> dref<span class="token punctuation">,</span> na.rm <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>e</code></td>
<td>
<p>environmental indicator value</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>d</code></td>
<td>
<p>demog group as fraction of pop</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pop</code></td>
<td>
<p>pop count</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dref</code></td>
<td>
<p>reference demog group as fraction</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>na.rm</code></td>
<td>
<p>TRUE by default, should NA values be removed first</p>
</td>
</tr>
</table>
<h3>Examples</h3>

<pre class="language-r"><code class="language-r"><span class="token comment"># x=RR.cut.if.gone(bg[ , names.e[8]], bg$pctlowinc, bg$pop)</span>
 <span class="token comment"># summary(x*1000)</span>
 mydat<span class="token operator">=</span>data.frame<span class="token punctuation">(</span>AQI<span class="token operator">=</span><span class="token number">99</span><span class="token operator">:</span><span class="token number">101</span><span class="token punctuation">,</span> pctlowinc<span class="token operator">=</span>c<span class="token punctuation">(</span><span class="token number">0.20</span><span class="token punctuation">,</span><span class="token number">0.30</span><span class="token punctuation">,</span><span class="token number">0.40</span><span class="token punctuation">)</span><span class="token punctuation">,</span> pop<span class="token operator">=</span>rep<span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
 RR<span class="token punctuation">(</span>mydat<span class="token operator">$</span>AQI<span class="token punctuation">,</span> mydat<span class="token operator">$</span>pctlowinc<span class="token punctuation">,</span> mydat<span class="token operator">$</span>pop<span class="token punctuation">)</span>
 RR.cut.<span class="token keyword">if</span>.gone<span class="token punctuation">(</span>e<span class="token operator">=</span>mydat<span class="token operator">$</span>AQI<span class="token punctuation">,</span> d<span class="token operator">=</span>mydat<span class="token operator">$</span>pctlowinc<span class="token punctuation">,</span> pop<span class="token operator">=</span>mydat<span class="token operator">$</span>pop<span class="token punctuation">)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="RR.if.address.top.x">

<a href="#RR.if.address.top.x" class="help-page-title"><h2>Analyze how much RR would change if top-ranked places were addressed - ** NOT WORKING/ IN PROGRESS</h2></a>

<h3>Description</h3>

<p>Function to analyze data on demographic and environmental (e) indicators by place (e.g., Census block group)
to get stats on what percent of population or places could account for
all risk ratio (RR, or ratio of mean e in one demog group vs others), and what is risk ratio if you reduce e (environmental indicator)
by using some multiplier on e, in top x percent of places
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">RR.<span class="token keyword">if</span>.address.top.x<span class="token punctuation">(</span>
  rank.by.df<span class="token punctuation">,</span>
  e.df<span class="token punctuation">,</span>
  d.pct<span class="token punctuation">,</span>
  popcounts<span class="token punctuation">,</span>
  d.pct.us<span class="token punctuation">,</span>
  or.tied <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">,</span>
  <span class="token keyword">if</span>.multiply.e.by <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>
  zones <span class="token operator">=</span> <span class="token keyword">NULL</span><span class="token punctuation">,</span>
  mycuts <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">90</span><span class="token operator">:</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  silent <span class="token operator">=</span> <span class="token boolean">TRUE</span>
<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>rank.by.df</code></td>
<td>
<p>Data.frame of indicators to rank places by, when defining top places</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>e.df</code></td>
<td>
<p>Environmental indicators data.frame, one row per place, required.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>d.pct</code></td>
<td>
<p>Demographic percentage, as fraction, defining what fraction of population in each place (row) is in demographic group of interest. Required.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>popcounts</code></td>
<td>
<p>Numeric vector of counts of total population in each place</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>d.pct.us</code></td>
<td>
<p>xxxxx</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>or.tied</code></td>
<td>
<p>Logical value, optional, TRUE by default, in which case ties of ranking variable with a cutoff value (value &gt;= cutoff) are included in places within that bin.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>if.multiply.e.by</code></td>
<td>
<p>Optional, 0 by default. Specifies the number that environmental indicator values would be multiplied by
in the scenario where some places are addressed. Zero means those top-ranked places would have the environmental indicator set to zero,
while 0.9 would mean and 10 percent cut in the environmental indicator value.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>zones</code></td>
<td>
<p>Subsets of places such as States</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mycuts</code></td>
<td>
<p>optional vector of cutoff values to analyze. Default is c(50,80,90:100)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>silent</code></td>
<td>
<p>optional logical, default is TRUE, while FALSE means more information is printed</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The effects of one place on overall RR is related to an ej.index, which here is a metric describing one place's contribution to an overall metric of disparity.
RR is one overall metric of disparity, the ratio of mean environmental indicator value in one demographic group over the mean in the reference group.
If RR = E/e, where E=avg environmental indicator or risk in key demographic group and e= in reference group,
another metric of disparity is the excess individual risk, or E-e.
The excess population risk or excess cases would be (E-e) * p * d where p=total population and d=fraction that is in key demographic group.
Various counterfactuals could be used here for
scenario defining what it means to address the top places and
what is used to define top places.
</p>


<h3>Value</h3>

<p>Returns a list of results:
</p>

<ol>
<li>
<p> rrs data.frame, one column per environmental indicator, one row per cutoff value
</p>
</li>
<li>
<p> rrs2 data.frame, Relative risks 2
</p>
</li>
<li>
<p> state.tables A list
</p>
</li>
<li>
<p> worst.as.pct Worst as percent, vector as long as number of environmental indicators
</p>
</li>
<li>
<p> worst.as.pct.of.bgs Worst as percent of places (e.g., block groups)
</p>
</li>
</ol>
<h3>See Also</h3>

<p><code><a href="#RR">RR()</a></code> and <code><a href="#RR.if.address.top.x">RR.if.address.top.x()</a></code> and <code><a href="#ej.indexes">ej.indexes()</a></code> and <code><a href="#ej.added">ej.added()</a></code>
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r"><span class="token comment">## #</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="RR.means">

<a href="#RR.means" class="help-page-title"><h2>Relative Risk (RR) components - Means in demographic group and in rest of pop, based on Census data</h2></a>

<h3>Description</h3>

<p>Finds the mean indicator value in one demographic subgroup and mean in everyone else,
based on data for each spatial unit such as for block groups or tracts.
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">RR.means<span class="token punctuation">(</span>
  e<span class="token punctuation">,</span>
  d<span class="token punctuation">,</span>
  pop<span class="token punctuation">,</span>
  dref<span class="token punctuation">,</span>
  dlab <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token string">"group"</span><span class="token punctuation">,</span> <span class="token string">"not"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  formulatype <span class="token operator">=</span> <span class="token string">"manual"</span><span class="token punctuation">,</span>
  na.rm <span class="token operator">=</span> <span class="token boolean">TRUE</span>
<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>e</code></td>
<td>
<p>Vector or data.frame or matrix with 1 or more environmental indicator(s) or health risk level (e.g., PM2.5 concentration to which this person or place is exposed),
one row per Census unit and one column per indicator.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>d</code></td>
<td>
<p>Vector or data.frame or matrix with 1 or more demog groups percentage (as fraction of 1, not 0-100!) of place that is selected demog group (e.g. percent Hispanic) (or d=1 or 0 if this is a vector of individuals)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pop</code></td>
<td>
<p>Vector of one row per location providing population count of place (or pop=1 if this is a vector of individuals), to convert d into a count since d is a fraction</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dref</code></td>
<td>
<p>optional specifies reference group, default is 1 - d, meaning all people who are not in given group,
so each D group is compared to all non-D people. This is why dlab has the default it does.
But dref can be used to specify a single reference group used for all D analyzed.
For the reference group to be the entire overall population, use dref = 1, and say dlab = c('avg in group', 'avg overall') for example.
To use some other reference group, just set dref = a fraction of 1 that is the share of local pop that is in the reference group,
as a vector as long as the number of places (number of rows in e or d).
e.g., for non-Hispanic White alone to be the reference group,
if the bg data.frame has a field called pctnhwa, specify dref = bg$pctnhwa,
and specify dlab = c('mean in this group', 'mean in reference group') for example.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dlab</code></td>
<td>
<p>optional character vector of two names for columns of output, default is c('group', 'not'), where the second refers to the reference group used.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>formulatype</code></td>
<td>
<p>Optional, default is 'manual', which is like sum(x * wts) / sum(wts) with na.rm=T,
or formulatype can be 'Hmisc' to use <code><a href="https://harrelfe.r-universe.dev/manual/Hmisc.html#wtd.stats">Hmisc::wtd.mean()</a></code> (Hmisc::wtd.mean), or 'base' to use <code><a href="https://r-universe.dev/manuals/stats.html#weighted.mean">weighted.mean()</a></code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>na.rm</code></td>
<td>
<p>optional, default is TRUE. No effect if formulatype = manual (default). Not really the right results when na.rm = FALSE anyway.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>This function requires, for each Census unit, demographic data on total population and percent in each demographic group,
and some indicator(s) for each Census unit, such as health status, exposure estimates, or environmental health risk.
For example, given population count, percent Hispanic, and ppm of ozone for each tract, this calculates the
population mean tract-level ozone concentration among Hispanics and the same value among all non-Hispanics.
The result is a table of means for a demographic subset, or for each of several groups and indicators.
Each e (for environmental indicator) or d (for demographic percentage) is specified as a vector over small places like Census blocks or block groups
or even individuals (ideally) but then d would be a dummy=1 for selected group and 0 for people not in selected group
NOTE: could NA values cause a problem here?
</p>


<h3>Value</h3>

<p>numeric results as array
</p>


<h3>See Also</h3>


<ul>
<li> <p><code><a href="#ej.indexes">ej.indexes</a></code> for local contribution to a variety of overall disparity metrics such as excess risk
</p>
</li>
<li> <p><code><a href="#RR">RR</a></code> to calculate overall disparity metric as relative risk (RR), ratio of mean environmental indicator values across demographic groups
</p>
</li>
<li> <p><code><a href="#RR.table">RR.table</a></code> to create 3-D table of RR values, by demographic group by environmental indicator by zone
</p>
</li>
<li> <p><code><a href="#RR.table.sort">RR.table.sort</a></code> to sort existing RR table
</p>
</li>
<li> <p><code><a href="#RR.table.add">RR.table.add</a></code> to add zone(s) to existing RR table
</p>
</li>
<li> <p><code><a href="#write.RR.tables">write.RR.tables</a></code> to write a file with a table or RR by indicator by group
</p>
</li>
<li> <p><code><a href="#ej.added">ej.added</a></code> to find EJ Index as local contribution to sum of EJ Indexes
</p>
</li>
<li> <p><code><a href="#RR.cut.if.gone">RR.cut.if.gone</a></code> to find local contribution to RR
</p>
</li>
<li> <p><code><a href="#RR.if.address.top.x">RR.if.address.top.x</a></code> to find how much RR would change if top-ranked places had different conditions
</p>
</li>
<li> <p><code><a href="#rrfv">rrfv</a></code> for obsolete attempt to vectorize rrf
</p>
</li>
<li> <p><code><a href="#rrf">rrf</a></code> for older simpler function for RR of one indicator for one demographic group
</p>
</li>
<li> <p><code><a href="#pop.ecdf">pop.ecdf</a></code> to compare plots of cumulative frequency distribution of indicator values by group
</p>
</li>
</ul>
<h3>Examples</h3>

<pre class="language-r"><code class="language-r">bg<span class="token operator">=</span>ejanalysis<span class="token operator">::</span>bgtest
 drop<span class="token punctuation">(</span>RR.means<span class="token punctuation">(</span>bg<span class="token punctuation">[</span> <span class="token punctuation">,</span> namese<span class="token punctuation">]</span><span class="token punctuation">,</span> bg<span class="token operator">$</span>pcthisp<span class="token punctuation">,</span> bg<span class="token operator">$</span>pop<span class="token punctuation">)</span><span class="token punctuation">)</span>
 x<span class="token operator">=</span>RR.means<span class="token punctuation">(</span>bg<span class="token punctuation">[</span><span class="token punctuation">,</span>namese<span class="token punctuation">]</span><span class="token punctuation">,</span> bg<span class="token punctuation">[</span><span class="token punctuation">,</span>namesd<span class="token punctuation">]</span><span class="token punctuation">,</span> bg<span class="token operator">$</span>pop<span class="token punctuation">)</span>
 round<span class="token punctuation">(</span>x<span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token string">'ratio'</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span>
 x<span class="token punctuation">[</span> <span class="token punctuation">,</span> <span class="token punctuation">,</span><span class="token string">'traffic.score'</span><span class="token punctuation">]</span>
 x<span class="token punctuation">[</span><span class="token string">'pctlowinc'</span><span class="token punctuation">,</span><span class="token punctuation">,</span><span class="token punctuation">]</span>

 densities <span class="token operator">&lt;-</span> round<span class="token punctuation">(</span>drop<span class="token punctuation">(</span>RR.means<span class="token punctuation">(</span>e <span class="token operator">=</span> data.frame<span class="token punctuation">(</span>pop.density<span class="token operator">=</span><span class="token number">1000</span><span class="token operator">*</span>bg<span class="token operator">$</span>pop<span class="token operator">/</span>bg<span class="token operator">$</span>area<span class="token punctuation">)</span><span class="token punctuation">,</span>
  d <span class="token operator">=</span> bg<span class="token punctuation">[</span><span class="token punctuation">,</span> c<span class="token punctuation">(</span>namesd<span class="token punctuation">,</span> namesdsub<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> pop <span class="token operator">=</span> bg<span class="token operator">$</span>pop<span class="token punctuation">,</span> dlab <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token string">'Avg pop density'</span><span class="token punctuation">,</span> <span class="token string">'Avg if not in this demog group'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span>
 densities<span class="token punctuation">[</span>order<span class="token punctuation">(</span>densities<span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span>decreasing <span class="token operator">=</span> T<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span>
<span class="token comment">## Not run: </span>
 <span class="token comment"># if the blockgroup data were a data.table...</span>
 bg <span class="token operator">&lt;-</span> data.frame<span class="token punctuation">(</span>data.table<span class="token operator">::</span>copy<span class="token punctuation">(</span>EJAM<span class="token operator">::</span>blockgroupstats<span class="token punctuation">)</span><span class="token punctuation">)</span>
 x <span class="token operator">&lt;-</span> ejanalysis<span class="token operator">::</span>RR.means<span class="token punctuation">(</span>
   bg<span class="token punctuation">[</span> <span class="token punctuation">,</span>   EJAM<span class="token operator">::</span>names_e<span class="token punctuation">]</span><span class="token punctuation">,</span>
   bg<span class="token punctuation">[</span> <span class="token punctuation">,</span> c<span class="token punctuation">(</span>EJAM<span class="token operator">::</span>names_d<span class="token punctuation">,</span> EJAM<span class="token operator">::</span>names_d_subgroups<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token operator">/</span><span class="token number">100</span><span class="token punctuation">,</span>
   bg<span class="token operator">$</span>pop
 <span class="token punctuation">)</span>
 
<span class="token comment">## End(Not run)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="RR.plot">

<a href="#RR.plot" class="help-page-title"><h2>Draw lineplot comparing RR values by group</h2></a>

<h3>Description</h3>

<p>Draws a plot using relative risk information, one line per demographic group.
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">RR.plot<span class="token punctuation">(</span>
  rrs<span class="token punctuation">,</span>
  dnames<span class="token punctuation">,</span>
  enames<span class="token punctuation">,</span>
  zone <span class="token operator">=</span> <span class="token string">"USA"</span><span class="token punctuation">,</span>
  enames.nice<span class="token punctuation">,</span>
  mycolors<span class="token punctuation">,</span>
  type <span class="token operator">=</span> <span class="token string">"b"</span><span class="token punctuation">,</span>
  maxchar <span class="token operator">=</span> <span class="token number">15</span><span class="token punctuation">,</span>
  cex.axis <span class="token operator">=</span> <span class="token number">0.5</span><span class="token punctuation">,</span>
  cex.legend <span class="token operator">=</span> <span class="token number">0.8</span><span class="token punctuation">,</span>
  sorted <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">,</span>
  margins <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  decreasing <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">,</span>
  <span class="token ellipsis">...</span>
<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>rrs</code></td>
<td>
<p>Table as from <code><a href="#RR.table">RR.table()</a></code> function, of relative risk by demographic group, risk type, and zone (3 dimensions).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dnames</code></td>
<td>
<p>Demographic group names to be found as names of first dim of RRS. Optional, default is <code><a>ejscreen::names.d.subgroups()</a></code> and <code><a>ejscreen::names.d()</a></code> from the ejscreen dataset.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>enames</code></td>
<td>
<p>Environmental factor or risk type names to be found as names of second dim of RRS. Optional, default is <code><a>ejscreen::names.e()</a></code> from ejscreen package.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>zone</code></td>
<td>
<p>Zone name to be found among names for third dim of RRS. Default is "USA"</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>enames.nice</code></td>
<td>
<p>optional character vector of labels to use instead of enames on the plot, same length and order as enames</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mycolors</code></td>
<td>
<p>optional vector of colors to use for the vector of dnames, default is from <code><a href="https://r-universe.dev/manuals/grDevices.html#palettes">rainbow()</a></code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>type</code></td>
<td>
<p>optional as in <code><a href="https://r-universe.dev/manuals/graphics.html#plot.default">plot()</a></code>, default is 'b' for both lines and points</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>maxchar</code></td>
<td>
<p>optional number, default 15. x axis labels are truncated to this length.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cex.axis</code></td>
<td>
<p>optional default 0.5, size of enames lables on x axis</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cex.legend</code></td>
<td>
<p>optional default 0.8, size of dnames in legend</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sorted</code></td>
<td>
<p>optional logical, default is TRUE. Whether to sort before plotting.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>margins</code></td>
<td>
<p>optional numeric vector, default is c(1, 2, 3). Specifies which dimensions to sort if sorted is TRUE.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>decreasing</code></td>
<td>
<p>optional logical, default is TRUE. How to sort if sorted is TRUE. All sorted dimensions get sorted the same way.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>optional additional parameters to pass to <code><a href="https://r-universe.dev/manuals/graphics.html#plot.default">plot()</a></code></p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>draws a line plot
</p>


<h3>See Also</h3>

<p><code><a href="#RR.table">RR.table()</a></code>
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r"><span class="token comment">#</span>
  <span class="token comment">## #</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="RR.plotbar">

<a href="#RR.plotbar" class="help-page-title"><h2>Draw barplot comparing mean score in a group vs reference group</h2></a>

<h3>Description</h3>

<p>Draws a plot using group means from <code><a href="#RR.means">RR.means()</a></code>
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">RR.plotbar<span class="token punctuation">(</span>
  x<span class="token punctuation">,</span>
  dname<span class="token punctuation">,</span>
  ename<span class="token punctuation">,</span>
  dlab <span class="token operator">=</span> dname<span class="token punctuation">,</span>
  elab <span class="token operator">=</span> ename<span class="token punctuation">,</span>
  reflab <span class="token operator">=</span> paste<span class="token punctuation">(</span><span class="token string">"Non-"</span><span class="token punctuation">,</span> dlab<span class="token punctuation">,</span> sep <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  cex.names <span class="token operator">=</span> <span class="token number">1.9</span><span class="token punctuation">,</span>
  cex.axis <span class="token operator">=</span> <span class="token number">1.5</span><span class="token punctuation">,</span>
  <span class="token ellipsis">...</span>
<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>Results of <code><a href="#RR.means">RR.means()</a></code> function, mean indicator score or risk by demographic group</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dname</code></td>
<td>
<p>Demographic group name to be found among names of first dim of x. Required.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ename</code></td>
<td>
<p>Environmental factor or risk type name to be found as names of second dim of x. Required.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dlab</code></td>
<td>
<p>optional character vector of label to use instead of dname on the plot. Default is dname.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>elab</code></td>
<td>
<p>optional character vector of label to use instead of ename on the plot. Default is ename.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>reflab</code></td>
<td>
<p>optional character vector of lable to use for reference group. Default is Non-dlab (e.g., "Non-Poor")</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cex.names</code></td>
<td>
<p>optional numeric vector passed to <code><a href="https://r-universe.dev/manuals/graphics.html#barplot">barplot()</a></code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cex.axis</code></td>
<td>
<p>optional numeric vector passed to <code><a href="https://r-universe.dev/manuals/graphics.html#barplot">barplot()</a></code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>optional other parameters passed to <code><a href="https://r-universe.dev/manuals/graphics.html#barplot">barplot()</a></code></p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>draws a barplot, returns the two values as named list
</p>


<h3>See Also</h3>

<p><code><a href="#RR.plot">RR.plot()</a></code>
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r"><span class="token comment">## Not run: </span>
    data<span class="token punctuation">(</span>bgtest<span class="token punctuation">,</span> package <span class="token operator">=</span> <span class="token string">'ejanalysis'</span><span class="token punctuation">)</span>
    <span class="token comment">### x should be the output of RR.means()</span>
    x <span class="token operator">&lt;-</span> RR.means<span class="token punctuation">(</span>e <span class="token operator">=</span> bgtest<span class="token operator">$</span>traffic.score<span class="token punctuation">,</span> d <span class="token operator">=</span> bgtest<span class="token operator">$</span>pctmin<span class="token punctuation">,</span> pop <span class="token operator">=</span> bgtest<span class="token operator">$</span>pop<span class="token punctuation">)</span>
    RR.plotbar<span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token string">'pctlths'</span><span class="token punctuation">,</span> <span class="token string">'proximity.rmp'</span><span class="token punctuation">)</span>
    RR.plotbar<span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token string">'pctmin'</span><span class="token punctuation">,</span> <span class="token string">'proximity.tsdf'</span><span class="token punctuation">,</span> dlab <span class="token operator">=</span> <span class="token string">'Minorities'</span><span class="token punctuation">,</span> elab <span class="token operator">=</span> <span class="token string">'Haz. Waste TSD Facility Proximity Score'</span><span class="token punctuation">,</span> ylab <span class="token operator">=</span> <span class="token string">'Proximity Score'</span><span class="token punctuation">)</span>
 
<span class="token comment">## End(Not run)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="RR.table">

<a href="#RR.table" class="help-page-title"><h2>Table of Relative Risk results by zone by group by envt risk factor</h2></a>

<h3>Description</h3>

<p>Make table of Relative Risk results by zone by group by envt risk factor.
See source code for notes on this work.
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">RR.table<span class="token punctuation">(</span>
  mydat<span class="token punctuation">,</span>
  Enames <span class="token operator">=</span> ejscreen<span class="token operator">::</span>names.e<span class="token punctuation">[</span>ejscreen<span class="token operator">::</span>names.e <span class="token percent-operator operator">%in%</span> names<span class="token punctuation">(</span>mydat<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  Dnames <span class="token operator">=</span> ejscreen<span class="token operator">::</span>names.d<span class="token punctuation">[</span>ejscreen<span class="token operator">::</span>names.d <span class="token percent-operator operator">%in%</span> names<span class="token punctuation">(</span>mydat<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  popcolname <span class="token operator">=</span> <span class="token string">"pop"</span><span class="token punctuation">,</span>
  Zcolname<span class="token punctuation">,</span>
  testing <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">,</span>
  digits <span class="token operator">=</span> <span class="token number">4</span>
<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>mydat</code></td>
<td>
<p>Data.frame of input data, one row per geographic unit such as US Census block groups, or tracts.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Enames</code></td>
<td>
<p>names of columns with environmental risk factor data, default is names.e from ejscreen package</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Dnames</code></td>
<td>
<p>names of columns with percent (fraction) of population that is in each given demographic group, default is names.d from ejscreen package</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>popcolname</code></td>
<td>
<p>name of column with total population count, default is pop</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Zcolname</code></td>
<td>
<p>name of column with name of zone such as US State name</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>testing</code></td>
<td>
<p>default is FALSE</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>digits</code></td>
<td>
<p>Default is 4. How many significant digits to use.</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>Compiles RR values in array of 3 dimensions: <code>RRS[Dnames, Enames, Zcolnames]</code>
Returns a matrix with
one demographic group per row,
one environmental risk indicator per column, and
third dimension for which zone (e.g., which US State)
</p>


<h3>See Also</h3>


<ul>
<li> <p><code><a href="#ej.indexes">ej.indexes</a></code> for local contribution to a variety of overall disparity metrics such as excess risk
</p>
</li>
<li> <p><code><a href="#RR">RR</a></code> to calculate overall disparity metric as relative risk (RR), ratio of mean environmental indicator values across demographic groups
</p>
</li>
<li> <p><code><a href="#RR.table">RR.table</a></code> to create 3-D table of RR values, by demographic group by environmental indicator by zone
</p>
</li>
<li> <p><code><a href="#RR.table.sort">RR.table.sort</a></code> to sort existing RR table
</p>
</li>
<li> <p><code><a href="#RR.table.add">RR.table.add</a></code> to add zone(s) to existing RR table
</p>
</li>
<li> <p><code><a href="#write.RR.tables">write.RR.tables</a></code> to write a file with a table or RR by indicator by group
</p>
</li>
<li> <p><code><a href="#ej.added">ej.added</a></code> to find EJ Index as local contribution to sum of EJ Indexes
</p>
</li>
<li> <p><code><a href="#RR.cut.if.gone">RR.cut.if.gone</a></code> to find local contribution to RR
</p>
</li>
<li> <p><code><a href="#RR.if.address.top.x">RR.if.address.top.x</a></code> to find how much RR would change if top-ranked places had different conditions
</p>
</li>
<li> <p><code><a href="#rrfv">rrfv</a></code> for obsolete attempt to vectorize rrf
</p>
</li>
<li> <p><code><a href="#rrf">rrf</a></code> for older simpler function for RR of one indicator for one demographic group
</p>
</li>
<li> <p><code><a href="#pop.ecdf">pop.ecdf</a></code> to compare plots of cumulative frequency distribution of indicator values by group
</p>
</li>
</ul>
<h3>Examples</h3>

<pre class="language-r"><code class="language-r"><span class="token comment"># (This is very slow right now)</span>
    <span class="token comment"># Ratios &lt;- ejanalysis::RR.table(bg21plus, Enames = names.e, Dnames = c(names.d, names.d.subgroups), popcolname = 'pop', digits = 2)</span>
    <span class="token comment"># MeansByGroup_and_Ratios &lt;- ejanalysis::RR.means(subset(bg21plus, select=names.e), subset(bg21plus, select = c(names.d, names.d.subgroups)), bg21plus$pop)</span>
data<span class="token punctuation">(</span>bgtest<span class="token punctuation">,</span> package <span class="token operator">=</span> <span class="token string">'ejanalysis'</span><span class="token punctuation">)</span>
RRS.US  <span class="token operator">&lt;-</span> RR.table<span class="token punctuation">(</span>mydat <span class="token operator">=</span> bgtest<span class="token punctuation">,</span> Enames <span class="token operator">=</span> names.e<span class="token punctuation">,</span> Dnames <span class="token operator">=</span> c<span class="token punctuation">(</span>names.d<span class="token punctuation">,</span> names.d.subgroups.pct<span class="token punctuation">)</span><span class="token punctuation">,</span>
 popcolname <span class="token operator">=</span> <span class="token string">'pop'</span><span class="token punctuation">)</span>
RRS.ST  <span class="token operator">&lt;-</span> RR.table<span class="token punctuation">(</span>mydat <span class="token operator">=</span> bgtest<span class="token punctuation">,</span> Enames <span class="token operator">=</span> names.e<span class="token punctuation">,</span> Dnames <span class="token operator">=</span> c<span class="token punctuation">(</span>names.d<span class="token punctuation">,</span> names.d.subgroups.pct<span class="token punctuation">)</span><span class="token punctuation">,</span>
 popcolname <span class="token operator">=</span> <span class="token string">'pop'</span><span class="token punctuation">,</span> Zcolname <span class="token operator">=</span> <span class="token string">'ST'</span><span class="token punctuation">)</span>
RRS <span class="token operator">&lt;-</span> RR.table.add<span class="token punctuation">(</span>RRS.ST<span class="token punctuation">,</span> RRS.US<span class="token punctuation">)</span>
RRS<span class="token punctuation">[</span><span class="token string">'pctlowinc'</span><span class="token punctuation">,</span> <span class="token punctuation">,</span> <span class="token punctuation">]</span>
RRS<span class="token punctuation">[</span> <span class="token punctuation">,</span> <span class="token punctuation">,</span> <span class="token string">'CA'</span><span class="token punctuation">]</span>  <span class="token comment"># RRS[,,'PR']</span>
RRS<span class="token punctuation">[</span> <span class="token punctuation">,</span> <span class="token string">'pm'</span><span class="token punctuation">,</span> <span class="token punctuation">]</span>
RRS.REGION  <span class="token operator">&lt;-</span> RR.table<span class="token punctuation">(</span>mydat <span class="token operator">=</span> bgtest<span class="token punctuation">,</span> Enames <span class="token operator">=</span> names.e<span class="token punctuation">,</span> Dnames <span class="token operator">=</span> c<span class="token punctuation">(</span>names.d<span class="token punctuation">,</span> names.d.subgroups.pct<span class="token punctuation">)</span><span class="token punctuation">,</span>
 popcolname<span class="token operator">=</span><span class="token string">'pop'</span><span class="token punctuation">,</span> Zcolname<span class="token operator">=</span><span class="token string">'REGION'</span><span class="token punctuation">)</span>
RRS2 <span class="token operator">&lt;-</span> RR.table.add<span class="token punctuation">(</span>RRS<span class="token punctuation">,</span> RRS.REGION<span class="token punctuation">)</span>
RRS2<span class="token punctuation">[</span> <span class="token punctuation">,</span> <span class="token punctuation">,</span> <span class="token string">'8'</span><span class="token punctuation">]</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="RR.table.add">

<a href="#RR.table.add" class="help-page-title"><h2>Merge tables of Relative Risk results</h2></a>

<h3>Description</h3>

<p>Merge table of Relative Risk results for some zones with table for USA overall
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">RR.table.add<span class="token punctuation">(</span>rrs1<span class="token punctuation">,</span> rrs2<span class="token punctuation">,</span> zones2<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>rrs1</code></td>
<td>
<p>First table from RR.table()</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rrs2</code></td>
<td>
<p>Another table from RR.table()</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>zones2</code></td>
<td>
<p>Zones in rrs2, as vector, default is dimnames(rrs2)[3]</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>Returns a new array
</p>


<h3>See Also</h3>


<ul>
<li> <p><code><a href="#ej.indexes">ej.indexes</a></code> for local contribution to a variety of overall disparity metrics such as excess risk
</p>
</li>
<li> <p><code><a href="#RR">RR</a></code> to calculate overall disparity metric as relative risk (RR), ratio of mean environmental indicator values across demographic groups
</p>
</li>
<li> <p><code><a href="#RR.table">RR.table</a></code> to create 3-D table of RR values, by demographic group by environmental indicator by zone
</p>
</li>
<li> <p><code><a href="#RR.table.sort">RR.table.sort</a></code> to sort existing RR table
</p>
</li>
<li> <p><code><a href="#RR.table.add">RR.table.add</a></code> to add zone(s) to existing RR table
</p>
</li>
<li> <p><code><a href="#write.RR.tables">write.RR.tables</a></code> to write a file with a table or RR by indicator by group
</p>
</li>
<li> <p><code><a href="#ej.added">ej.added</a></code> to find EJ Index as local contribution to sum of EJ Indexes
</p>
</li>
<li> <p><code><a href="#RR.cut.if.gone">RR.cut.if.gone</a></code> to find local contribution to RR
</p>
</li>
<li> <p><code><a href="#RR.if.address.top.x">RR.if.address.top.x</a></code> to find how much RR would change if top-ranked places had different conditions
</p>
</li>
<li> <p><code><a href="#rrfv">rrfv</a></code> for obsolete attempt to vectorize rrf
</p>
</li>
<li> <p><code><a href="#rrf">rrf</a></code> for older simpler function for RR of one indicator for one demographic group
</p>
</li>
<li> <p><code><a href="#pop.ecdf">pop.ecdf</a></code> to compare plots of cumulative frequency distribution of indicator values by group
</p>
</li>
</ul>
<h3>Examples</h3>

<pre class="language-r"><code class="language-r">RRS.US  <span class="token operator">&lt;-</span> RR.table<span class="token punctuation">(</span>mydat<span class="token operator">=</span>bg<span class="token punctuation">,</span> Enames<span class="token operator">=</span>names.e<span class="token punctuation">,</span> Dnames<span class="token operator">=</span>c<span class="token punctuation">(</span>names.d<span class="token punctuation">,</span> names.d.subgroups.pct<span class="token punctuation">)</span><span class="token punctuation">,</span>
  popcolname<span class="token operator">=</span><span class="token string">'pop'</span><span class="token punctuation">)</span>
 RRS.ST  <span class="token operator">&lt;-</span> RR.table<span class="token punctuation">(</span>mydat<span class="token operator">=</span>bg<span class="token punctuation">,</span> Enames<span class="token operator">=</span>names.e<span class="token punctuation">,</span> Dnames<span class="token operator">=</span>c<span class="token punctuation">(</span>names.d<span class="token punctuation">,</span> names.d.subgroups.pct<span class="token punctuation">)</span><span class="token punctuation">,</span>
  popcolname<span class="token operator">=</span><span class="token string">'pop'</span><span class="token punctuation">,</span> Zcolname<span class="token operator">=</span><span class="token string">'ST'</span><span class="token punctuation">)</span>
 RRS <span class="token operator">&lt;-</span> RR.table.add<span class="token punctuation">(</span>RRS.ST<span class="token punctuation">,</span> RRS.US<span class="token punctuation">)</span>
 RRS<span class="token punctuation">[</span> <span class="token string">'pctlowinc'</span><span class="token punctuation">,</span> <span class="token punctuation">,</span> <span class="token punctuation">]</span>
 RRS<span class="token punctuation">[</span> <span class="token punctuation">,</span> <span class="token punctuation">,</span> <span class="token string">'CA'</span><span class="token punctuation">]</span>
 RRS<span class="token punctuation">[</span> <span class="token punctuation">,</span> <span class="token string">'pm'</span><span class="token punctuation">,</span> <span class="token punctuation">]</span>
 RR.table.sort<span class="token punctuation">(</span>RRS<span class="token punctuation">)</span>

 RRS.REGION  <span class="token operator">&lt;-</span> RR.table<span class="token punctuation">(</span>mydat<span class="token operator">=</span>bg<span class="token punctuation">,</span> Enames<span class="token operator">=</span>names.e<span class="token punctuation">,</span> Dnames<span class="token operator">=</span>c<span class="token punctuation">(</span>names.d<span class="token punctuation">,</span> names.d.subgroups.pct<span class="token punctuation">)</span><span class="token punctuation">,</span>
  popcolname<span class="token operator">=</span><span class="token string">'pop'</span><span class="token punctuation">,</span> Zcolname<span class="token operator">=</span><span class="token string">'REGION'</span><span class="token punctuation">)</span>
 RRS2 <span class="token operator">&lt;-</span> RR.table.add<span class="token punctuation">(</span>RRS<span class="token punctuation">,</span> RRS.REGION<span class="token punctuation">)</span>
 RRS2<span class="token punctuation">[</span> <span class="token punctuation">,</span> <span class="token punctuation">,</span> <span class="token string">'8'</span><span class="token punctuation">]</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="RR.table.addmaxzone">

<a href="#RR.table.addmaxzone" class="help-page-title"><h2>Add to an existing RR.table the max relative risk value from any zone in the table
This function adds RR values from the max zone but RR.table already does this.</h2></a>

<h3>Description</h3>

<p>Add to an existing RR.table the max relative risk value from any zone in the table
This function adds RR values from the max zone but RR.table already does this.
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">RR.table.addmaxzone<span class="token punctuation">(</span>x<span class="token punctuation">,</span> testing <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>A table of relative risk values from RR.table()</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>testing</code></td>
<td>
<p>If TRUE, print extra info to terminal</p>
</td>
</tr>
</table>
<hr>
</div>
<div class="container manual-page" id="RR.table.max">

<a href="#RR.table.max" class="help-page-title"><h2>See which group and risk indicator (in zone) have max values in RR table</h2></a>

<h3>Description</h3>

<p>See which Demographic group has highest RR for each Envt risk indicator,
and which Envt risk indicator has highest RR for each Demographic group,
within each zone (USA, etc.),
in table of Relative Risk results by zone by group by envt risk factor.
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">RR.table.max<span class="token punctuation">(</span>x<span class="token punctuation">,</span> by <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> digits <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>Array results from <code><a href="#RR.table">RR.table()</a></code> or related function</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>by</code></td>
<td>
<p>optional vector (numeric or character), specifies which of three dimensions should be shown.
Default is 1, meaning dimension 1 which is demographic indicator.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>digits</code></td>
<td>
<p>optional number of digits to round to, default is 3.</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>The full x array, except only the first two elements of the specified dimension,
which should be the two elements with the max number and text saying which name is that max.
</p>


<h3>See Also</h3>


<ul>
<li> <p><code><a href="#ej.indexes">ej.indexes</a></code> for local contribution to a variety of overall disparity metrics such as excess risk
</p>
</li>
<li> <p><code><a href="#RR">RR</a></code> to calculate overall disparity metric as relative risk (RR), ratio of mean environmental indicator values across demographic groups
</p>
</li>
<li> <p><code><a href="#RR.table">RR.table</a></code> to create 3-D table of RR values, by demographic group by environmental indicator by zone
</p>
</li>
<li> <p><code><a href="#RR.table.sort">RR.table.sort</a></code> to sort existing RR table
</p>
</li>
<li> <p><code><a href="#RR.table.add">RR.table.add</a></code> to add zone(s) to existing RR table
</p>
</li>
<li> <p><code><a href="#write.RR.tables">write.RR.tables</a></code> to write a file with a table or RR by indicator by group
</p>
</li>
<li> <p><code><a href="#ej.added">ej.added</a></code> to find EJ Index as local contribution to sum of EJ Indexes
</p>
</li>
<li> <p><code><a href="#RR.cut.if.gone">RR.cut.if.gone</a></code> to find local contribution to RR
</p>
</li>
<li> <p><code><a href="#RR.if.address.top.x">RR.if.address.top.x</a></code> to find how much RR would change if top-ranked places had different conditions
</p>
</li>
<li> <p><code><a href="#rrfv">rrfv</a></code> for obsolete attempt to vectorize rrf
</p>
</li>
<li> <p><code><a href="#rrf">rrf</a></code> for older simpler function for RR of one indicator for one demographic group
</p>
</li>
<li> <p><code><a href="#pop.ecdf">pop.ecdf</a></code> to compare plots of cumulative frequency distribution of indicator values by group
</p>
</li>
</ul>
<hr>
</div>
<div class="container manual-page" id="RR.table.sort">

<a href="#RR.table.sort" class="help-page-title"><h2>Sort table of Relative Risk results by zone by group by envt risk factor</h2></a>

<h3>Description</h3>

<p>Sort table of Relative Risk results by zone by group by envt risk factor
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">RR.table.sort<span class="token punctuation">(</span>x<span class="token punctuation">,</span> margins <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> decreasing <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>Array of RR values from <code><a href="#RR">RR()</a></code> in array of 3 dimensions: xDnames, Enames, Zcolnames</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>margins</code></td>
<td>
<p>optional numeric vector of which dimensions to sort, default is all 3, so margins = c(1, 2, 3) by default</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>decreasing</code></td>
<td>
<p>default is TRUE, defines how to sort (note all specified dimensions are sorted the same way by this function)</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>Sorted version of x array of 3 dimensions: RRSDnames, Enames, Zcolnames
Returns an array with
one demographic group per row,
one environmental risk indicator per column, and
third dimension for which zone (e.g., which US State)
</p>


<h3>See Also</h3>


<ul>
<li> <p><code><a href="#ej.indexes">ej.indexes</a></code> for local contribution to a variety of overall disparity metrics such as excess risk
</p>
</li>
<li> <p><code><a href="#RR">RR</a></code> to calculate overall disparity metric as relative risk (RR), ratio of mean environmental indicator values across demographic groups
</p>
</li>
<li> <p><code><a href="#RR.table">RR.table</a></code> to create 3-D table of RR values, by demographic group by environmental indicator by zone
</p>
</li>
<li> <p><code><a href="#RR.table.sort">RR.table.sort</a></code> to sort existing RR table
</p>
</li>
<li> <p><code><a href="#RR.table.add">RR.table.add</a></code> to add zone(s) to existing RR table
</p>
</li>
<li> <p><code><a href="#write.RR.tables">write.RR.tables</a></code> to write a file with a table or RR by indicator by group
</p>
</li>
<li> <p><code><a href="#ej.added">ej.added</a></code> to find EJ Index as local contribution to sum of EJ Indexes
</p>
</li>
<li> <p><code><a href="#RR.cut.if.gone">RR.cut.if.gone</a></code> to find local contribution to RR
</p>
</li>
<li> <p><code><a href="#RR.if.address.top.x">RR.if.address.top.x</a></code> to find how much RR would change if top-ranked places had different conditions
</p>
</li>
<li> <p><code><a href="#rrfv">rrfv</a></code> for obsolete attempt to vectorize rrf
</p>
</li>
<li> <p><code><a href="#rrf">rrf</a></code> for older simpler function for RR of one indicator for one demographic group
</p>
</li>
<li> <p><code><a href="#pop.ecdf">pop.ecdf</a></code> to compare plots of cumulative frequency distribution of indicator values by group
</p>
</li>
</ul>
<h3>Examples</h3>

<pre class="language-r"><code class="language-r">RRS.US  <span class="token operator">&lt;-</span> RR.table<span class="token punctuation">(</span>mydat<span class="token operator">=</span>bg<span class="token punctuation">,</span> Enames<span class="token operator">=</span>names.e<span class="token punctuation">,</span> Dnames<span class="token operator">=</span>c<span class="token punctuation">(</span>names.d<span class="token punctuation">,</span> names.d.subgroups.pct<span class="token punctuation">)</span><span class="token punctuation">,</span>
 popcolname<span class="token operator">=</span><span class="token string">'pop'</span><span class="token punctuation">)</span>
RRS.ST  <span class="token operator">&lt;-</span> RR.table<span class="token punctuation">(</span>mydat<span class="token operator">=</span>bg<span class="token punctuation">,</span> Enames<span class="token operator">=</span>names.e<span class="token punctuation">,</span> Dnames<span class="token operator">=</span>c<span class="token punctuation">(</span>names.d<span class="token punctuation">,</span> names.d.subgroups.pct<span class="token punctuation">)</span><span class="token punctuation">,</span>
 popcolname<span class="token operator">=</span><span class="token string">'pop'</span><span class="token punctuation">,</span> Zcolname<span class="token operator">=</span><span class="token string">'ST'</span><span class="token punctuation">)</span>
RRS <span class="token operator">&lt;-</span> RR.table.add<span class="token punctuation">(</span>RRS.ST<span class="token punctuation">,</span> RRS.US<span class="token punctuation">)</span>
RRS<span class="token punctuation">[</span> <span class="token string">'pctlowinc'</span><span class="token punctuation">,</span> <span class="token punctuation">,</span> <span class="token punctuation">]</span>
RRS<span class="token punctuation">[</span> <span class="token punctuation">,</span> <span class="token punctuation">,</span> <span class="token string">'CA'</span><span class="token punctuation">]</span>
RRS<span class="token punctuation">[</span> <span class="token punctuation">,</span> <span class="token string">'pm'</span><span class="token punctuation">,</span> <span class="token punctuation">]</span>

RR.plot<span class="token punctuation">(</span>RR.table.sort<span class="token punctuation">(</span>RRS<span class="token punctuation">)</span><span class="token punctuation">)</span>
RR.table.sort<span class="token punctuation">(</span>RRS<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>

RRS.REGION  <span class="token operator">&lt;-</span> RR.table<span class="token punctuation">(</span>mydat<span class="token operator">=</span>bg<span class="token punctuation">,</span> Enames<span class="token operator">=</span>names.e<span class="token punctuation">,</span> Dnames<span class="token operator">=</span>c<span class="token punctuation">(</span>names.d<span class="token punctuation">,</span> names.d.subgroups.pct<span class="token punctuation">)</span><span class="token punctuation">,</span>
 popcolname<span class="token operator">=</span><span class="token string">'pop'</span><span class="token punctuation">,</span> Zcolname<span class="token operator">=</span><span class="token string">'REGION'</span><span class="token punctuation">)</span>
RRS2 <span class="token operator">&lt;-</span> RR.table.add<span class="token punctuation">(</span>RRS<span class="token punctuation">,</span> RRS.REGION<span class="token punctuation">)</span>
RRS2<span class="token punctuation">[</span> <span class="token punctuation">,</span> <span class="token punctuation">,</span> <span class="token string">'8'</span><span class="token punctuation">]</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="RR.table.view">

<a href="#RR.table.view" class="help-page-title"><h2>Just print Relative Risks (RR) info by demog group by risk type by zone</h2></a>

<h3>Description</h3>

<p>Currently does not do anything other than print. Takes zone-specific RRS values and prints them for viewing.
Just another way to specify which subset of the RR array you want to view.
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">RR.table.view<span class="token punctuation">(</span>
  x<span class="token punctuation">,</span>
  d <span class="token operator">=</span> dimnames<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  e <span class="token operator">=</span> dimnames<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  zone <span class="token operator">=</span> dimnames<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>A three dimensional array that is created by <code><a href="#RR">RR()</a></code> and has format like RRSd, e, zone</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>d</code></td>
<td>
<p>Optional. Vector of names of demographic groups that must be subset of first dimension of RRS. Default is all.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>e</code></td>
<td>
<p>Optional. Vector of names of environmental risk indicators that must be subset of second dimension of RRS. Default is all.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>zone</code></td>
<td>
<p>Optional. Vector of zone names that must be subset of names of third dimension of RRS. Default is all.</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>prints RRSd, e, zone
</p>


<h3>See Also</h3>


<ul>
<li> <p><code><a href="#ej.indexes">ej.indexes</a></code> for local contribution to a variety of overall disparity metrics such as excess risk
</p>
</li>
<li> <p><code><a href="#RR">RR</a></code> to calculate overall disparity metric as relative risk (RR), ratio of mean environmental indicator values across demographic groups
</p>
</li>
<li> <p><code><a href="#RR.table">RR.table</a></code> to create 3-D table of RR values, by demographic group by environmental indicator by zone
</p>
</li>
<li> <p><code><a href="#RR.table.sort">RR.table.sort</a></code> to sort existing RR table
</p>
</li>
<li> <p><code><a href="#RR.table.add">RR.table.add</a></code> to add zone(s) to existing RR table
</p>
</li>
<li> <p><code><a href="#write.RR.tables">write.RR.tables</a></code> to write a file with a table or RR by indicator by group
</p>
</li>
<li> <p><code><a href="#ej.added">ej.added</a></code> to find EJ Index as local contribution to sum of EJ Indexes
</p>
</li>
<li> <p><code><a href="#RR.cut.if.gone">RR.cut.if.gone</a></code> to find local contribution to RR
</p>
</li>
<li> <p><code><a href="#RR.if.address.top.x">RR.if.address.top.x</a></code> to find how much RR would change if top-ranked places had different conditions
</p>
</li>
<li> <p><code><a href="#rrfv">rrfv</a></code> for obsolete attempt to vectorize rrf
</p>
</li>
<li> <p><code><a href="#rrf">rrf</a></code> for older simpler function for RR of one indicator for one demographic group
</p>
</li>
<li> <p><code><a href="#pop.ecdf">pop.ecdf</a></code> to compare plots of cumulative frequency distribution of indicator values by group
</p>
</li>
</ul>
<h3>Examples</h3>

<pre class="language-r"><code class="language-r">t<span class="token punctuation">(</span>round<span class="token punctuation">(</span>RR.table.view<span class="token punctuation">(</span>
   RR.table<span class="token punctuation">(</span>bgtest<span class="token punctuation">,</span> names.e<span class="token punctuation">[</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> names.d<span class="token punctuation">[</span><span class="token number">3</span><span class="token operator">:</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'pop'</span><span class="token punctuation">,</span> Zcolname <span class="token operator">=</span> <span class="token string">'statename'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
   d <span class="token operator">=</span> <span class="token string">'pctlowinc'</span>
  <span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="RR.table.vs.us">

<a href="#RR.table.vs.us" class="help-page-title"><h2>Relative Risks (RR) in zones as ratios to US values</h2></a>

<h3>Description</h3>

<p>Takes zone-specific RRS values and divides each value by the corresponding value for the USA overall.
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">RR.table.vs.us<span class="token punctuation">(</span>
  x<span class="token punctuation">,</span>
  d <span class="token operator">=</span> names.d<span class="token punctuation">[</span>names.d <span class="token percent-operator operator">%in%</span> names<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  e <span class="token operator">=</span> names.e<span class="token punctuation">[</span>names.e <span class="token percent-operator operator">%in%</span> names<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  zone <span class="token operator">=</span> names<span class="token punctuation">(</span>x<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>A three dimensional array that is created by <code><a href="#RR">RR()</a></code> and has format like RRSd, e, zone but where zone must include the name USA</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>d</code></td>
<td>
<p>Vector of names of demographic groups that must be subset of first dimension of RRS</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>e</code></td>
<td>
<p>Vector of names of environmental risk indicators that must be subset of second dimension of RRS</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>zone</code></td>
<td>
<p>Vector of zone names that must be subset of names of third dimension of RRS</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>numeric results same shape as RRSd, e, zone
</p>


<h3>See Also</h3>


<ul>
<li> <p><code><a href="#ej.indexes">ej.indexes</a></code> for local contribution to a variety of overall disparity metrics such as excess risk
</p>
</li>
<li> <p><code><a href="#RR">RR</a></code> to calculate overall disparity metric as relative risk (RR), ratio of mean environmental indicator values across demographic groups
</p>
</li>
<li> <p><code><a href="#RR.table">RR.table</a></code> to create 3-D table of RR values, by demographic group by environmental indicator by zone
</p>
</li>
<li> <p><code><a href="#RR.table.sort">RR.table.sort</a></code> to sort existing RR table
</p>
</li>
<li> <p><code><a href="#RR.table.add">RR.table.add</a></code> to add zone(s) to existing RR table
</p>
</li>
<li> <p><code><a href="#write.RR.tables">write.RR.tables</a></code> to write a file with a table or RR by indicator by group
</p>
</li>
<li> <p><code><a href="#ej.added">ej.added</a></code> to find EJ Index as local contribution to sum of EJ Indexes
</p>
</li>
<li> <p><code><a href="#RR.cut.if.gone">RR.cut.if.gone</a></code> to find local contribution to RR
</p>
</li>
<li> <p><code><a href="#RR.if.address.top.x">RR.if.address.top.x</a></code> to find how much RR would change if top-ranked places had different conditions
</p>
</li>
<li> <p><code><a href="#rrfv">rrfv</a></code> for obsolete attempt to vectorize rrf
</p>
</li>
<li> <p><code><a href="#rrf">rrf</a></code> for older simpler function for RR of one indicator for one demographic group
</p>
</li>
<li> <p><code><a href="#pop.ecdf">pop.ecdf</a></code> to compare plots of cumulative frequency distribution of indicator values by group
</p>
</li>
</ul>
<hr>
</div>
<div class="container manual-page" id="rrf">

<a href="#rrf" class="help-page-title"><h2>RR for one environmental indicator, one demographic group</h2></a>

<h3>Description</h3>

<p>**Probably obsolete given <code><a href="#RR">RR()</a></code>. <br><br>
Inputs are vectors over small places like Census blocks or block groups
or possibly individuals (ideally) but then d would be a dummy=1 for selected group and 0 for people not in selected group
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">rrf<span class="token punctuation">(</span>e<span class="token punctuation">,</span> d<span class="token punctuation">,</span> pop<span class="token punctuation">,</span> na.rm <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>e</code></td>
<td>
<p>Environmental indicator vector, one number per place, required.
e is environmental index or health risk level (e.g., PM2.5 concentration to which this person or place is exposed)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>d</code></td>
<td>
<p>Demographic indicator vector, required, one number per place, fraction of population that is in group of interest
d is percent of place that is selected demog group (e.g. percent Hispanic) (or d=1 or 0 if this is a vector of individuals)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pop</code></td>
<td>
<p>Population total per place, required, of which d is a fraction.
pop is population count of place (or pop=1 if this is a vector of individuals)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>na.rm</code></td>
<td>
<p>Logical optional TRUE by default in which case NA values (missing values) are removed first. If FALSE, any NA value in pop, e, or d would make result NA.</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>Returns one number
</p>


<h3>See Also</h3>


<ul>
<li> <p><code><a href="#ej.indexes">ej.indexes</a></code> for local contribution to a variety of overall disparity metrics such as excess risk
</p>
</li>
<li> <p><code><a href="#RR">RR</a></code> to calculate overall disparity metric as relative risk (RR), ratio of mean environmental indicator values across demographic groups
</p>
</li>
<li> <p><code><a href="#RR.table">RR.table</a></code> to create 3-D table of RR values, by demographic group by environmental indicator by zone
</p>
</li>
<li> <p><code><a href="#RR.table.sort">RR.table.sort</a></code> to sort existing RR table
</p>
</li>
<li> <p><code><a href="#RR.table.add">RR.table.add</a></code> to add zone(s) to existing RR table
</p>
</li>
<li> <p><code><a href="#write.RR.tables">write.RR.tables</a></code> to write a file with a table or RR by indicator by group
</p>
</li>
<li> <p><code><a href="#ej.added">ej.added</a></code> to find EJ Index as local contribution to sum of EJ Indexes
</p>
</li>
<li> <p><code><a href="#RR.cut.if.gone">RR.cut.if.gone</a></code> to find local contribution to RR
</p>
</li>
<li> <p><code><a href="#RR.if.address.top.x">RR.if.address.top.x</a></code> to find how much RR would change if top-ranked places had different conditions
</p>
</li>
<li> <p><code><a href="#rrfv">rrfv</a></code> for obsolete attempt to vectorize rrf
</p>
</li>
<li> <p><code><a href="#rrf">rrf</a></code> for older simpler function for RR of one indicator for one demographic group
</p>
</li>
<li> <p><code><a href="#pop.ecdf">pop.ecdf</a></code> to compare plots of cumulative frequency distribution of indicator values by group
</p>
</li>
</ul>
<h3>Examples</h3>

<pre class="language-r"><code class="language-r"><span class="token comment">#</span>
 <span class="token comment"># rrf(places$pm, places[ , unlist(Dlist)[1]],  places$pop)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="rrfv">

<a href="#rrfv" class="help-page-title"><h2>Vectorized version of rrf (relative risk) - **not tested, possibly obsolete</h2></a>

<h3>Description</h3>

<p>Probably obsolete given <code><a href="#RR">RR()</a></code>. Provides Relative Risk (RR) by demographic group by indicator based on Census data
Inputs are vectors over small places like Census blocks or block groups
or possibly individuals (ideally) but then d would be a dummy=1 for selected group and 0 for people not in selected group.
For one environmental indicator, multiple demographic groups.
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">rrfv<span class="token punctuation">(</span>e<span class="token punctuation">,</span> d<span class="token punctuation">,</span> pop<span class="token punctuation">,</span> na.rm <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>e</code></td>
<td>
<p>Environmental indicator vector, one per place, required.
e is environmental index or health risk level (e.g., PM2.5 concentration to which this person or place is exposed)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>d</code></td>
<td>
<p>Demographic indicator vector (not matrix/df?), required, one per place, fraction of population that is in group of interest
d is percent of place that is selected demog group (e.g. percent Hispanic) (or d=1 or 0 if this is a vector of individuals)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pop</code></td>
<td>
<p>Population total per place, required, of which d is a fraction.
pop is population count of place (or pop=1 if this is a vector of individuals)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>na.rm</code></td>
<td>
<p>Logical optional TRUE by default in which case NA values (missing values) are removed first. If FALSE, any NA value in pop, e, or d would make result NA.</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>Returns numeric vector if one demographic group? ** check
</p>


<h3>See Also</h3>


<ul>
<li> <p><code><a href="#ej.indexes">ej.indexes</a></code> for local contribution to a variety of overall disparity metrics such as excess risk
</p>
</li>
<li> <p><code><a href="#RR">RR</a></code> to calculate overall disparity metric as relative risk (RR), ratio of mean environmental indicator values across demographic groups
</p>
</li>
<li> <p><code><a href="#RR.table">RR.table</a></code> to create 3-D table of RR values, by demographic group by environmental indicator by zone
</p>
</li>
<li> <p><code><a href="#RR.table.sort">RR.table.sort</a></code> to sort existing RR table
</p>
</li>
<li> <p><code><a href="#RR.table.add">RR.table.add</a></code> to add zone(s) to existing RR table
</p>
</li>
<li> <p><code><a href="#write.RR.tables">write.RR.tables</a></code> to write a file with a table or RR by indicator by group
</p>
</li>
<li> <p><code><a href="#ej.added">ej.added</a></code> to find EJ Index as local contribution to sum of EJ Indexes
</p>
</li>
<li> <p><code><a href="#RR.cut.if.gone">RR.cut.if.gone</a></code> to find local contribution to RR
</p>
</li>
<li> <p><code><a href="#RR.if.address.top.x">RR.if.address.top.x</a></code> to find how much RR would change if top-ranked places had different conditions
</p>
</li>
<li> <p><code><a href="#rrfv">rrfv</a></code> for obsolete attempt to vectorize rrf
</p>
</li>
<li> <p><code><a href="#rrf">rrf</a></code> for older simpler function for RR of one indicator for one demographic group
</p>
</li>
<li> <p><code><a href="#pop.ecdf">pop.ecdf</a></code> to compare plots of cumulative frequency distribution of indicator values by group
</p>
</li>
</ul>
<h3>Examples</h3>

<pre class="language-r"><code class="language-r"><span class="token comment">#</span>
 <span class="token comment"># rrfv(places$pm, places[ , unlist(Dlist)],  places$pop)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="scatterEJ_D_E">

<a href="#scatterEJ_D_E" class="help-page-title"><h2>scatterplot EJScreen Demog vs Envt vs EJ Index
See one point per blockgroup, x=demog pctile, y=envt pctile, color=EJ pctile</h2></a>

<h3>Description</h3>

<p>scatterplot EJScreen Demog vs Envt vs EJ Index
See one point per blockgroup, x=demog pctile, y=envt pctile, color=EJ pctile
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">scatterEJ_D_E<span class="token punctuation">(</span>
  d<span class="token punctuation">,</span>
  e<span class="token punctuation">,</span>
  ejbin<span class="token punctuation">,</span>
  ename <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">,</span>
  legendtitle <span class="token operator">=</span> <span class="token string">"Percentiles of EJ Index (with yellow/orange/red as in the maps)"</span><span class="token punctuation">,</span>
  colors11 <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token string">"white"</span><span class="token punctuation">,</span> <span class="token string">"lightgray"</span><span class="token punctuation">,</span> <span class="token string">"lightgreen"</span><span class="token punctuation">,</span> <span class="token string">"darkgray"</span><span class="token punctuation">,</span> <span class="token string">"purple"</span><span class="token punctuation">,</span> <span class="token string">"black"</span><span class="token punctuation">,</span>
    <span class="token string">"darkblue"</span><span class="token punctuation">,</span> <span class="token string">"lightblue"</span><span class="token punctuation">,</span> <span class="token string">"yellow"</span><span class="token punctuation">,</span> <span class="token string">"orange"</span><span class="token punctuation">,</span> <span class="token string">"red"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  main <span class="token operator">=</span>
    <span class="token string">"What combinations of E and D result in EJ Index being in various bins\n                          so that place is shown on maps as in a given color-coded EJ Index percentile bin"</span><span class="token punctuation">,</span>
  mylegend <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token string">"&lt;10"</span><span class="token punctuation">,</span> <span class="token string">"10-20"</span><span class="token punctuation">,</span> <span class="token string">"20s"</span><span class="token punctuation">,</span> <span class="token string">"30s"</span><span class="token punctuation">,</span> <span class="token string">"40s"</span><span class="token punctuation">,</span> <span class="token string">"50-60"</span><span class="token punctuation">,</span> <span class="token string">"60s"</span><span class="token punctuation">,</span> <span class="token string">"70s"</span><span class="token punctuation">,</span> <span class="token string">"80-90"</span><span class="token punctuation">,</span>
    <span class="token string">"90-95"</span><span class="token punctuation">,</span> <span class="token string">"&gt;95"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token ellipsis">...</span>
<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>d</code></td>
<td>
<p>vector percentile demographic index</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>e</code></td>
<td>
<p>vector percentile environmental indicator</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ejbin</code></td>
<td>
<p>vector bin number 1 through N (bins of percentiles) for EJ Index for e</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ename</code></td>
<td>
<p>friendly name for graphic, optional</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>legendtitle</code></td>
<td>
<p>optional</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>colors11</code></td>
<td>
<p>optional</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>main</code></td>
<td>
<p>optional</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mylegend</code></td>
<td>
<p>vector of text labels for the N bins</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>passed to plot (but not to points for the various colors subsets)</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>Nothing. Draws a scatter plot.
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r"><span class="token comment">## Not run: </span>
 <span class="token keyword">if</span> <span class="token punctuation">(</span>require<span class="token punctuation">(</span>ejscreen<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
 bg <span class="token operator">=</span> ejscreen<span class="token operator">::</span>bg22
 dd <span class="token operator">=</span> bg<span class="token operator">$</span>pctile.VSI.eo
 ee <span class="token operator">=</span> bg<span class="token operator">$</span>pctile.traffic.score
 jj <span class="token operator">=</span> bg<span class="token operator">$</span>bin.EJ.DISPARITY.traffic.score.eo
 scatterEJ_D_E<span class="token punctuation">(</span>d<span class="token operator">=</span>dd<span class="token punctuation">,</span> e <span class="token operator">=</span> ee<span class="token punctuation">,</span> ejbin <span class="token operator">=</span> jj<span class="token punctuation">,</span> ename <span class="token operator">=</span> <span class="token string">"Traffic Score"</span><span class="token punctuation">)</span>
 <span class="token punctuation">}</span>

 <span class="token keyword">if</span> <span class="token punctuation">(</span>require<span class="token punctuation">(</span>EJAM<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
 bg <span class="token operator">=</span> data.table<span class="token punctuation">(</span>copy<span class="token punctuation">(</span>EJAM<span class="token operator">::</span>blockgroupstats<span class="token punctuation">)</span><span class="token punctuation">)</span>
 ee <span class="token operator">=</span> with<span class="token punctuation">(</span>EJAM<span class="token operator">::</span>blockgroupstats<span class="token punctuation">,</span> as.vector<span class="token punctuation">(</span><span class="token number">100</span> <span class="token operator">*</span> make.pctile.cols<span class="token punctuation">(</span>
   traffic.score<span class="token punctuation">,</span> as.df <span class="token operator">=</span> F<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">)</span>
 dd <span class="token operator">=</span> with<span class="token punctuation">(</span>blockgroupstats<span class="token punctuation">,</span> as.vector<span class="token punctuation">(</span><span class="token number">100</span> <span class="token operator">*</span> make.pctile.cols<span class="token punctuation">(</span>
   VSI.eo<span class="token punctuation">,</span> as.df <span class="token operator">=</span> F<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
 jj <span class="token operator">=</span> with<span class="token punctuation">(</span>blockgroupstats<span class="token punctuation">,</span> as.vector<span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">*</span> make.bin.cols<span class="token punctuation">(</span> as.vector<span class="token punctuation">(</span>make.pctile.cols<span class="token punctuation">(</span>
   EJ.DISPARITY.traffic.score.eo<span class="token punctuation">,</span> as.df <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> as.df <span class="token operator">=</span> F<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
 scatterEJ_D_E<span class="token punctuation">(</span>d<span class="token operator">=</span>dd<span class="token punctuation">,</span> e <span class="token operator">=</span> ee<span class="token punctuation">,</span> ejbin <span class="token operator">=</span> jj<span class="token punctuation">,</span> ename <span class="token operator">=</span> <span class="token string">"Traffic Score"</span><span class="token punctuation">)</span>
 <span class="token punctuation">}</span>

<span class="token comment">## End(Not run)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="sim_plotratios">

<a href="#sim_plotratios" class="help-page-title"><h2>create plot of ratios indicating disparity, from sim_riskbydistance output</h2></a>

<h3>Description</h3>

<p>create plot of ratios indicating disparity, from sim_riskbydistance output
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">sim_plotratios<span class="token punctuation">(</span>x<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table><tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>output from sim_riskbydistance</p>
</td>
</tr></table>
<h3>See Also</h3>

<p>sim_riskbydistance
</p>

<hr>
</div>
<div class="container manual-page" id="sim_riskbydistance">

<a href="#sim_riskbydistance" class="help-page-title"><h2>Simulate disparities as risk, pop density, and demographics vary by distance</h2></a>

<h3>Description</h3>

<p>Creates a simple set of 100 distances and at each distance simulated
demographics, risk levels, population density and size, etc.
Useful to see how those decay with distance and how the
EJ metrics one might use depend on those factors and domain analyzed.
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">sim_riskbydistance<span class="token punctuation">(</span>
  dist <span class="token operator">=</span> <span class="token number">1</span><span class="token operator">:</span><span class="token number">100</span><span class="token punctuation">,</span>
  ypopdensity.start <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">,</span>
  ypopdensity.end <span class="token operator">=</span> <span class="token number">50</span><span class="token punctuation">,</span>
  ypopdensity.rate <span class="token operator">=</span> <span class="token number">0.95</span><span class="token punctuation">,</span>
  ydemog.start <span class="token operator">=</span> <span class="token number">66</span><span class="token punctuation">,</span>
  ydemog.end <span class="token operator">=</span> <span class="token number">33</span><span class="token punctuation">,</span>
  ydemog.rate <span class="token operator">=</span> <span class="token number">0.95</span><span class="token punctuation">,</span>
  yrisk.start <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">,</span>
  yrisk.end <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span>
  yrisk.rate <span class="token operator">=</span> <span class="token number">0.8</span><span class="token punctuation">,</span>
  silent <span class="token operator">=</span> <span class="token boolean">FALSE</span>
<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>dist</code></td>
<td>
<p>Best not to change this. Distances simulated, such as 1 through 100 (that could be kilometers, for example).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ypopdensity.start</code></td>
<td>
<p>population density at closest point to emissions source</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ypopdensity.end</code></td>
<td>
<p>at furthest point</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ypopdensity.rate</code></td>
<td>
<p>decay rate with distance such as 0.95 for 5 percent drop per 1 of the 100 distance increments</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ydemog.start</code></td>
<td>
<p>Demographic group of interest nearby, as percent of pop, 0-100</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ydemog.end</code></td>
<td>
<p>at furthest point</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ydemog.rate</code></td>
<td>
<p>decay rate with distance such as 0.95 for 5 percent drop per 1 of the 100 distance increments</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>yrisk.start</code></td>
<td>
<p>Risk metric (e.g., 0 to 100) at nearest point.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>yrisk.end</code></td>
<td>
<p>at furthest point</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>yrisk.rate</code></td>
<td>
<p>decay rate with distance such as 0.95 for 5 percent drop per 1 of the 100 distance increments</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>silent</code></td>
<td>
<p>whether to print subset of table to console, and suggested plot code</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>silently returns data.frame of many indicators, at each of the 100 distances
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r">x <span class="token operator">&lt;-</span> sim_riskbydistance<span class="token punctuation">(</span><span class="token punctuation">)</span>
  plot_3_by_distance<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
  sim_plotratios<span class="token punctuation">(</span>x<span class="token punctuation">)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="state.health.url">

<a href="#state.health.url" class="help-page-title"><h2>Get URL(s) with State health indicator data from RWJF - ** url scheme obsolete now so needs to be redone</h2></a>

<h3>Description</h3>

<p>Robert Woods Johnson Foundation provides health indicator data by state. This function provides a basic interface to those webpages.
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">state.health.url<span class="token punctuation">(</span>
  ST <span class="token operator">=</span> <span class="token keyword">NA</span><span class="token punctuation">,</span>
  scope <span class="token operator">=</span> <span class="token string">"state"</span><span class="token punctuation">,</span>
  ind <span class="token operator">=</span> <span class="token number">66</span><span class="token punctuation">,</span>
  dist <span class="token operator">=</span> <span class="token number">23</span><span class="token punctuation">,</span>
  char <span class="token operator">=</span> <span class="token number">87</span><span class="token punctuation">,</span>
  time <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">,</span>
  viz <span class="token operator">=</span> <span class="token string">"bar"</span><span class="token punctuation">,</span>
  fstate <span class="token operator">=</span> <span class="token keyword">NA</span><span class="token punctuation">,</span>
  locs <span class="token operator">=</span> <span class="token keyword">NA</span><span class="token punctuation">,</span>
  cmp <span class="token operator">=</span> <span class="token string">"stcmp"</span><span class="token punctuation">,</span>
  open.browser <span class="token operator">=</span> <span class="token boolean">FALSE</span>
<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>ST</code></td>
<td>
<p>State abbreviation, FIPS code, or name as character vector</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>scope</code></td>
<td>
<p>Character, default is "state" view in results, but can be "national" view as well</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ind</code></td>
<td>
<p>Health Indicator code number. Number, default is 66. Possible values: <br></p>

<ul>
<li>
<p> 6=Cancer Incidence: Incidence of breast, cervical, lung and colorectal cancer per 100,000 population; age adjusted
</p>
</li>
<li>
<p> 7=Cancer Incidence by Race: Incidence of breast, cervical, lung and colorectal cancer per 100,000 population; age adjusted
</p>
</li>
<li>
<p> 10=Chronic Disease Prevalence: asthma/CVD/diabetes,
</p>
</li>
<li>
<p> 15=Limited Activity: Average number of days in the previous 30 days when a person indicates their activities are limited due to mental or physical health difficulties,
</p>
</li>
<li>
<p> 22=Tobacco taxes: State cigarette excise tax rate ($)
</p>
</li>
<li>
<p> 25=Income Inequality (Gini Coefficient)
</p>
</li>
<li>
<p> 31=life expectancy= Life expectancy at birth: number of years that a newborn is expected to live if current mortality rates continue to apply
</p>
</li>
<li>
<p> 44=Public health funding: Per capita state public health funding
</p>
</li>
<li>
<p> 45=Poor/Fair Health: Self-reported health status: percent of adults reporting fair or poor health
</p>
</li>
<li>
<p> 65=Premature death: Premature deaths: Average number of years of potential life lost prior to age 75 per 100,000 population
</p>
</li>
<li>
<p> 66=Premature Death by Race/Ethnicity: Premature deaths: Average number of years of potential life lost prior to age 75 per 100,000 population
</p>
</li>
</ul>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dist</code></td>
<td>
<p>default is 23. unclear what this controls. 23 or 29 or 0 or 19 possible. dist/char were 0/0 for US totals not by race, and were 19/58 for same by race.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>char</code></td>
<td>
<p>default is 87. unclear what this controls. 91=?, 119=?, 121=?  58? others possible.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>time</code></td>
<td>
<p>Code for which years are covered by the data. default is 3, which means 2009-2010. Possible values: <br></p>

<ul>
<li>
<p> 3=2009-2010
</p>
</li>
<li>
<p> 22=2010-2011
</p>
</li>
<li>
<p> 23=2011-2012
</p>
</li>
<li>
<p> 5=2000
</p>
</li>
<li>
<p> 10=2005
</p>
</li>
<li>
<p> 11=2006
</p>
</li>
<li>
<p> 12=2007
</p>
</li>
<li>
<p> 13=2008
</p>
</li>
<li>
<p> 1=2009
</p>
</li>
<li>
<p> 14=2010
</p>
</li>
<li>
<p> 4=2011
</p>
</li>
<li>
<p> 24=2012
</p>
</li>
<li>
<p> OTHERS?
</p>
</li>
</ul>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>viz</code></td>
<td>
<p>Type of visualization of data. Default is "bar" and can be line or bar or table.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fstate</code></td>
<td>
<p>State number. default is NA</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>locs</code></td>
<td>
<p>Locations to compare. default is NA</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cmp</code></td>
<td>
<p>Comparisons to view. Default is "stcmp" to see 2+ states compared (or state vs US). Can also see breakdown for one state if set to "brkdwn"</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>open.browser</code></td>
<td>
<p>Logical, default is FALSE. Should URL be opened by launching browser.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>NEWER URL SCHEME NOW... E.G. <a href="http://www.rwjf.org/en/how-we-work/rel/research-features/rwjf-datahub/national.html#q/scope/national/ind/10/dist/0/char/0/time/3/viz/map/cmp/brkdwn" target="_blank">http://www.rwjf.org/en/how-we-work/rel/research-features/rwjf-datahub/national.html#q/scope/national/ind/10/dist/0/char/0/time/3/viz/map/cmp/brkdwn</a>
</p>
<p>see also related percent insured data here: e.g.,
<a href="http://datacenter.shadac.org/profile/70#2/alabama/percent,moe,count/a/hide" target="_blank">http://datacenter.shadac.org/profile/70#2/alabama/percent,moe,count/a/hide</a>
DEFAULT IF NO PARAMETERS USED:
state.health.url() <br>
url created: <br>
http://www.rwjf.org/en/research-publications/research-features/rwjf-datahub/national.html#q/scope/state/ind/66/dist/23/char/87/time/3/viz/bar/fstate/33/locs/33,52,9/cmp/stcmp <br>
url that it resolves to on website: <br>
http://www.rwjf.org/en/research-publications/research-features/rwjf-datahub/national.html#q/scope/state/ind/66/dist/23/char/87/time/3/viz/bar/fstate/33/locs/33,52,9/cmp/stcmp <br></p>


<h3>Value</h3>

<p>URL(s) character vector, default: <a href="http://www.rwjf.org/en/research-publications/research-features/rwjf-datahub/national.html#q/scope/state/ind/66/dist/23/char/87/time/3/viz/bar/fstate/33/locs/33,52,9/cmp/stcmpind/66/dist/23/char/87/time/3/viz/bar/fstate/33/locs/33,52,9/cmp/stcmp" target="_blank">http://www.rwjf.org/en/research-publications/research-features/rwjf-datahub/national.html#q/scope/state/ind/66/dist/23/char/87/time/3/viz/bar/fstate/33/locs/33,52,9/cmp/stcmpind/66/dist/23/char/87/time/3/viz/bar/fstate/33/locs/33,52,9/cmp/stcmp</a>
</p>


<h3>URL scheme for linking to Resources for health data by state or by county: <br><br>
</h3>

<p>#State-level data from SHADAC: <a href="http://www.shadac.org/" target="_blank">http://www.shadac.org/</a> <br>
#State-level data from RWJF: <a href="http://www.rwjf.org/en/research-publications/research-features/rwjf-datahub.html" target="_blank">http://www.rwjf.org/en/research-publications/research-features/rwjf-datahub.html</a> <br>
***** see entire US clickable map of states
</p>


<h3>Use this URL format to figure out API or state-specific set of links to nice state reports.</h3>

<p>Public health, premature deaths, MD vs US, 2009-2010
<a href="http://www.rwjf.org/en/research-publications/research-features/rwjf-datahub/national.html#q/scope/state/ind/66/dist/23/char/91/time/3/viz/bar/fstate/21/locs/21,52/cmp/stcmp" target="_blank">http://www.rwjf.org/en/research-publications/research-features/rwjf-datahub/national.html#q/scope/state/ind/66/dist/23/char/91/time/3/viz/bar/fstate/21/locs/21,52/cmp/stcmp</a>
Public health, life expectancy, MD (state number 21) vs US
<a href="http://www.rwjf.org/en/research-publications/research-features/rwjf-datahub/national.html#q/scope/state/ind/31/dist/29/char/119/time/14/viz/line/fstate/21/locs/21,52/cmp/brkdwn" target="_blank">http://www.rwjf.org/en/research-publications/research-features/rwjf-datahub/national.html#q/scope/state/ind/31/dist/29/char/119/time/14/viz/line/fstate/21/locs/21,52/cmp/brkdwn</a>
<a href="http://www.rwjf.org/en/research-publications/research-features/rwjf-datahub/national.html#q/scope/state/ind/31/dist/29/char/119/time/14/viz/bar/fstate/21/locs/21,52/cmp/stcmp" target="_blank">http://www.rwjf.org/en/research-publications/research-features/rwjf-datahub/national.html#q/scope/state/ind/31/dist/29/char/119/time/14/viz/bar/fstate/21/locs/21,52/cmp/stcmp</a> <br>
Cancer by race in arizona (defaults to 2008-2009):
<a href="http://www.rwjf.org/en/research-publications/research-features/rwjf-datahub/national.html#q/scope/state/ind/7/dist/22/char/85/time/18/viz/bar/fstate/3/locs/3,52/cmp/stcmp" target="_blank">http://www.rwjf.org/en/research-publications/research-features/rwjf-datahub/national.html#q/scope/state/ind/7/dist/22/char/85/time/18/viz/bar/fstate/3/locs/3,52/cmp/stcmp</a>
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r"><span class="token comment">#</span>
 shell.exec<span class="token punctuation">(</span>state.health.url<span class="token punctuation">(</span><span class="token string">'CA'</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="sumoe">

<a href="#sumoe" class="help-page-title"><h2>Margin of Error for a Sum</h2></a>

<h3>Description</h3>

<p>Estimates the margin of error (MOE) that characterizes uncertainty, for a sum of estimates,
based on their MOE values.
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">sumoe<span class="token punctuation">(</span>estimates<span class="token punctuation">,</span> moes<span class="token punctuation">,</span> include0 <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>estimates</code></td>
<td>
<p>A matrix or data.frame of numbers that are the estimates to be added across columns.
Each row represents another place such as a Census block group, where the sum of all columns is calculated once for each place.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>moes</code></td>
<td>
<p>A matrix of data.frame like estimates parameter, but with MOE values for the corresponding counts provided in estimates.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>include0</code></td>
<td>
<p>Default is FALSE. If TRUE, based MOE on all data, even where estimate is zero, which gives MOEs that create conservatively wide confidence intervals.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>This is based on US Census Bureau recommendations for working with American Community Survey summary file data.
This also works for differences (subtraction), not just sums.
For example, one can estimate MOE for number of people with less than high school education in a block group, given
estimates and margins of error for the count whose educational attainment is no school, first grade, second grade... 11th grade.
</p>


<h3>Value</h3>

<p>Returns margin(s) of error same shape as parameter estimates
</p>


<h3>See Also</h3>

<p><code><a href="#pct.moe">pct.moe()</a></code>
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r">povknownratio <span class="token operator">&lt;-</span> c<span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">,</span> <span class="token number">1500</span><span class="token punctuation">)</span><span class="token punctuation">;</span> povknownratio.m <span class="token operator">&lt;-</span> c<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">,</span> <span class="token number">250</span><span class="token punctuation">)</span>
 pov2plus <span class="token operator">&lt;-</span> c<span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">,</span> <span class="token number">1400</span><span class="token punctuation">)</span><span class="token punctuation">;</span> pov2plus.m <span class="token operator">&lt;-</span> c<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span>
 lowinc <span class="token operator">&lt;-</span> povknownratio <span class="token operator">-</span> pov2plus
 lowinc.m <span class="token operator">&lt;-</span> sumoe<span class="token punctuation">(</span>cbind<span class="token punctuation">(</span>povknownratio<span class="token punctuation">,</span> pov2plus<span class="token punctuation">)</span><span class="token punctuation">,</span> cbind<span class="token punctuation">(</span>povknownratio.m<span class="token punctuation">,</span> pov2plus.m<span class="token punctuation">)</span><span class="token punctuation">)</span>
 cbind<span class="token punctuation">(</span>lowinc<span class="token operator">=</span>lowinc<span class="token punctuation">,</span> MOE<span class="token operator">=</span>lowinc.m<span class="token punctuation">,</span> PCTMOE<span class="token operator">=</span>round<span class="token punctuation">(</span>lowinc.m<span class="token operator">/</span>lowinc<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="url.census">

<a href="#url.census" class="help-page-title"><h2>See webpage with data on Census units from American Fact Finder - may not be used</h2></a>

<h3>Description</h3>

<p>DRAFT CODE to see webpage with table of Census Bureau data via AFF WITHOUT NEEDING API KEY
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">url.census<span class="token punctuation">(</span>
  fips<span class="token punctuation">,</span>
  censustable <span class="token operator">=</span> <span class="token string">"P2"</span><span class="token punctuation">,</span>
  censusfile <span class="token operator">=</span> <span class="token string">"DEC/10_PL"</span><span class="token punctuation">,</span>
  launch <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">,</span>
  clean <span class="token operator">=</span> <span class="token boolean">TRUE</span>
<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>fips</code></td>
<td>
<p>vector of FIPS</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>censustable</code></td>
<td>
<p>'P2' by default but can be another table code.
e.g., see (http://factfinder.census.gov/faces/affhelp/jsf/pages/metadata.xhtml?lang=en&amp;type=dataset&amp;id=dataset.en.DEC_10_SF1)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>censusfile</code></td>
<td>
<p>'DEC/10_PL' by default. Also see 'DEC_10_SF1' for example.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>launch</code></td>
<td>
<p>TRUE by default, whether to open page in web browser</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>clean</code></td>
<td>
<p>Does not use clean.fips1215() if FALSE, which helps if the countiesall or other list is not yet updated, for example and lacks some new FIPS code</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>For information on FIPS codes, see <a href="http://www.census.gov/geo/reference/ansi.html" target="_blank">http://www.census.gov/geo/reference/ansi.html</a>,
and also see (https://www.census.gov/geo/reference/geoidentifiers.html)
</p>
<p>For links to AFF, see (http://factfinder2.census.gov/files/AFF_deep_linking_guide.pdf)
</p>
<p>e.g. to get 1 block census 2010 pop, for block fips 360610127001000 :
(http://factfinder2.census.gov/bkmk/table/1.0/en/DEC/10_SF1/P1/1000000US360610127001000)
</p>
<p>e.g. to get 1 block census 2010 RACE/ETH/NHWA, for block fips 360610127002001 :
(http://factfinder2.census.gov/bkmk/table/1.0/en/DEC/10_PL/P2/1000000US360610127002001)
</p>
<p>Notice the second one gets P2 from 10_PL not 10_SF1, because P2 in SF1 means something different
TO GET RACE/ETHNICITY CENSUS 2010 COUNTS ON ONE BLOCK:
block fips 360610127002001
(http://factfinder2.census.gov/bkmk/table/1.0/en/DEC/10_PL/P2/1000000US360610127002001)
</p>
<p>TO GET RACE/ETHNICITY CENSUS 2010 COUNTS ON TWO BLOCKS:
<a href="http://factfinder2.census.gov/bkmk/table/1.0/en/DEC/10_PL/P2/1000000US360610127002001%7C1000000US360610127002000" target="_blank">http://factfinder2.census.gov/bkmk/table/1.0/en/DEC/10_PL/P2/1000000US360610127002001|1000000US360610127002000</a>
</p>


<h3>Value</h3>

<p>Can open a webpage. Returns vector of URL(s) as character
</p>


<h3>See Also</h3>

<p><code><a href="#url.censusblock">url.censusblock()</a></code> and  (http://ejanalysis.github.io/countyhealthrankings)
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r">myfips <span class="token operator">&lt;-</span> <span class="token string">"360610127002001"</span>
  url.census<span class="token punctuation">(</span>myfips<span class="token punctuation">,</span> launch<span class="token operator">=</span><span class="token boolean">FALSE</span><span class="token punctuation">)</span>
  myfips <span class="token operator">&lt;-</span> c<span class="token punctuation">(</span><span class="token string">"360610127002001"</span><span class="token punctuation">,</span> <span class="token string">"360610127002000"</span><span class="token punctuation">)</span>
  url.census<span class="token punctuation">(</span>myfips<span class="token punctuation">,</span> launch<span class="token operator">=</span><span class="token boolean">FALSE</span><span class="token punctuation">)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="url.censusblock">

<a href="#url.censusblock" class="help-page-title"><h2>See webpage with data on Census block(s)</h2></a>

<h3>Description</h3>

<p>DRAFT CODE TO see table webpage of BLOCK DATA VIA AFF WITHOUT NEEDING API KEY
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">url.censusblock<span class="token punctuation">(</span>
  fips<span class="token punctuation">,</span>
  censustable <span class="token operator">=</span> <span class="token string">"P2"</span><span class="token punctuation">,</span>
  censusfile <span class="token operator">=</span> <span class="token string">"DEC/10_PL"</span><span class="token punctuation">,</span>
  launch <span class="token operator">=</span> <span class="token boolean">TRUE</span>
<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>fips</code></td>
<td>
<p>vector of FIPS</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>censustable</code></td>
<td>
<p>P2 by default but can be another table code. e.g., see <a href="http://factfinder.census.gov/faces/affhelp/jsf/pages/metadata.xhtml?lang=en&amp;type=dataset&amp;id=dataset.en.DEC_10_SF1" target="_blank">http://factfinder.census.gov/faces/affhelp/jsf/pages/metadata.xhtml?lang=en&amp;type=dataset&amp;id=dataset.en.DEC_10_SF1</a></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>censusfile</code></td>
<td>
<p>DEC/10_PL by default. Also see DEC_10_SF1 for example.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>launch</code></td>
<td>
<p>TRUE by default, whether to open page in web browser</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>For information on FIPS codes, see <a href="http://www.census.gov/geo/reference/ansi.html" target="_blank">http://www.census.gov/geo/reference/ansi.html</a>
and also see <a href="https://www.census.gov/geo/reference/geoidentifiers.html" target="_blank">https://www.census.gov/geo/reference/geoidentifiers.html</a>
For links to AFF, see <a href="http://factfinder2.census.gov/files/AFF_deep_linking_guide.pdf" target="_blank">http://factfinder2.census.gov/files/AFF_deep_linking_guide.pdf</a>
e.g. to get 1 block census 2010 pop, for block fips 360610127001000   <a href="http://factfinder2.census.gov/bkmk/table/1.0/en/DEC/10_SF1/P1/1000000US360610127001000" target="_blank">http://factfinder2.census.gov/bkmk/table/1.0/en/DEC/10_SF1/P1/1000000US360610127001000</a>
e.g. to get 1 block census 2010 RACE/ETH/NHWA, for block fips 360610127002001  <a href="http://factfinder2.census.gov/bkmk/table/1.0/en/DEC/10_PL/P2/1000000US360610127002001" target="_blank">http://factfinder2.census.gov/bkmk/table/1.0/en/DEC/10_PL/P2/1000000US360610127002001</a>
Notice the second one gets P2 from 10_PL not 10_SF1, because P2 in SF1 means something different
TO GET RACE/ETHNICITY CENSUS 2010 COUNTS ON ONE BLOCK:
block fips 360610127002001
<a href="http://factfinder2.census.gov/bkmk/table/1.0/en/DEC/10_PL/P2/1000000US360610127002001" target="_blank">http://factfinder2.census.gov/bkmk/table/1.0/en/DEC/10_PL/P2/1000000US360610127002001</a>
TO GET RACE/ETHNICITY CENSUS 2010 COUNTS ON TWO BLOCKS:
<a href="http://factfinder2.census.gov/bkmk/table/1.0/en/DEC/10_PL/P2/1000000US360610127002001%7C1000000US360610127002000" target="_blank">http://factfinder2.census.gov/bkmk/table/1.0/en/DEC/10_PL/P2/1000000US360610127002001|1000000US360610127002000</a>
</p>


<h3>Value</h3>

<p>Can open a webpage. Returns vector of URL(s) as character
</p>


<h3>See Also</h3>

<p>(http://ejanalysis.github.io/countyhealthrankings)
</p>

<hr>
</div>
<div class="container manual-page" id="url.open">

<a href="#url.open" class="help-page-title"><h2>Launch a web browser to go to a URL, like browseURL does</h2></a>

<h3>Description</h3>

<p>Just the same as <code><a href="https://r-universe.dev/manuals/utils.html#browseURL">browseURL()</a></code>
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">url.open<span class="token punctuation">(</span>myurl<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table><tr style="vertical-align: top;">
<td><code>myurl</code></td>
<td>
<p>required character element, URL to open</p>
</td>
</tr></table>
<h3>Value</h3>

<p>Just launches browser to open URL
</p>


<h3>See Also</h3>

<p><code><a href="https://r-universe.dev/manuals/utils.html#browseURL">browseURL()</a></code>, and <code><a href="https://r-universe.dev/manuals/base.html#shell.exec">shell.exec()</a></code> which this uses
</p>

<hr>
</div>
<div class="container manual-page" id="url.qf">

<a href="#url.qf" class="help-page-title"><h2>US Census Quickfacts Webpage URL</h2></a>

<h3>Description</h3>

<p>Get URL for webpage that provides basic demographic information from United States Census Bureau.
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">url.qf<span class="token punctuation">(</span>fips <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">,</span> launch <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">,</span> clean <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>fips</code></td>
<td>
<p>Vector of numeric or character class, required. Can be state FIPs as number or character, for example.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>launch</code></td>
<td>
<p>TRUE by default, whether to open page in web browser (max=1st 3 URLs opened)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>clean</code></td>
<td>
<p>Does not use clean.fips() if FALSE, which helps if the countiesall or other list is not yet updated, for example and lacks some new FIPS code</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>For information on FIPS codes, see <a href="http://www.census.gov/geo/reference/ansi.html" target="_blank">http://www.census.gov/geo/reference/ansi.html</a>,
and also see <a href="https://www.census.gov/geo/reference/geoidentifiers.html" target="_blank">https://www.census.gov/geo/reference/geoidentifiers.html</a> <br><br>
#################### <br><br>
If FIPS provided is 10 digits long, assume it is a tract missing a leading zero on the state portion (should have 11 characters).<br>
If FIPS provided is 11 digits long, assume it is a tract (correctly 11 characters), not simply a block group FIPS missing a leading zero (block group FIPS would correctly would have 12 characters).<br>
If FIPS provided is 12 digits long, assume it is a block group (correctly 12 characters).<br>
If FIPS provided is 13 digits long, it is a block group.<br>
If FIPS provided is 14 OR 15 digits long, assume it is a block. But that will not work in this function. <br>
If FIPS is none of the above, return a default URL <br><br></p>


<h3>Value</h3>

<p>Returns table of FIPS, geographic scale, and URL
</p>


<h3>NOTES:<br>
</h3>

<p>#<br></p>


<h3>URL FORMATS FOR QUICKFACTS REPORT ON A COUNTY FROM CENSUS QUICKFACTS SITE: <br>
</h3>

<p>#<br>
#A WHOLE STATE: <br></p>


<h3><br></h3>

<p>#WHERE 01000 = STATE 2-DIGIT FIPS,  PLUS 3 ZEROES <br></p>
<p>#A SINGLE COUNTY: <br></p>
<p>#URL = <br></p>
<p>#WHERE XX =	STATE 2-DIGIT FIPS <br>
#WHERE YYYYY = 	STATE 2-DIGIT FIPS AND COUNTY 3-DIGIT FIPS = 5 DIGITS TOTAL
</p>


<h3>See Also</h3>

<p><code><a href="#clean.fips1215">clean.fips1215</a></code>, <code><a href="#get.fips.bg">get.fips.bg</a></code>, <code><a href="#get.fips.tract">get.fips.tract</a></code>, <code><a href="#get.fips.county">get.fips.county</a></code>, <code><a href="#get.fips.st">get.fips.st</a></code> to get partial FIPS from longer FIPS, or
<code><a href="#get.name.county">get.name.county</a></code>, <code><a href="#get.name.state">get.name.state</a></code> to extract name from longer Census name, or
<code><a href="#get.state.info">get.state.info</a></code>, <code><a href="#get.county.info">get.county.info</a></code>, <code><a href="#get.epa.region">get.epa.region</a></code>
to look up info such as FIPS, state abbreviation, statename, countyname, or region based on FIPS or name.
</p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r">url.qf<span class="token punctuation">(</span> c<span class="token punctuation">(</span> <span class="token string">'011030001003001'</span><span class="token punctuation">,</span> <span class="token string">'011030001003'</span><span class="token punctuation">,</span> <span class="token string">'01103000100'</span><span class="token punctuation">,</span> <span class="token string">'01005'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>
   c<span class="token punctuation">(</span><span class="token number">8</span><span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">99999</span><span class="token punctuation">)</span> <span class="token punctuation">)</span>
 <span class="token comment">## Not run: </span>
 url.qf<span class="token punctuation">(</span> c<span class="token punctuation">(</span> <span class="token string">'011030001003001'</span><span class="token punctuation">,</span> <span class="token string">'011030001003'</span><span class="token punctuation">,</span> <span class="token string">'01103000100'</span><span class="token punctuation">,</span> <span class="token string">'01005'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>
   ejanalysis<span class="token operator">::</span>get.state.info<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span> <span class="token punctuation">,</span> <span class="token string">'FIPS.ST'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">99999</span><span class="token punctuation">)</span> <span class="token punctuation">)</span>
 
<span class="token comment">## End(Not run)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="worstd">

<a href="#worstd" class="help-page-title"><h2>Demographic groups with worst RR</h2></a>

<h3>Description</h3>

<p>View one key part of table of Relative Risk results by zone by group by envt risk factor
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">worstd<span class="token punctuation">(</span>rrs<span class="token punctuation">,</span> d <span class="token operator">=</span> <span class="token string">"pctlowinc"</span><span class="token punctuation">,</span> e <span class="token operator">=</span> <span class="token string">"pm"</span><span class="token punctuation">,</span> zone <span class="token operator">=</span> <span class="token string">"USA"</span><span class="token punctuation">,</span> n <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">,</span> digits <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>rrs</code></td>
<td>
<p>Required. This has to be the output of one of the functions like <code><a href="#RR.table">RR.table()</a></code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>d</code></td>
<td>
<p>not used. name of demographic field with percent (fraction) of population that is in each given demographic group, in dimnames(rrs)[1]</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>e</code></td>
<td>
<p>name of environmental risk factor in dimnames(rrs)[2]</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>zone</code></td>
<td>
<p>name of zone such as 'USA' or 'NY' found in dimnames(rrs)[3]</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n</code></td>
<td>
<p>worst 10 by default</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>digits</code></td>
<td>
<p>round to 2 by default</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>matrix
</p>


<h3>See Also</h3>


<ul>
<li> <p><code><a href="#ej.indexes">ej.indexes</a></code> for local contribution to a variety of overall disparity metrics such as excess risk
</p>
</li>
<li> <p><code><a href="#RR">RR</a></code> to calculate overall disparity metric as relative risk (RR), ratio of mean environmental indicator values across demographic groups
</p>
</li>
<li> <p><code><a href="#RR.table">RR.table</a></code> to create 3-D table of RR values, by demographic group by environmental indicator by zone
</p>
</li>
<li> <p><code><a href="#RR.table.sort">RR.table.sort</a></code> to sort existing RR table
</p>
</li>
<li> <p><code><a href="#RR.table.add">RR.table.add</a></code> to add zone(s) to existing RR table
</p>
</li>
<li> <p><code><a href="#write.RR.tables">write.RR.tables</a></code> to write a file with a table or RR by indicator by group
</p>
</li>
<li> <p><code><a href="#ej.added">ej.added</a></code> to find EJ Index as local contribution to sum of EJ Indexes
</p>
</li>
<li> <p><code><a href="#RR.cut.if.gone">RR.cut.if.gone</a></code> to find local contribution to RR
</p>
</li>
<li> <p><code><a href="#RR.if.address.top.x">RR.if.address.top.x</a></code> to find how much RR would change if top-ranked places had different conditions
</p>
</li>
<li> <p><code><a href="#rrfv">rrfv</a></code> for obsolete attempt to vectorize rrf
</p>
</li>
<li> <p><code><a href="#rrf">rrf</a></code> for older simpler function for RR of one indicator for one demographic group
</p>
</li>
<li> <p><code><a href="#pop.ecdf">pop.ecdf</a></code> to compare plots of cumulative frequency distribution of indicator values by group
</p>
</li>
</ul>
<h3>Examples</h3>

<pre class="language-r"><code class="language-r"><span class="token comment">## Not run: </span>
  data<span class="token punctuation">(</span>bgtest<span class="token punctuation">,</span> package <span class="token operator">=</span> <span class="token string">'ejanalysis'</span><span class="token punctuation">)</span>
  RRS.US  <span class="token operator">&lt;-</span> RR.table<span class="token punctuation">(</span>mydat <span class="token operator">=</span> bgtest<span class="token punctuation">,</span> Enames <span class="token operator">=</span> names.e<span class="token punctuation">,</span> Dnames <span class="token operator">=</span> names.d<span class="token punctuation">,</span> popcolname <span class="token operator">=</span> <span class="token string">'pop'</span><span class="token punctuation">)</span>
  RRS.ST  <span class="token operator">&lt;-</span> RR.table<span class="token punctuation">(</span>mydat <span class="token operator">=</span> bgtest<span class="token punctuation">,</span> Enames <span class="token operator">=</span> names.e<span class="token punctuation">,</span> Dnames <span class="token operator">=</span> names.d<span class="token punctuation">,</span> popcolname <span class="token operator">=</span> <span class="token string">'pop'</span><span class="token punctuation">,</span>
                  Zcolname <span class="token operator">=</span> <span class="token string">'ST'</span><span class="token punctuation">)</span>
  RRS <span class="token operator">&lt;-</span> RR.table.add<span class="token punctuation">(</span>RRS.ST<span class="token punctuation">,</span> RRS.US<span class="token punctuation">)</span>
  worstd<span class="token punctuation">(</span>RRS.US<span class="token punctuation">)</span>

<span class="token comment">## End(Not run)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="worste">

<a href="#worste" class="help-page-title"><h2>Environmental indicators with worst RR</h2></a>

<h3>Description</h3>

<p>View one key part of table of Relative Risk results by zone by group by envt risk factor
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">worste<span class="token punctuation">(</span>rrs<span class="token punctuation">,</span> d <span class="token operator">=</span> <span class="token string">"pctlowinc"</span><span class="token punctuation">,</span> e <span class="token operator">=</span> <span class="token string">"pm"</span><span class="token punctuation">,</span> zone <span class="token operator">=</span> <span class="token string">"USA"</span><span class="token punctuation">,</span> n <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">,</span> digits <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>rrs</code></td>
<td>
<p>Required. This has to be the output of one of the functions like <code><a href="#RR.table">RR.table()</a></code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>d</code></td>
<td>
<p>name of demographic field with percent (fraction) of population that is in each given demographic group, in dimnames(rrs)[1]</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>e</code></td>
<td>
<p>not used. e name of environmental risk factor in dimnames(rrs)[2]</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>zone</code></td>
<td>
<p>name of zone such as 'USA' or 'NY' found in dimnames(rrs)[3]</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n</code></td>
<td>
<p>worst 10 by default</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>digits</code></td>
<td>
<p>round to 2 by default</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>matrix
</p>


<h3>See Also</h3>


<ul>
<li> <p><code><a href="#ej.indexes">ej.indexes</a></code> for local contribution to a variety of overall disparity metrics such as excess risk
</p>
</li>
<li> <p><code><a href="#RR">RR</a></code> to calculate overall disparity metric as relative risk (RR), ratio of mean environmental indicator values across demographic groups
</p>
</li>
<li> <p><code><a href="#RR.table">RR.table</a></code> to create 3-D table of RR values, by demographic group by environmental indicator by zone
</p>
</li>
<li> <p><code><a href="#RR.table.sort">RR.table.sort</a></code> to sort existing RR table
</p>
</li>
<li> <p><code><a href="#RR.table.add">RR.table.add</a></code> to add zone(s) to existing RR table
</p>
</li>
<li> <p><code><a href="#write.RR.tables">write.RR.tables</a></code> to write a file with a table or RR by indicator by group
</p>
</li>
<li> <p><code><a href="#ej.added">ej.added</a></code> to find EJ Index as local contribution to sum of EJ Indexes
</p>
</li>
<li> <p><code><a href="#RR.cut.if.gone">RR.cut.if.gone</a></code> to find local contribution to RR
</p>
</li>
<li> <p><code><a href="#RR.if.address.top.x">RR.if.address.top.x</a></code> to find how much RR would change if top-ranked places had different conditions
</p>
</li>
<li> <p><code><a href="#rrfv">rrfv</a></code> for obsolete attempt to vectorize rrf
</p>
</li>
<li> <p><code><a href="#rrf">rrf</a></code> for older simpler function for RR of one indicator for one demographic group
</p>
</li>
<li> <p><code><a href="#pop.ecdf">pop.ecdf</a></code> to compare plots of cumulative frequency distribution of indicator values by group
</p>
</li>
</ul>
<h3>Examples</h3>

<pre class="language-r"><code class="language-r"><span class="token comment">## Not run: </span>
  data<span class="token punctuation">(</span>bgtest<span class="token punctuation">,</span> package <span class="token operator">=</span> <span class="token string">'ejanalysis'</span><span class="token punctuation">)</span>
  RRS.US  <span class="token operator">&lt;-</span> RR.table<span class="token punctuation">(</span>mydat <span class="token operator">=</span> bgtest<span class="token punctuation">,</span> Enames <span class="token operator">=</span> names.e<span class="token punctuation">,</span> Dnames <span class="token operator">=</span> names.d<span class="token punctuation">,</span> popcolname <span class="token operator">=</span> <span class="token string">'pop'</span><span class="token punctuation">)</span>
  RRS.ST  <span class="token operator">&lt;-</span> RR.table<span class="token punctuation">(</span>mydat <span class="token operator">=</span> bgtest<span class="token punctuation">,</span> Enames <span class="token operator">=</span> names.e<span class="token punctuation">,</span> Dnames <span class="token operator">=</span> names.d<span class="token punctuation">,</span> popcolname <span class="token operator">=</span> <span class="token string">'pop'</span><span class="token punctuation">,</span>
                  Zcolname <span class="token operator">=</span> <span class="token string">'ST'</span><span class="token punctuation">)</span>
  RRS <span class="token operator">&lt;-</span> RR.table.add<span class="token punctuation">(</span>RRS.ST<span class="token punctuation">,</span> RRS.US<span class="token punctuation">)</span>
  worste<span class="token punctuation">(</span>RRS.US<span class="token punctuation">)</span>

<span class="token comment">## End(Not run)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="worstplaces">

<a href="#worstplaces" class="help-page-title"><h2>Places with worst RR</h2></a>

<h3>Description</h3>

<p>View one key part of table of Relative Risk results by group by envt risk factor
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">worstplaces<span class="token punctuation">(</span>rrs<span class="token punctuation">,</span> d <span class="token operator">=</span> <span class="token string">"pctlowinc"</span><span class="token punctuation">,</span> e <span class="token operator">=</span> <span class="token string">"pm"</span><span class="token punctuation">,</span> n <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">,</span> digits <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>rrs</code></td>
<td>
<p>Required. This has to be the output of one of the functions like <code><a href="#RR.table">RR.table()</a></code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>d</code></td>
<td>
<p>name of demographic field with percent (fraction) of population that is in each given demographic group, in dimnames(rrs)[1]</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>e</code></td>
<td>
<p>name of environmental risk factor in dimnames(rrs)[2]</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n</code></td>
<td>
<p>worst 10 by default</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>digits</code></td>
<td>
<p>round to 2 by default</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>matrix
</p>


<h3>See Also</h3>


<ul>
<li> <p><code><a href="#ej.indexes">ej.indexes</a></code> for local contribution to a variety of overall disparity metrics such as excess risk
</p>
</li>
<li> <p><code><a href="#RR">RR</a></code> to calculate overall disparity metric as relative risk (RR), ratio of mean environmental indicator values across demographic groups
</p>
</li>
<li> <p><code><a href="#RR.table">RR.table</a></code> to create 3-D table of RR values, by demographic group by environmental indicator by zone
</p>
</li>
<li> <p><code><a href="#RR.table.sort">RR.table.sort</a></code> to sort existing RR table
</p>
</li>
<li> <p><code><a href="#RR.table.add">RR.table.add</a></code> to add zone(s) to existing RR table
</p>
</li>
<li> <p><code><a href="#write.RR.tables">write.RR.tables</a></code> to write a file with a table or RR by indicator by group
</p>
</li>
<li> <p><code><a href="#ej.added">ej.added</a></code> to find EJ Index as local contribution to sum of EJ Indexes
</p>
</li>
<li> <p><code><a href="#RR.cut.if.gone">RR.cut.if.gone</a></code> to find local contribution to RR
</p>
</li>
<li> <p><code><a href="#RR.if.address.top.x">RR.if.address.top.x</a></code> to find how much RR would change if top-ranked places had different conditions
</p>
</li>
<li> <p><code><a href="#rrfv">rrfv</a></code> for obsolete attempt to vectorize rrf
</p>
</li>
<li> <p><code><a href="#rrf">rrf</a></code> for older simpler function for RR of one indicator for one demographic group
</p>
</li>
<li> <p><code><a href="#pop.ecdf">pop.ecdf</a></code> to compare plots of cumulative frequency distribution of indicator values by group
</p>
</li>
</ul>
<h3>Examples</h3>

<pre class="language-r"><code class="language-r"><span class="token comment">## Not run: </span>
  data<span class="token punctuation">(</span>bgtest<span class="token punctuation">,</span> package <span class="token operator">=</span> <span class="token string">'ejanalysis'</span><span class="token punctuation">)</span>
  RRS.US  <span class="token operator">&lt;-</span> RR.table<span class="token punctuation">(</span>mydat <span class="token operator">=</span> bgtest<span class="token punctuation">,</span> Enames <span class="token operator">=</span> names.e<span class="token punctuation">,</span> Dnames <span class="token operator">=</span> names.d<span class="token punctuation">,</span> popcolname <span class="token operator">=</span> <span class="token string">'pop'</span><span class="token punctuation">)</span>
  RRS.ST  <span class="token operator">&lt;-</span> RR.table<span class="token punctuation">(</span>mydat <span class="token operator">=</span> bgtest<span class="token punctuation">,</span> Enames <span class="token operator">=</span> names.e<span class="token punctuation">,</span> Dnames <span class="token operator">=</span> names.d<span class="token punctuation">,</span> popcolname <span class="token operator">=</span> <span class="token string">'pop'</span><span class="token punctuation">,</span>
                  Zcolname <span class="token operator">=</span> <span class="token string">'ST'</span><span class="token punctuation">)</span>
  RRS <span class="token operator">&lt;-</span> RR.table.add<span class="token punctuation">(</span>RRS.ST<span class="token punctuation">,</span> RRS.US<span class="token punctuation">)</span>
  worstplaces<span class="token punctuation">(</span>RRS.US<span class="token punctuation">)</span>

<span class="token comment">## End(Not run)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="write.pctiles">

<a href="#write.pctiles" class="help-page-title"><h2>Write csv file lookup table - percentiles, mean, standard deviation</h2></a>

<h3>Description</h3>

<p>Given a data.frame, for each column in the data.frame,
this function just returns percentiles, mean, and standard deviation.
Also saves that as a csv file.
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">write.pctiles<span class="token punctuation">(</span>x<span class="token punctuation">,</span> filename<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>Data.frame, required.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>filename</code></td>
<td>
<p>Name, or full path and name, of the file to be saved. Required.</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>A data.frame with percentiles, mean, and standard deviation. Same number of columns as x had.
</p>

<hr>
</div>
<div class="container manual-page" id="write.pctiles.by.zone">

<a href="#write.pctiles.by.zone" class="help-page-title"><h2>create lookup table as file of percentiles, mean, sd by state or region</h2></a>

<h3>Description</h3>

<p>Given a data.frame, for each column in the data.frame,
this function just returns percentiles, mean, and standard deviation.
Also saves that as a csv file.
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">write.pctiles.by.zone<span class="token punctuation">(</span>mydf<span class="token punctuation">,</span> filename<span class="token punctuation">,</span> zone.vector<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>mydf</code></td>
<td>
<p>data.frame with numeric data. Each column will be examined to calculate mean, sd, and percentiles, for each zone.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>filename</code></td>
<td>
<p>prefix to use for filename to be saved locally</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>zone.vector</code></td>
<td>
<p>names of states or regions, for example. same length as wts, or rows in mydf</p>
</td>
</tr>
</table>
<h3>See Also</h3>

<p><a href="#write.wtd.pctiles.by.zone">write.wtd.pctiles.by.zone</a>
</p>

<hr>
</div>
<div class="container manual-page" id="write.RR.tables">

<a href="#write.RR.tables" class="help-page-title"><h2>Save RR tables to disk, one per zone.</h2></a>

<h3>Description</h3>

<p>This function breaks up a 3-dimensional table of RR values (e.g., by demographic group, by environmental indicator, by geographic zone),
and saves data for each zone to a 2-dimensional table in a file.
Requires table in format provided by <code><a href="#RR">RR()</a></code> and related functions.
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">write.RR.tables<span class="token punctuation">(</span>my.RR.table<span class="token punctuation">,</span> folder <span class="token operator">=</span> getwd<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>my.RR.table</code></td>
<td>
<p>Required RR table from function such as <code><a href="#RR">RR()</a></code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>folder</code></td>
<td>
<p>Optional directory, default is current working directory. Specifies where to save files.</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>Returns the file names as a character vector, after saving them locally.
Saves one file per zone, with rownames and header.
Format is one demographic group per row and one environmental indicator per column, plus max per row and max per column
</p>


<h3>See Also</h3>


<ul>
<li> <p><code><a href="#ej.indexes">ej.indexes</a></code> for local contribution to a variety of overall disparity metrics such as excess risk
</p>
</li>
<li> <p><code><a href="#RR">RR</a></code> to calculate overall disparity metric as relative risk (RR), ratio of mean environmental indicator values across demographic groups
</p>
</li>
<li> <p><code><a href="#RR.table">RR.table</a></code> to create 3-D table of RR values, by demographic group by environmental indicator by zone
</p>
</li>
<li> <p><code><a href="#RR.table.sort">RR.table.sort</a></code> to sort existing RR table
</p>
</li>
<li> <p><code><a href="#RR.table.add">RR.table.add</a></code> to add zone(s) to existing RR table
</p>
</li>
<li> <p><code><a href="#write.RR.tables">write.RR.tables</a></code> to write a file with a table or RR by indicator by group
</p>
</li>
<li> <p><code><a href="#ej.added">ej.added</a></code> to find EJ Index as local contribution to sum of EJ Indexes
</p>
</li>
<li> <p><code><a href="#RR.cut.if.gone">RR.cut.if.gone</a></code> to find local contribution to RR
</p>
</li>
<li> <p><code><a href="#RR.if.address.top.x">RR.if.address.top.x</a></code> to find how much RR would change if top-ranked places had different conditions
</p>
</li>
<li> <p><code><a href="#rrfv">rrfv</a></code> for obsolete attempt to vectorize rrf
</p>
</li>
<li> <p><code><a href="#rrf">rrf</a></code> for older simpler function for RR of one indicator for one demographic group
</p>
</li>
<li> <p><code><a href="#pop.ecdf">pop.ecdf</a></code> to compare plots of cumulative frequency distribution of indicator values by group
</p>
</li>
</ul>
<h3>Examples</h3>

<pre class="language-r"><code class="language-r"><span class="token comment"># RRS.REGION &lt;- RR.table(mydat=bg, Enames=names.e,</span>
  <span class="token comment"># Dnames=c(names.d, names.d.subgroups.pct), popcolname='pop', Zcolname='REGION')</span>
  <span class="token comment"># write.RR.tables(RRS.REGION)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="write.wtd.pctiles">

<a href="#write.wtd.pctiles" class="help-page-title"><h2>create lookup table as file of pop-weighted percentiles, mean, std.dev</h2></a>

<h3>Description</h3>

<p>create lookup table as file of pop-weighted percentiles, mean, std.dev
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">write.wtd.pctiles<span class="token punctuation">(</span>mydf<span class="token punctuation">,</span> wts<span class="token punctuation">,</span> filename<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>mydf</code></td>
<td>
<p>data.frame with numeric data. Each column will be examined to calculate mean, sd, and percentiles</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>wts</code></td>
<td>
<p>vector of numbers such as population counts as weights, as long as nrow(mydf)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>filename</code></td>
<td>
<p>prefix to use for filename to be saved locally</p>
</td>
</tr>
</table>
<h3>Examples</h3>

<pre class="language-r"><code class="language-r"><span class="token comment">## Not run: </span>
  write.wtd.pctiles<span class="token punctuation">(</span>bg22<span class="token punctuation">[</span> <span class="token punctuation">,</span> names.e<span class="token punctuation">]</span><span class="token punctuation">,</span> wts <span class="token operator">=</span> bg22<span class="token operator">$</span>pop<span class="token punctuation">,</span> filename <span class="token operator">=</span> <span class="token string">'envt-data'</span><span class="token punctuation">)</span>
  
<span class="token comment">## End(Not run)</span></code></pre>

<hr>
</div>
<div class="container manual-page" id="write.wtd.pctiles.by.zone">

<a href="#write.wtd.pctiles.by.zone" class="help-page-title"><h2>create lookup table as file of pop-weighted or unwtd percentiles, mean, sd for US or by state or region</h2></a>

<h3>Description</h3>

<p>check which functions actually get used for this now.
</p>


<h3>Usage</h3>

<pre class="language-r"><code class="language-r">write.wtd.pctiles.by.zone<span class="token punctuation">(</span>
  mydf<span class="token punctuation">,</span>
  wts <span class="token operator">=</span> <span class="token keyword">NULL</span><span class="token punctuation">,</span>
  filename <span class="token operator">=</span> <span class="token keyword">NULL</span><span class="token punctuation">,</span>
  zone.vector <span class="token operator">=</span> <span class="token keyword">NULL</span><span class="token punctuation">,</span>
  zoneOverallName <span class="token operator">=</span> <span class="token string">"USA"</span>
<span class="token punctuation">)</span></code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>mydf</code></td>
<td>
<p>data.frame with numeric data. Each column will be examined to calculate mean, sd, and percentiles, for each zone.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>wts</code></td>
<td>
<p>optional vector of numbers such as population counts as weights, as long as nrow(mydf)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>filename</code></td>
<td>
<p>prefix to use for filename to be saved locally (.csv is added by the function). If not provided, no file is saved.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>zone.vector</code></td>
<td>
<p>optional names of states or regions, for example. same length as wts, or rows in mydf</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>zoneOverallName</code></td>
<td>
<p>optonal If not by zone, name of entire domain to use in table column called REGION. Default is USA.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>also see <br><br>
ejscreen.lookuptables ??   <br><br></p>
<p>make.bin.pctile.cols   uses  assign.pctiles
</p>
<p>write.wtd.pctiles.by.zone  uses wtd.pctiles.exact or pctiles.exact  <br><br>
pctiles.exact uses                  stats::quantile(x, type = 1, probs = (1:100)/100, na.rm = TRUE))
The inverse of quantile is ecdf  (empirical cumulative distribution function)
a step function with jumps i/n at observation values, where i is the number of tied observations at that value. Missing values are ignored.
</p>
<p>For observations x= (x1,x2, ... xn), Fn is the fraction of observations less or equal to t, i.e.,
</p>
<p>Fn(t) = #xi &lt;= t/n = 1/n sum(i=1,n) Indicator(xi &lt;= t).
</p>
<div class="sourceCode"><pre>  stats::quantile() can use nine different quantile algorithms discussed in Hyndman and Fan (1996), -- Hyndman, R. J. and Fan, Y. (1996) Sample quantiles in statistical packages, American Statistician 50, 361365. doi: 10.2307/2684934.
  defined as weighted averages of consecutive order statistics.
  type 1 is used here, and is "Inverse of empirical distribution function."

  Sample quantiles of type i are defined by:

               Q[i](p) = (1 - ) x[j] +  x[j+1],

               i = type of formula to use (1 through 9).
               p is the percentage (0 through 1).
               x[j] is the jth order statistic,
               (j-m)/n  p &lt; (j-m+1)/n,
               n is the sample size, the value of
                is a function of
                 j = floor(np + m)     --so this is roughly how many data points are smaller.
                 g =       np + m - j,  --so this is roughly
                 m = a constant determined by the sample quantile type. (m= 0 or -0.5 here)
    Discontinuous sample quantile types 1, 2, and 3

    For types 1, 2 and 3, Q[i](p) is a discontinuous function of p, with
    m = 0 when i = 1 or i = 2, and m = -1/2 when i = 3.
    Type 1 =  Inverse of empirical distribution function.  = 0 if g = 0, and 1 otherwise.

wtd.pctiles.exact uses   Hmisc::wtd.quantile(x, wts, type = "i/n", probs = (1:100)/100) ,  na.rm = na.rm))
  "i/n" uses the inverse of the empirical distribution function,
  using  wt/T, where wt is the cumulative weight and T is the total weight (usually total sample size).
</pre></div>
<p>table.pop.pctile  and <br><br>
map service with lookup tables <br><br><br><br></p>


<h3>Examples</h3>

<pre class="language-r"><code class="language-r"><span class="token comment"># bg = ejscreen::bg21plus # want demog subgroups but also want PR eventually</span>
  <span class="token comment"># pctilevariables &lt;- c(names.e, names.d, names.d.subgroups, names.ej)</span>
  <span class="token comment"># ejanalysis::write.wtd.pctiles(mydf = bg[ , pctilevariables], wts = bg$pop, filename =  'lookupUSA21')</span>
  <span class="token comment"># ejanalysis::write.wtd.pctiles.by.zone(mydf = bg[ , pctilevariables], wts = bg$pop,</span>
  <span class="token comment">#                                 zone.vector = bg$REGION, filename =  'lookupRegions21')</span>
  <span class="token comment"># ejanalysis::write.wtd.pctiles.by.zone(mydf = bg[ , pctilevariables], wts = bg$pop,</span>
  <span class="token comment">#                                 zone.vector = bg$ST,     filename =  'lookupStates21')</span></code></pre>

<hr>
</div>
</div>
    <footer><p>Rendered with postdoc 1.2.0</p></footer>
  </body>
</html>
